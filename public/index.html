<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Monitor</title>
  <link rel="icon" type="image/png" href="/logo.png">
  <link rel="shortcut icon" href="/logo.png">
  <link rel="icon" href="/logo.png" sizes="32x32">
  <meta name="msapplication-TileImage" content="/logo.png">
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- xterm.js - SSH Terminal -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css">
  <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.min.js"></script>

  <!-- Custom Styles - Modularized CSS -->
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/projects.css">
  <link rel="stylesheet" href="/css/modals.css">
  <link rel="stylesheet" href="/css/dns.css">
  <link rel="stylesheet" href="/css/tables.css">
  <link rel="stylesheet" href="/css/tabs.css">
  <link rel="stylesheet" href="/css/settings.css">
  <link rel="stylesheet" href="/css/logs.css">
  <link rel="stylesheet" href="/css/transitions.css">
  <link rel="stylesheet" href="/css/server.css">
  <link rel="stylesheet" href="/css/antigravity.css">
  <link rel="stylesheet" href="/css/gemini-cli.css">
  <link rel="stylesheet" href="/css/login.css">
</head>

<body>
  <!-- 自定义 CSS -->
  <style id="custom-css"></style>
  <style>
    [v-cloak] {
      display: none !important;
    }
  </style>

  <div id="app" v-cloak>
    <!-- 认证检查加载状态 -->
    <div v-if="isCheckingAuth" class="auth-loading">
      <div class="auth-loading-content">
        <div class="spinner"></div>
        <div style="margin-top: 16px; color: var(--text-secondary);">正在加载...</div>
      </div>
    </div>

    <!-- 首次设置密码界面 -->
    <div v-if="!isCheckingAuth && showSetPasswordModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">🎉 欢迎使用</div>
        </div>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 24px;">请设置管理员密码</p>
        <div class="form-group">
          <input v-model="setPassword" type="password" class="form-input" placeholder="请输入密码（至少6位）"
            autocomplete="new-password" @keyup.enter="setAdminPassword" />
        </div>
        <div class="form-group">
          <input v-model="setPasswordConfirm" type="password" class="form-input" placeholder="请再次输入密码"
            autocomplete="new-password" @keyup.enter="setAdminPassword" />
        </div>
        <div v-if="setPasswordError" class="form-error">
          {{ setPasswordError }}
        </div>
        <button @click="setAdminPassword" class="btn btn-primary" style="width: 100%;">
          设置密码
        </button>
      </div>
    </div>

    <!-- 登录界面 -->
    <div v-if="!isCheckingAuth && showLoginModal" class="modal-overlay login-overlay">
      <div class="modal login-modal">
        <div class="login-header">
          <div class="login-icon-wrapper">
            <i class="fas fa-shield-alt login-icon"></i>
          </div>
          <div class="login-title">欢迎回来</div>
          <div class="login-subtitle">请登录以继续管理您的 API 监控服务</div>
        </div>

        <div class="login-form-group">
          <input v-model="loginPassword" type="password" class="login-input" placeholder="请输入管理员密码"
            autocomplete="current-password" @keyup.enter="verifyPassword" />
          <i class="fas fa-lock login-input-icon"></i>
        </div>

        <div v-if="loginError" class="form-error" style="text-align: center; margin-bottom: 16px;">
          <i class="fas fa-exclamation-circle"></i> {{ loginError }}
        </div>

        <button @click="verifyPassword" class="login-btn">
          立即登录
        </button>
      </div>
    </div>

    <div v-if="isAuthenticated" class="container">
      <!-- 页面头部 - 模块控制和设置 -->
      <div class="header">
        <div class="title">
          <i class="fas fa-chart-line"></i>
          API Monitor
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
          <!-- 设置按钮 -->
          <button class="btn btn-secondary icon-only" @click="showSettingsModal = true" title="系统设置">
            <i class="fas fa-cog"></i>
          </button>
        </div>
      </div>

      <!-- 主标签页导航 -->
      <div class="main-tabs">
        <template v-for="module in moduleOrder" :key="module">
          <button v-if="moduleVisibility[module]" class="main-tab" :class="[
              { active: mainActiveTab === module },
              module === 'zeabur' ? 'zeabur-tab' : '',
              module === 'dns' ? 'dns-tab' : '',
              module === 'openai' ? 'openai-tab' : '',
              module === 'server' ? 'server-tab' : '',
              module === 'antigravity' ? 'antigravity-tab' : '',
              module === 'gemini-cli' ? 'gemini-cli-tab' : ''
            ]" @click="handleTabSwitch(module)">
            <i class="fas" :class="getModuleIcon(module)"></i>
            <span> {{ getModuleName(module) }}</span>
          </button>
        </template>
      </div>

      <!-- ==================== Zeabur 监控部分 ==================== -->
      <div v-if="mainActiveTab === 'zeabur'" class="tab-content zeabur-sec-tab" :class="getTabAnimationClass('zeabur')">
        <!-- Zeabur 子标签页 -->
        <div class="sec-tabs">
          <button class="tab-btn" :class="{ active: zeaburCurrentTab === 'monitor' }"
            @click="zeaburCurrentTab = 'monitor'">
            <i class="fas fa-chart-line"></i> 服务监控
          </button>
          <button class="tab-btn" :class="{ active: zeaburCurrentTab === 'accounts' }"
            @click="zeaburCurrentTab = 'accounts'">
            <i class="fas fa-users"></i> 账号管理
          </button>
          <button class="tab-btn" :class="{ active: zeaburCurrentTab === 'settings' }"
            @click="zeaburCurrentTab = 'settings'">
            <i class="fas fa-cog"></i> 模块配置
          </button>
        </div>

        <!-- 服务监控标签页 -->
        <div v-if="zeaburCurrentTab === 'monitor'" class="sub-tab-content quick-fade-in">
          <div class="info-card">
            <div class="info-card-title">💡 使用说明</div>
            <div class="info-card-content">
              数据每30秒自动刷新
            </div>
          </div>

          <div class="controls" style="justify-content: space-between;">
            <div style="display: flex; gap: 10px; align-items: center;">
              <button class="btn btn-primary" @click="fetchData" :disabled="loading">
                <i class="fas fa-sync-alt"></i>
                {{ loading ? '数据更新' : '刷新数据' }}
              </button>
              <button class="btn btn-secondary" @click="toggleDataRefresh"
                :class="dataRefreshPaused ? 'btn-success' : 'btn-warning'">
                <i class="fas" :class="dataRefreshPaused ? 'fa-play' : 'fa-pause'"></i>
                {{ dataRefreshPaused ? '继续更新' : '暂停更新' }}
              </button>
              <button class="btn btn-danger" @click="clearCache">
                <i class="fas fa-trash"></i>
                清除缓存
              </button>
            </div>
            <div class="refresh-info">
              <div class="last-update">{{ refreshCountdown }} 秒后刷新</div>
              <div class="refresh-progress">
                <div class="refresh-progress-bar" :style="{ width: refreshProgress + '%' }"></div>
              </div>
            </div>
          </div>

          <div v-if="accounts.length > 0" class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">账号数</div>
              <div class="stat-value">{{ accounts.length }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">项目总数</div>
              <div class="stat-value">{{ totalProjects }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">服务总数</div>
              <div class="stat-value">{{ totalServices }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">运行中</div>
              <div class="stat-value">{{ runningServices }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">总费用</div>
              <div class="stat-value">${{ totalCost.toFixed(2) }}</div>
            </div>
          </div>

          <div v-if="loading && accounts.length === 0" class="loading">
            ⚡ 正在加载数据...
          </div>

          <div v-for="account in accounts" :key="account.name" class="account-card">
            <div class="account-header" @click="toggleAccount(account.name)">
              <div class="account-info">
                <span style="font-size: 20px; transition: transform 0.3s; display: inline-flex; align-items: center;"
                  :style="{ 
          /* 保持 span 作为一个容器，不旋转或旋转到特定角度 */
          transform: isAccountExpanded(account.name) ? 'rotate(0deg)' : 'rotate(0deg)' 
      }">

                  <i class="fas fa-chevron-right toggle-icon" :style="{ 
           transition: 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)', 
           // 逻辑调整：
           // 展开 (true) -> 0deg (向下)
           // 收起 (false) -> 90deg (向右)
           transform: isAccountExpanded(account.name) ? 'rotate(90deg)' : 'rotate(0deg)' 
       }">
                  </i>
                </span>
                <div>
                  <div class="account-name" v-if="!account.isEditingName"
                    @dblclick.stop="startEditAccountName(account)">
                    {{ account.name }}
                  </div>
                  <div v-else class="account-name-edit" @click.stop>
                    <input v-model="account.editingName" @keyup.enter="saveAccountName(account)"
                      @keyup.esc="cancelEditAccountName(account)" @blur="saveAccountName(account)" class="edit-input"
                      ref="accountNameInput" style="width: 150px;" />
                    <button @click.stop="cancelEditAccountName(account)" class="cancel-btn" title="取消"
                      style="margin-left: 4px;">
                      ✖️
                    </button>
                  </div>
                  <div v-if="account.data" class="account-email">
                    {{ maskEmail(account.data.email) || account.data.username }}
                  </div>
                </div>
              </div>
              <div class="account-balance">
                <div style="display: flex; flex-direction: column; gap: 3px;">
                  <div class="balance-card credit-balance-card">
                    <div class="balance-icon">💰</div>
                    <div class="balance-amount"
                      :class="account.data?.credit ? getBalanceClass(account.data.credit) : ''">
                      <span v-if="account.data?.credit">${{ (account.data.credit / 100).toFixed(2) }}</span>
                      <span v-else>-</span>
                    </div>
                  </div>
                  <div class="balance-card ai-balance-card">
                    <div class="balance-icon">🤖</div>
                    <div class="balance-amount">
                      {{ account.aihub && account.aihub.balance ? '$' + (account.aihub.balance / 100000).toFixed(2) :
                      '无'
                      }}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div v-if="account.error" class="error">
              ❌ 错误: {{ account.error }}
            </div>

            <div v-if="account.projects" class="projects-grid"
              :class="{ 'collapsed': !isAccountExpanded(account.name) }">
              <div v-for="project in account.projects" :key="project._id" :id="'proj-' + project._id"
                class="project-card">
                <div class="project-header">
                  <div class="project-name-wrapper">
                    <span class="project-name-icon">📦</span>
                    <span v-if="!project.isEditing" class="project-name-text">{{ project.name }}</span>
                    <input v-else v-model="project.editingName" @keyup.enter="saveProjectName(account, project)"
                      @keyup.esc="cancelEditProjectName(project)" @blur="saveProjectName(account, project)"
                      class="project-name-input" ref="projectNameInput" />
                  </div>
                  <div class="project-actions">
                    <button v-if="!project.isEditing" @click="deleteProject(account, project)"
                      class="project-delete-btn" title="删除项目">
                      <i class="fas fa-trash"></i>
                    </button>
                    <button v-if="!project.isEditing" @click="startEditProjectName(project)" class="project-edit-btn"
                      title="重命名项目">
                      <i class="fas fa-pen"></i>
                    </button>
                    <button v-if="project.isEditing" @click="cancelEditProjectName(project)" class="project-cancel-btn"
                      title="取消">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div class="project-mini-cards">
                  <div class="mini-card region-card">
                    <span class="mini-card-icon">地区📍</span>
                    <span class="mini-card-value">{{ formatRegion(project.region) }}</span>
                  </div>
                  <div class="mini-card cost-card">
                    <span class="mini-card-icon">已用💰</span>
                    <span class="mini-card-value">${{ formatCost(project.cost) }}</span>
                  </div>
                </div>
                <div class="services-container">
                  <div v-for="service in project.services" :key="service._id" :id="'service-' + service._id"
                    :class="['service-item', service.status.toLowerCase()]">
                    <div class="service-header">
                      <div class="service-name-container">
                        <span v-if="!service.isEditing" class="service-name" :title="service.name">
                          {{ service.name }}
                        </span>
                        <input v-else v-model="service.editingName"
                          @keyup.enter="saveServiceName(account, project, service)"
                          @keyup.esc="cancelEditServiceName(service)" @blur="saveServiceName(account, project, service)"
                          class="service-name-input" />
                        <button v-if="!service.isEditing" @click="startEditServiceName(service)"
                          class="service-edit-btn" title="重命名服务">
                          <i class="fas fa-pen"></i>
                        </button>
                        <button v-else @click="cancelEditServiceName(service)" class="service-cancel-btn" title="取消">
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                      <div :class="['service-status', service.status.toLowerCase()]">
                        {{ service.status === 'RUNNING' ? '运行中' : service.status === 'SUSPENDED' ? '已暂停' :
                        service.status
                        }}
                      </div>
                    </div>
                    <div v-if="service.resourceLimit" class="service-info">
                      <span style="display: inline-flex; align-items: center; gap: 4px; margin-right: 12px;">
                        <i class="fas fa-microchip"></i>
                        {{ service.resourceLimit.cpu }}m
                      </span>
                      <span style="display: inline-flex; align-items: center; gap: 4px;">
                        <i class="fas fa-memory"></i>
                        {{ service.resourceLimit.memory }}MB
                      </span>
                    </div>
                    <div class="service-actions">
                      <button v-if="service.status === 'RUNNING'" @click="pauseService(account, project, service)"
                        class="service-btn btn-pause">
                        <i class="fas fa-pause"></i>
                        暂停
                      </button>
                      <button @click="restartService(account, project, service)" class="service-btn btn-restart">
                        <i class="fas fa-redo"></i>
                        {{ service.status === 'SUSPENDED' ? '启动' : '重启' }}
                      </button>
                      <button @click="showServiceLogs(account, project, service)" class="service-btn btn-logs">
                        <i class="fas fa-file-alt"></i>
                        日志
                      </button>
                      <button @click="deleteService(account, project, service)" class="service-btn btn-delete">
                        <i class="fas fa-trash"></i>
                        删除
                      </button>
                    </div>
                  </div>
                  <div v-if="project.services.length === 0" class="empty-state">
                    暂无服务
                  </div>
                </div>

                <!-- 项目域名 -->
                <div v-if="getProjectDomains(project).length > 0" class="domains-container">
                  <a v-for="domainInfo in getProjectDomains(project)" :key="domainInfo.domain"
                    :href="'https://' + domainInfo.domain" target="_blank" class="domain-link">
                    <i class="fas fa-globe"></i>
                    <span>{{ domainInfo.domain }}</span>
                    <span v-if="domainInfo.isGenerated" class="domain-badge">自动</span>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div v-if="!loading && accounts.length === 0" class="error">
            未配置账号或无法获取数据。请检查 .env 配置文件。
          </div>
        </div>
        <!-- 服务监控标签页结束 -->

        <!-- 账号管理标签页 -->
        <div v-if="zeaburCurrentTab === 'accounts'" class="sub-tab-content quick-fade-in">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title"></div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-success" style="padding: 6px 12px;" @click="showAddZeaburAccountModal = true">
                  <i class="fas fa-plus"></i> 添加账号
                </button>
                <button class="btn btn-secondary" @click="exportAllAccounts" style="padding: 6px 12px;">
                  <i class="fas fa-upload"></i> 导出
                </button>
                <button class="btn btn-secondary" @click="importAllAccounts" style="padding: 6px 12px;">
                  <i class="fas fa-download"></i> 导入
                </button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>名称</th>
                    <th>邮箱</th>
                    <th>余额</th>
                    <th>状态</th>
                    <th style="width: 150px;">操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(account, index) in managedAccounts" :key="'local-' + index">
                    <td>{{ account.name }}</td>
                    <td>{{ account.email || '-' }}</td>
                    <td>
                      <span v-if="account.balance !== null && account.balance !== undefined">
                        ${{ account.balance.toFixed(2) }}
                      </span>
                      <span v-else>-</span>
                    </td>
                    <td>
                      <span class="proxied-badge" :class="account.status === 'active' ? 'proxied-on' : 'proxied-off'">
                        {{ account.status === 'active' ? '正常' : '未知' }}
                      </span>
                    </td>
                    <td class="actions">
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="removeAccount(index)" title="删除">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  <!-- 显示主机配置的账号（只读） -->
                  <tr v-if="managedAccounts.length === 0 && accounts.length > 0" v-for="account in accounts"
                    :key="'server-' + account.name">
                    <td>{{ account.name }}</td>
                    <td>{{ account.data?.email || '-' }}</td>
                    <td>
                      <span v-if="account.data?.credit">
                        ${{ (account.data.credit / 100).toFixed(2) }}
                      </span>
                      <span v-else>-</span>
                    </td>
                    <td>
                      <span class="proxied-badge proxied-off">
                        主机配置
                      </span>
                    </td>
                    <td class="actions">
                      <span style="font-size: 12px; color: var(--text-tertiary);">
                        🔒 只读
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="managedAccounts.length === 0 && accounts.length === 0" class="empty-state">
                <i class="fas fa-user-plus" style="font-size: 48px; margin-bottom: 16px;"></i>
                <div>暂无账号，点击上方按钮添加</div>
              </div>
            </div>
          </div>

          <!-- 批量添加 -->
          <div class="panel" style="margin-top: 16px;">
            <div class="panel-header">
              <div class="panel-title">批量添加账号</div>
            </div>
            <div>
              <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                每行一个账号，格式：<code>名称:Token</code> 或 <code>名称：Token</code> 或 <code>名称(Token)</code> 或
                <code>名称（Token）</code>
              </p>
              <div style="position: relative; min-height: 150px;">
                <div
                  style="width: 100%; min-height: 150px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 13px; font-family: monospace; white-space: pre-wrap; word-break: break-all; pointer-events: none; color: var(--text-primary); line-height: 1.5; background-color: var(--input-bg);">
                  {{ maskedBatchAccounts }}</div>
                <textarea v-model="batchAccounts" @input="updateBatchDisplay" placeholder="每行一个账号，格式：账号名称:API_Token"
                  class="form-textarea"
                  style="position: absolute; top: 0; left: 0; color: transparent; caret-color: var(--text-primary); background: transparent; line-height: 1.5; min-height: 150px;"></textarea>
              </div>
              <div v-if="batchAddError" class="form-error" style="margin-top: 8px;">{{ batchAddError }}</div>
              <div v-if="batchAddSuccess" class="form-success" style="margin-top: 8px;">{{ batchAddSuccess }}</div>
              <button class="btn btn-primary" @click="batchAddAccounts" :disabled="addingAccount"
                style="width: 100%; margin-top: 12px;">
                {{ addingAccount ? '添加中...' : '批量添加' }}
              </button>
            </div>
          </div>
        </div>
        <!-- 账号管理标签页结束 -->

        <!-- 模块配置标签页 -->

        <div v-if="zeaburCurrentTab === 'settings'" class="sub-tab-content quick-fade-in">

          <div class="panel">

            <div class="panel-header">

              <!-- <div class="panel-title">模块设置</div> -->

              <div style="display: flex; gap: 8px;">

                <button class="btn btn-primary" @click="saveZeaburSettings" style="padding: 6px 12px;">

                  <i class="fas fa-save"></i> 保存

                </button>

              </div>

            </div>



            <div style="padding: 6px;">
              <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" style="margin-bottom: 16px;">自动刷新间隔[>5秒]</label>
                <input type="number" :value="zeaburRefreshInterval / 1000"
                  @input="zeaburRefreshInterval = Math.max(5, parseInt($event.target.value)) * 1000" class="form-input"
                  min="5" placeholder="30" style="max-width: 200px;" />
              </div>

            </div>

          </div>

        </div>

        <!-- 添加 Zeabur 账号模态框 -->
        <div v-if="showAddZeaburAccountModal" class="modal-overlay" @keydown.esc="showAddZeaburAccountModal = false"
          @keydown.enter="addAccountToList" tabindex="-1">
          <div class="modal">
            <div class="modal-header">
              <div class="modal-title"></div>
              <button class="modal-close" @click="showAddZeaburAccountModal = false">&times;</button>
            </div>

            <div class="form-group">
              <label class="form-label">账号名称 *</label>
              <input v-model="newAccount.name" class="form-input" placeholder="例如: 我的账号" />
            </div>

            <div class="form-group">
              <label class="form-label">API Token *</label>
              <input v-model="newAccount.token" type="password" class="form-input" placeholder="sk-xxxxxxxxxxxxxxxx" />
              <div class="form-help">在 Zeabur 控制台的设置中创建 API Token</div>
            </div>

            <div v-if="addAccountError" class="form-error">{{ addAccountError }}</div>
            <div v-if="addAccountSuccess" class="form-success">{{ addAccountSuccess }}</div>

            <div style="display: flex; gap: 12px; margin-top: 20px;">
              <button class="btn btn-primary" @click="addAccountToList" :disabled="addingAccount" style="flex: 1;">
                {{ addingAccount ? '验证中...' : '添加账号' }}
              </button>
              <button class="btn btn-secondary" @click="showAddZeaburAccountModal = false" style="flex: 1;">取消</button>
            </div>
          </div>
        </div>

      </div>
      <!-- ==================== Zeabur 监控部分结束 ==================== -->

      <!-- ==================== DNS 管理部分 ==================== -->
      <div v-if="mainActiveTab === 'dns'" class="tab-content dns-tab-content" :class="getTabAnimationClass('dns')">
        <!-- DNS 子标签页 -->
        <div class="sec-tabs">
          <button class="tab-btn" :class="{ active: dnsCurrentTab === 'dns' }" @click="dnsCurrentTab = 'dns'">
            <i class="fas fa-globe"></i> DNS 记录
          </button>
          <button class="tab-btn" :class="{ active: dnsCurrentTab === 'accounts' }" @click="dnsCurrentTab = 'accounts'">
            <i class="fas fa-users"></i> 账号管理
          </button>
          <!-- <button class="tab-btn" :class="{ active: dnsCurrentTab === 'templates' }"
            @click="dnsCurrentTab = 'templates'">
            <i class="fas fa-copy"></i> 模板
          </button> -->
        </div>

        <!-- DNS 记录标签页 -->
        <div v-if="dnsCurrentTab === 'dns'" class="sub-tab-content quick-fade-in">
          <!-- 账号选择 - 卡片式 -->
          <div style="margin-bottom: 16px;">
            <!-- <label style="font-weight: 500; margin-bottom: 12px; display: block;">选择账号：</label> -->
            <div class="zones-grid">
              <div v-for="acc in dnsAccounts" :key="acc.id" class="zone-card"
                :class="{ active: dnsSelectedAccountId === acc.id }" @click="selectDnsAccount(acc)">
                <div style="flex: 1;">
                  <div class="zone-name">
                    <i class="fas fa-user-circle" style="margin-right: 6px; color: var(--cf-color);"></i>
                    {{ acc.name }}
                  </div>
                  <div class="zone-status" style="font-size: 11px;">{{ acc.email || '账号' }}</div>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <i v-if="dnsSelectedAccountId === acc.id" class="fas fa-check-circle"
                    style="color: var(--cf-color);"></i>
                  <button v-if="dnsSelectedAccountId === acc.id" class="btn btn-secondary"
                    style="padding: 4px 8px; font-size: 12px;" @click.stop="loadDnsZones" :disabled="dnsLoadingZones">
                    <i class="fas fa-sync-alt" :class="{ 'fa-spin': dnsLoadingZones }"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div v-if="dnsLoadingZones" class="loading">
            <div class="spinner"></div>
            <div style="margin-top: 12px;">加载域名列表...</div>
          </div>

          <!-- 域名网格 -->
          <div v-if="dnsSelectedAccountId && dnsZones.length > 0 && !dnsLoadingZones" class="zones-grid">
            <div v-for="zone in dnsZones" :key="zone.id" class="zone-card"
              :class="{ active: dnsSelectedZoneId === zone.id }" @click="selectDnsZone(zone)">
              <div>
                <div class="zone-name">{{ zone.name }}</div>
                <div class="zone-status" :class="zone.status">{{ zone.status }}</div>
              </div>
              <i class="fas fa-chevron-right" style="color: var(--text-tertiary);"></i>
            </div>
          </div>

          <div v-if="dnsSelectedAccountId && dnsZones.length === 0 && !dnsLoadingZones" class="empty-state">
            <i class="fas fa-globe" style="font-size: 48px; margin-bottom: 16px;"></i>
            <div>该账号下没有域名</div>
          </div>

          <!-- 快速切换 -->
          <div v-if="dnsSelectedZoneId" class="quick-switch">
            <i class="fas fa-bolt" style="color: var(--cf-color);"></i>
            <span style="font-weight: 500; white-space: nowrap;">快速切换：</span>
            <select v-model="dnsQuickSwitchType"
              style="color: #f38020; padding: 6px 10px; border-radius: 4px; border: 1px solid var(--input-border); background: var(--input-bg); min-width: 80px;">
              <option value="A">A</option>
              <option value="AAAA">AAAA</option>
              <option value="CNAME">CNAME</option>
            </select>
            <input v-model="dnsQuickSwitchName" placeholder="记录名称 (如 @, www, *)" />
            <input v-model="dnsQuickSwitchContent" placeholder="新的内容 (IP 或域名)" />
            <button class="btn btn-cf" style="padding: 6px 12px;" @click="dnsQuickSwitch" :disabled="dnsSwitching">
              {{ dnsSwitching ? '切换中...' : '切换' }}
            </button>
          </div>

          <!-- DNS 记录表格 -->
          <div v-if="dnsSelectedZoneId" class="panel">
            <div class="panel-header">
              <div class="panel-title"></div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddDnsRecordModal">
                  <i class="fas fa-plus"></i> 添加
                </button>
                <button v-if="dnsSelectedRecords.length > 0" class="btn btn-danger" style="padding: 6px 12px;"
                  @click="batchDeleteDnsRecords">
                  <i class="fas fa-trash-alt"></i> 删除 ({{ dnsSelectedRecords.length }})
                </button>
                <button class="btn btn-secondary" style="padding: 6px 12px;" @click="exportDnsRecords">
                  <i class="fas fa-upload"></i> 导出
                </button>
                <button class="btn btn-secondary" style="padding: 6px 12px;" @click="importDnsRecords">
                  <i class="fas fa-download"></i> 导入
                </button>
                <button class="btn btn-secondary" style="padding: 6px 10px;" @click="loadDnsRecords"
                  :disabled="dnsLoadingRecords">
                  <i class="fas fa-sync-alt" :class="{ 'fa-spin': dnsLoadingRecords }"></i>
                </button>
              </div>
            </div>

            <div v-if="dnsLoadingRecords" class="loading">
              <div class="spinner"></div>
              <div style="margin-top: 12px;">加载中...</div>
            </div>

            <div v-else class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th style="width: 5%;">
                      <input type="checkbox" @change="toggleSelectAllDnsRecords"
                        :checked="dnsSelectedRecords.length === dnsRecords.length && dnsRecords.length > 0"
                        style="width: 16px; height: 16px; cursor: pointer;">
                    </th>
                    <th style="width: 12%;">类型</th>
                    <th style="width: 18%;">名称</th>
                    <th style="width: 28%;">内容</th>
                    <th style="width: 8%;">代理</th>
                    <th style="width: 8%;">TTL</th>
                    <th style="width: 10%;">操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="record in dnsRecords" :key="record.id">
                    <td>
                      <input type="checkbox" :value="record.id" v-model="dnsSelectedRecords"
                        style="width: 16px; height: 16px; cursor: pointer;">
                    </td>
                    <td><span class="record-type" :class="record.type">{{ record.type }}</span></td>
                    <td>
                      <div v-if="!record.isEditingName" class="editable-cell"
                        :title="formatDnsRecordName(record.name) + ' (双击编辑)'" @dblclick="startEditDnsName(record)">
                        {{ formatDnsRecordName(record.name) }}
                      </div>
                      <div v-else class="inline-edit-container" @click.stop>
                        <input v-model="record.editingName" class="inline-edit-input" @keyup.enter="saveDnsName(record)"
                          @keyup.esc="cancelEditDnsName(record)" @blur="saveDnsName(record)" ref="dnsNameInput" />
                        <button @click.stop="cancelEditDnsName(record)" class="inline-edit-cancel" title="取消">
                          ✖️
                        </button>
                      </div>
                    </td>
                    <td>
                      <div v-if="!record.isEditingContent" class="content-truncate editable-cell"
                        :title="record.content + ' (双击编辑)'" @dblclick="startEditDnsContent(record)">
                        {{ record.content }}
                      </div>
                      <div v-else class="inline-edit-container" @click.stop>
                        <input v-model="record.editingContent" class="inline-edit-input"
                          @keyup.enter="saveDnsContent(record)" @keyup.esc="cancelEditDnsContent(record)"
                          @blur="saveDnsContent(record)" ref="dnsContentInput" />
                        <button @click.stop="cancelEditDnsContent(record)" class="inline-edit-cancel" title="取消">
                          ✖️
                        </button>
                      </div>
                    </td>
                    <td>
                      <span class="proxied-badge" :class="record.proxied ? 'proxied-on' : 'proxied-off'">
                        {{ record.proxied ? '开启' : '关闭' }}
                      </span>
                    </td>
                    <td>{{ record.ttl === 1 ? 'Auto' : record.ttl }}</td>
                    <td class="actions">
                      <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                        @click="editDnsRecord(record)" title="编辑">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="deleteDnsRecord(record)" title="删除">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="dnsRecords.length === 0" class="empty-state">暂无 DNS 记录</div>
            </div>
          </div>
        </div>

        <!-- CF 账号管理标签页 -->
        <div v-if="dnsCurrentTab === 'accounts'" class="sub-tab-content quick-fade-in">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title"></div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddDnsAccountModal">
                  <i class="fas fa-plus"></i> 添加账号
                </button>
                <button class="btn btn-secondary" style="padding: 6px 12px;" @click="exportDnsAccounts">
                  <i class="fas fa-upload"></i> 导出
                </button>
                <button class="btn btn-secondary" style="padding: 6px 12px;" @click="importDnsAccounts">
                  <i class="fas fa-download"></i> 导入
                </button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>名称</th>
                    <th>邮箱</th>
                    <th>API Token</th>
                    <th>添加时间</th>
                    <th>最后使用</th>
                    <th style="width: 150px;">操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="acc in dnsAccounts" :key="acc.id">
                    <td>{{ acc.name }}</td>
                    <td>{{ acc.email || '-' }}</td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span v-if="!acc.showToken" style="color: var(--text-secondary);">
                          {{ acc.hasToken ? '••••••••••••••••' : '-' }}
                        </span>
                        <span v-else style="font-family: monospace; font-size: 12px; word-break: break-all;">
                          {{ acc.apiToken || '-' }}
                        </span>
                        <button v-if="acc.hasToken" class="btn btn-secondary"
                          style="padding: 2px 6px; font-size: 11px; min-width: auto;"
                          @click="toggleDnsTokenVisibility(acc)" :title="acc.showToken ? '隐藏' : '显示'">
                          <i :class="acc.showToken ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                        </button>
                      </div>
                    </td>
                    <td>{{ formatDnsDate(acc.createdAt) }}</td>
                    <td>{{ acc.lastUsed ? formatDnsDate(acc.lastUsed) : '-' }}</td>
                    <td class="actions">
                      <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                        @click="verifyDnsAccount(acc)" title="验证Token">
                        <i class="fas fa-check"></i>
                      </button>
                      <button class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;"
                        @click="editDnsAccount(acc)" title="编辑">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="deleteDnsAccount(acc)" title="删除">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="dnsAccounts.length === 0" class="empty-state">
                <i class="fas fa-key" style="font-size: 48px; margin-bottom: 16px;"></i>
                <div>暂无账号，请添加 Cloudflare API Token</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 模板标签页 -->
        <div v-if="dnsCurrentTab === 'templates'">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">DNS 模板</div>
              <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddDnsTemplateModal">
                <i class="fas fa-plus"></i> 添加模板
              </button>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>名称</th>
                    <th style="width: 60px;">类型</th>
                    <th>内容</th>
                    <th style="width: 70px;">代理</th>
                    <th>描述</th>
                    <th style="width: 120px;">操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="tpl in dnsTemplates" :key="tpl.id">
                    <td>{{ tpl.name }}</td>
                    <td><span class="record-type" :class="tpl.type">{{ tpl.type }}</span></td>
                    <td>
                      <div class="content-truncate" :title="tpl.content">{{ tpl.content }}</div>
                    </td>
                    <td>
                      <span class="proxied-badge" :class="tpl.proxied ? 'proxied-on' : 'proxied-off'">
                        {{ tpl.proxied ? '开启' : '关闭' }}
                      </span>
                    </td>
                    <td>{{ tpl.description || '-' }}</td>
                    <td class="actions">
                      <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                        @click="editDnsTemplate(tpl)" title="编辑">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="deleteDnsTemplate(tpl)" title="删除">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="dnsTemplates.length === 0" class="empty-state">
                <i class="fas fa-copy" style="font-size: 48px; margin-bottom: 16px;"></i>
                <div>暂无模板，添加常用 DNS 配置模板以快速应用</div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <!-- DNS modals moved to the end of the container to fix centering issues -->

      <!-- 添加 CF 账号模态框 -->
      <div v-if="showAddDnsAccountModal" class="modal-overlay" @keydown.esc="showAddDnsAccountModal = false"
        @keydown.enter="addDnsAccount" tabindex="-1">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">添加 Cloudflare 账号</div>
            <button class="modal-close" @click="showAddDnsAccountModal = false">&times;</button>
          </div>

          <div class="form-group">
            <label class="form-label">账号名称 *</label>
            <input v-model="dnsAccountForm.name" class="form-input" placeholder="例如: 主账号" />
          </div>

          <div class="form-group">
            <label class="form-label">API Token *</label>
            <input v-model="dnsAccountForm.apiToken" type="password" class="form-input"
              placeholder="Cloudflare API Token" />
            <div class="form-help">在 Cloudflare 控制台 → My Profile → API Tokens 创建</div>
          </div>

          <div class="form-group">
            <label class="form-label">邮箱（可选）</label>
            <input v-model="dnsAccountForm.email" class="form-input" placeholder="用于标识账号" />
          </div>

          <div v-if="dnsAccountFormError" class="form-error">{{ dnsAccountFormError }}</div>
          <div v-if="dnsAccountFormSuccess" class="form-success">{{ dnsAccountFormSuccess }}</div>

          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button class="btn btn-primary" @click="addDnsAccount" :disabled="dnsSavingAccount" style="flex: 1;">
              {{ dnsSavingAccount ? '验证中...' : '添加账号' }}
            </button>
            <button class="btn btn-secondary" @click="showAddDnsAccountModal = false" style="flex: 1;">取消</button>
          </div>
        </div>
      </div>

      <!-- 编辑 CF 账号模态框 -->
      <div v-if="showEditDnsAccountModal" class="modal-overlay" @keydown.esc="showEditDnsAccountModal = false"
        @keydown.enter="updateDnsAccount" tabindex="-1">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">编辑 Cloudflare 账号</div>
            <button class="modal-close" @click="showEditDnsAccountModal = false">&times;</button>
          </div>

          <div class="form-group">
            <label class="form-label">账号名称 *</label>
            <input v-model="dnsEditAccountForm.name" class="form-input" placeholder="例如: 主账号" />
          </div>

          <div class="form-group">
            <label class="form-label">API Token *</label>
            <input v-model="dnsEditAccountForm.apiToken" type="password" class="form-input"
              placeholder="Cloudflare API Token" />
            <div class="form-help">留空表示不修改 Token</div>
          </div>

          <div class="form-group">
            <label class="form-label">邮箱（可选）</label>
            <input v-model="dnsEditAccountForm.email" class="form-input" placeholder="用于标识账号" />
          </div>

          <div v-if="dnsEditAccountFormError" class="form-error">{{ dnsEditAccountFormError }}</div>
          <div v-if="dnsEditAccountFormSuccess" class="form-success">{{ dnsEditAccountFormSuccess }}</div>

          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button class="btn btn-primary" @click="updateDnsAccount" :disabled="dnsSavingAccount" style="flex: 1;">
              {{ dnsSavingAccount ? '保存中...' : '保存修改' }}
            </button>
            <button class="btn btn-secondary" @click="showEditDnsAccountModal = false" style="flex: 1;">取消</button>
          </div>
        </div>
      </div>

      <!-- 添加/编辑 DNS 记录模态框 -->
      <div v-if="showDnsRecordModal" class="modal-overlay" @keydown.esc="showDnsRecordModal = false"
        @keydown.enter="saveDnsRecord" tabindex="-1">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">{{ dnsEditingRecord ? '编辑 DNS 记录' : '添加 DNS 记录' }}</div>
            <button class="modal-close" @click="showDnsRecordModal = false">&times;</button>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="form-group">
              <label class="form-label">类型 *</label>
              <select v-model="dnsRecordForm.type" class="form-input" :disabled="!!dnsEditingRecord">
                <option v-for="t in dnsRecordTypes" :key="t" :value="t">{{ t }}</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">名称 *</label>
              <input v-model="dnsRecordForm.name" class="form-input" placeholder="@ 或 www" />
              <div class="form-help">@ 表示根域名</div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">内容 *</label>
            <input v-model="dnsRecordForm.content" class="form-input" placeholder="IP 地址或目标域名" />
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="form-group">
              <label class="form-label">TTL</label>
              <select v-model="dnsRecordForm.ttl" class="form-input">
                <option :value="1">Auto</option>
                <option :value="60">1 分钟</option>
                <option :value="300">5 分钟</option>
                <option :value="600">10 分钟</option>
                <option :value="3600">1 小时</option>
                <option :value="86400">1 天</option>
              </select>
            </div>
            <div class="form-group" v-if="dnsRecordForm.type === 'MX'">
              <label class="form-label">优先级</label>
              <input v-model.number="dnsRecordForm.priority" type="number" class="form-input" placeholder="10" />
            </div>
          </div>

          <div class="form-group" v-if="canDnsBeProxied(dnsRecordForm.type)">
            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
              <input type="checkbox" v-model="dnsRecordForm.proxied" style="width: 16px; height: 16px;" />
              启用 Cloudflare 代理 (橙云)
            </label>
            <div class="form-help">启用后流量将通过 Cloudflare CDN</div>
          </div>

          <div v-if="dnsRecordFormError" class="form-error">{{ dnsRecordFormError }}</div>

          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button class="btn btn-primary" @click="saveDnsRecord" :disabled="dnsSavingRecord" style="flex: 1;">
              {{ dnsSavingRecord ? '保存中...' : '保存' }}
            </button>
            <button class="btn btn-secondary" @click="showDnsRecordModal = false" style="flex: 1;">取消</button>
          </div>
        </div>
      </div>

      <!-- 添加/编辑模板模态框 -->
      <div v-if="showDnsTemplateModal" class="modal-overlay" @keydown.esc="showDnsTemplateModal = false"
        @keydown.enter="saveDnsTemplate" tabindex="-1">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">{{ dnsEditingTemplate ? '编辑模板' : '添加模板' }}</div>
            <button class="modal-close" @click="showDnsTemplateModal = false">&times;</button>
          </div>

          <div class="form-group">
            <label class="form-label">模板名称 *</label>
            <input v-model="dnsTemplateForm.name" class="form-input" placeholder="例如: CDN 记录" />
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="form-group">
              <label class="form-label">记录类型 *</label>
              <select v-model="dnsTemplateForm.type" class="form-input">
                <option v-for="t in dnsRecordTypes" :key="t" :value="t">{{ t }}</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">TTL</label>
              <select v-model="dnsTemplateForm.ttl" class="form-input">
                <option :value="1">Auto</option>
                <option :value="300">5 分钟</option>
                <option :value="3600">1 小时</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">内容 *</label>
            <input v-model="dnsTemplateForm.content" class="form-input" placeholder="IP 地址或目标域名" />
          </div>

          <div class="form-group">
            <label class="form-label">描述（可选）</label>
            <input v-model="dnsTemplateForm.description" class="form-input" placeholder="模板用途说明" />
          </div>

          <div class="form-group" v-if="canDnsBeProxied(dnsTemplateForm.type)">
            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
              <input type="checkbox" v-model="dnsTemplateForm.proxied" style="width: 16px; height: 16px;" />
              启用 Cloudflare 代理
            </label>
          </div>

          <div v-if="dnsTemplateFormError" class="form-error">{{ dnsTemplateFormError }}</div>

          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button class="btn btn-primary" @click="saveDnsTemplate" :disabled="dnsSavingTemplate" style="flex: 1;">
              {{ dnsSavingTemplate ? '保存中...' : '保存' }}
            </button>
            <button class="btn btn-secondary" @click="showDnsTemplateModal = false" style="flex: 1;">取消</button>
          </div>
        </div>
      </div>

      <!-- ==================== DNS 管理部分结束 ==================== -->

      <!-- ==================== Antigravity 管理部分结束 ==================== -->

      <!-- ==================== Gemini CLI 管理部分 ==================== -->
      <div v-if="mainActiveTab === 'gemini-cli'" class="tab-content gemini-cli-content"
        :class="getTabAnimationClass('gemini-cli')">

        <!-- Gemini CLI 子标签页 -->
        <div class="sec-tabs gemini-sec-tabs">
          <button class="tab-btn"
            :class="{ active: geminiCliCurrentTab === 'models' || geminiCliCurrentTab === 'quotas' }"
            @click="switchGeminiCliTab('models')">
            <i class="fas fa-th-list"></i> 模型列表
          </button>
          <button class="tab-btn" :class="{ active: geminiCliCurrentTab === 'accounts' }"
            @click="switchGeminiCliTab('accounts')">
            <i class="fas fa-list"></i> 账号管理
          </button>
          <button class="tab-btn" :class="{ active: geminiCliCurrentTab === 'logs' }"
            @click="switchGeminiCliTab('logs')">
            <i class="fas fa-history"></i> 调用日志
          </button>
          <button class="tab-btn" :class="{ active: geminiCliCurrentTab === 'settings' }"
            @click="switchGeminiCliTab('settings')">
            <i class="fas fa-cog"></i> 模块配置
          </button>
        </div>

        <!-- 模型列表标签页 -->
        <div v-show="geminiCliCurrentTab === 'models' || geminiCliCurrentTab === 'quotas'"
          class="sub-tab-content quick-fade-in">
          <div class="panel-header" style="justify-content: space-between; padding-bottom: 10px;">
            <div style="display: flex; gap: 16px; align-items: center;">
              <div class="panel-title">Model Matrix</div>
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-primary btn-sm" @click="saveGeminiCliMatrix" :disabled="geminiCliModelLoading">
                <i class="fas fa-save"></i> 保存配置
              </button>
              <button class="btn btn-secondary btn-sm" @click="loadGeminiCliMatrix" :disabled="geminiCliModelLoading">
                <i class="fas fa-sync-alt" :class="{ 'fa-spin': geminiCliModelLoading }"></i> 刷新配置
              </button>
            </div>
          </div>

          <div v-if="geminiCliModelLoading && !geminiCliMatrix" class="loading">
            <div class="spinner"></div>
            <div style="margin-top: 12px;">正在获取配置...</div>
          </div>

          <div v-else class="ag-quota-list-view">
            <div class="panel">
              <div class="table-container">
                <table class="data-table model-matrix-table">
                  <thead>
                    <tr>
                      <th style="width: 200px;">模型名称</th>
                      <th class="text-center">
                        <div class="matrix-header-cell" @click="toggleMatrixColumn('base')">
                          <span>基础模型</span>
                          <label class="switch">
                            <input type="checkbox" :checked="isMatrixColumnAllChecked('base')" readonly>
                            <span class="slider round"></span>
                          </label>
                        </div>
                      </th>
                      <th class="text-center">
                        <div class="matrix-header-cell" @click="toggleMatrixColumn('maxThinking')">
                          <span>深度思考</span>
                          <label class="switch">
                            <input type="checkbox" :checked="isMatrixColumnAllChecked('maxThinking')" readonly>
                            <span class="slider round"></span>
                          </label>
                        </div>
                      </th>
                      <th class="text-center">
                        <div class="matrix-header-cell" @click="toggleMatrixColumn('noThinking')">
                          <span>快速思考</span>
                          <label class="switch">
                            <input type="checkbox" :checked="isMatrixColumnAllChecked('noThinking')" readonly>
                            <span class="slider round"></span>
                          </label>
                        </div>
                      </th>
                      <th class="text-center">
                        <div class="matrix-header-cell" @click="toggleMatrixColumn('search')">
                          <span>联网搜索</span>
                          <label class="switch">
                            <input type="checkbox" :checked="isMatrixColumnAllChecked('search')" readonly>
                            <span class="slider round"></span>
                          </label>
                        </div>
                      </th>
                      <th class="text-center">
                        <div class="matrix-header-cell" @click="toggleMatrixColumn('fakeStream')">
                          <span>假流式</span>
                          <label class="switch">
                            <input type="checkbox" :checked="isMatrixColumnAllChecked('fakeStream')" readonly>
                            <span class="slider round"></span>
                          </label>
                        </div>
                      </th>
                      <th class="text-center">
                        <div class="matrix-header-cell" @click="toggleMatrixColumn('antiTrunc')">
                          <span>抗截断</span>
                          <label class="switch">
                            <input type="checkbox" :checked="isMatrixColumnAllChecked('antiTrunc')" readonly>
                            <span class="slider round"></span>
                          </label>
                        </div>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="row in getGeminiCliMatrixList()" :key="row.id">
                      <td style="font-family: monospace; font-weight: 600;">{{ row.id }}</td>
                      <td class="text-center">
                        <label class="switch">
                          <input type="checkbox" :checked="row.base" @change="toggleMatrixItem(row.id, 'base')">
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="text-center">
                        <label class="switch">
                          <input type="checkbox" :checked="row.maxThinking"
                            @change="toggleMatrixItem(row.id, 'maxThinking')">
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="text-center">
                        <label class="switch">
                          <input type="checkbox" :checked="row.noThinking"
                            @change="toggleMatrixItem(row.id, 'noThinking')">
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="text-center">
                        <label class="switch">
                          <input type="checkbox" :checked="row.search" @change="toggleMatrixItem(row.id, 'search')">
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="text-center">
                        <label class="switch">
                          <input type="checkbox" :checked="row.fakeStream"
                            @change="toggleMatrixItem(row.id, 'fakeStream')">
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="text-center">
                        <label class="switch">
                          <input type="checkbox" :checked="row.antiTrunc"
                            @change="toggleMatrixItem(row.id, 'antiTrunc')">
                          <span class="slider round"></span>
                        </label>
                      </td>
                    </tr>
                    <tr v-if="getGeminiCliMatrixList().length === 0">
                      <td colspan="7" style="text-align: center; padding: 40px; opacity: 0.5;">
                        <i class="fas fa-info-circle"></i> 暂无配置数据
                      </td>
                    </tr>

                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- 账号管理标签页 -->
        <div v-if="geminiCliCurrentTab === 'accounts'" class="sub-tab-content quick-fade-in">
          <div class="panel">
            <div class="panel-header">
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-gemini" @click="showGeminiCliOAuthExpand = !showGeminiCliOAuthExpand">
                  <i class="fab fa-google"></i> OAuth 授权
                </button>
                <button class="btn btn-success" @click="openAddGeminiCliAccountModal">
                  <i class="fas fa-plus-circle"></i> 手动添加
                </button>
                <button class="btn btn-secondary" @click="refreshGeminiCliAccounts" :disabled="geminiCliLoading"
                  title="刷新全部账号">
                  <i class="fas fa-sync-alt" :class="{ 'fa-spin': geminiCliLoading }"></i>
                </button>
              </div>
            </div>

            <!-- Expandable OAuth Panel -->
            <div class="ag-expandable-panel gemini-oauth-panel" :class="{ expanded: showGeminiCliOAuthExpand }">
              <div class="panel-header" style="border-bottom: none; padding-bottom: 0;">
                <div class="panel-title" style="width: 100%; text-align: center; padding-top: 10px;">连接 Google 账号</div>
              </div>

              <div class="oauth-modern-body">
                <!-- Step 1 -->
                <div class="oauth-step-item">
                  <div class="step-badge">1</div>
                  <div class="step-content">
                    <div class="step-text">登录 Google 以获取授权码</div>
                    <button class="btn btn-gemini btn-block" @click="openGeminiCliAuthUrl">
                      <i class="fab fa-google"></i> 获取授权链接
                    </button>
                  </div>
                </div>

                <!-- Divider -->
                <div class="oauth-step-line"></div>

                <!-- Step 2 -->
                <div class="oauth-step-item">
                  <div class="step-badge">2</div>
                  <div class="step-content">
                    <div class="step-text">在下方粘贴重定向后的 URL</div>
                    <textarea v-model="geminiCliOauthReturnUrl" class="form-textarea oauth-textarea"
                      placeholder="粘贴以 http:// 开头的完整 URL..." spellcheck="false"></textarea>
                  </div>
                </div>

                <!-- Options -->
                <div class="oauth-options">
                  <div class="oauth-option-row">
                    <input type="text" v-model="geminiCliCustomProjectId" class="form-input input-sm"
                      placeholder="自定义项目 ID (可选)">
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <label class="switch">
                        <input type="checkbox" v-model="geminiCliAllowRandomProjectId">
                        <span class="slider round"></span>
                      </label>
                      <span style="font-size: 12px; color: var(--text-secondary);">允许随机 ID</span>
                    </div>
                  </div>
                </div>

                <!-- Action -->
                <button class="btn btn-success btn-block btn-lg mt-3" @click="parseGeminiCliOauthUrl"
                  :disabled="!geminiCliOauthReturnUrl || geminiCliLoading">
                  <i class="fas" :class="geminiCliLoading ? 'fa-spinner fa-spin' : 'fa-link'"></i>
                  {{ geminiCliLoading ? '验证中...' : '验证并连接' }}
                </button>
              </div>
            </div>

            <!-- 统计信息栏 -->
            <div v-if="geminiCliStats" class="stats-bar"
              style="display: flex; gap: 20px; padding: 12px 16px; background: var(--bg-secondary); margin-bottom: 2px; border-radius: 8px; font-size: 13px;">
              <div class="stat-item">
                <span style="opacity: 0.7;">总账号:</span>
                <strong style="margin-left: 4px;">{{ geminiCliStats.total_accounts || 0 }}</strong>
              </div>
              <div class="stat-item">
                <span style="opacity: 0.7;">活跃:</span>
                <strong style="margin-left: 4px; color: var(--success-color);">{{ geminiCliStats.active_accounts || 0
                  }}</strong>
              </div>
            </div>

            <div v-if="geminiCliLoading && geminiCliAccounts.length === 0" class="loading">
              <div class="spinner"></div>
              <div style="margin-top: 12px;">加载中...</div>
            </div>

            <!-- 账号表格 -->
            <div v-else class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>备注名称</th>
                    <th>项目 ID</th>
                    <th>邮箱</th>
                    <th>状态</th>
                    <th style="width: 140px;">操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="account in geminiCliAccounts" :key="account.id">
                    <td><strong>{{ account.name || '未命名' }}</strong></td>
                    <td><code class="code-sm">{{ account.project_id || '-' }}</code></td>
                    <td><span style="font-size: 11px; opacity: 0.7;">{{ account.email || '-' }}</span></td>
                    <td>
                      <span class="ag-status-badge"
                        :class="account.status === 'online' ? 'ag-status-online' : (account.status === 'error' ? 'ag-status-error' : 'ag-status-unknown')">
                        {{ account.status === 'online' ? '在线' : (account.status === 'error' ? '异常' : '未知') }}
                      </span>
                    </td>
                    <td class="actions">
                      <button class="btn btn-success btn-sm icon-only" @click="toggleGeminiCliAccount(account)"
                        :title="account.enable ? '禁用' : '启用'">
                        <i class="fas" :class="account.enable ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
                      </button>
                      <button class="btn btn-primary btn-sm icon-only" @click="editGeminiCliAccount(account)"
                        title="编辑">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-danger btn-sm icon-only" @click="deleteGeminiCliAccount(account)"
                        title="删除">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="geminiCliAccounts.length === 0" class="empty-state">
                <i class="fas fa-terminal" style="font-size: 48px; margin-bottom: 16px;"></i>
                <div>暂无账号，点击上方按钮新增授权</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 调用日志标签页 -->
        <div v-show="geminiCliCurrentTab === 'logs'" class="sub-tab-content quick-fade-in">
          <div class="panel">
            <div class="panel-header"
              style="border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
              <div class="panel-title">Gemini API 调用日志</div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-secondary btn-sm" @click="loadGeminiCliLogs" :disabled="geminiCliLoading">
                  <i class="fas fa-sync-alt" :class="{ 'fa-spin': geminiCliLoading }"></i> 刷新
                </button>
                <button class="btn btn-danger btn-sm" @click="clearGeminiCliLogs">
                  <i class="fas fa-trash-alt"></i> 清空
                </button>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>调用时间</th>
                    <th>账号 ID</th>
                    <th>路径</th>
                    <th>状态</th>
                    <th>耗时</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="log in geminiCliLogs" :key="log.id">
                    <td style="font-size: 12px;">{{ formatDateTime(log.created_at) }}</td>
                    <td style="font-family: monospace; font-size: 11px;">{{ log.account_id }}</td>
                    <td style="font-size: 12px; max-width: 150px; overflow: hidden; text-overflow: ellipsis;">{{
                      log.request_path }}</td>
                    <td>
                      <span :class="log.status_code >= 400 ? 'status-err' : 'status-ok'">
                        {{ log.status_code }}
                      </span>
                    </td>
                    <td style="font-size: 12px; opacity: 0.7;">{{ log.duration_ms }}ms</td>
                    <td>
                      <button class="btn btn-xs btn-primary" @click="viewGeminiCliLogDetail(log)">详情</button>
                    </td>
                  </tr>
                  <tr v-if="geminiCliLogs.length === 0">
                    <td colspan="6" style="text-align: center; padding: 40px; opacity: 0.5;">尚无调用记录</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 模块设置标签页 -->
        <div v-show="geminiCliCurrentTab === 'settings'" class="sub-tab-content quick-fade-in">
          <div class="panel">
            <div class="panel-header" style="border-bottom: 1px solid var(--border-color);">
              <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <div class="panel-title-group">
                  <div class="panel-title">Gemini Google API 参数配置</div>
                </div>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-secondary btn-sm" @click="loadGeminiCliSettings" :disabled="geminiCliLoading">
                    <i class="fas fa-sync-alt" :class="{ 'fa-spin': geminiCliLoading }"></i> 刷新
                  </button>
                  <button class="btn btn-primary btn-sm" @click="saveGeminiCliSettings" :disabled="geminiCliSaving">
                    <i class="fas" :class="geminiCliSaving ? 'fa-spinner fa-spin' : 'fa-save'"></i> 保存全局
                  </button>
                </div>
              </div>
            </div>

            <div style="padding: 10px 3px 3px 3px;">
              <!-- 生成参数 -->
              <div style="margin-bottom: 24px;">
                <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--gemini-primary);">
                  <i class="fas fa-sliders-h"></i> 生成参数
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                  <div>
                    <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认温度</label>
                    <input type="number" step="0.1" min="0" max="2" v-model="geminiCliSettingsForm.DEFAULT_TEMPERATURE"
                      class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="1">
                  </div>
                  <div>
                    <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认 top_p</label>
                    <input type="number" step="0.01" min="0" max="1" v-model="geminiCliSettingsForm.DEFAULT_TOP_P"
                      class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="0.95">
                  </div>
                  <div>
                    <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认 top_k</label>
                    <input type="number" step="1" min="1" v-model="geminiCliSettingsForm.DEFAULT_TOP_K"
                      class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="64">
                  </div>
                  <div>
                    <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认最大
                      Tokens</label>
                    <input type="number" step="1" min="1" v-model="geminiCliSettingsForm.DEFAULT_MAX_TOKENS"
                      class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="8192">
                  </div>
                </div>
              </div>

              <!-- 模型重定向 -->
              <div style="margin-bottom: 24px;">
                <div
                  style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--gemini-primary); display: flex; align-items: center; gap: 8px;">
                  <i class="fas fa-exchange-alt"></i> 模型重定向 (别名)
                </div>
                <!-- 列表 -->
                <div v-if="geminiCliModelRedirects.length > 0"
                  style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-bottom: 12px;">
                  <div v-for="r in geminiCliModelRedirects" :key="r.source_model"
                    style="background: var(--bg-tertiary); padding: 8px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color);">
                    <div style="font-size: 12px; font-family: monospace;">
                      <span style="color: var(--text-primary); font-weight: 600;">{{ r.source_model }}</span>
                      <i class="fas fa-arrow-right" style="font-size: 10px; opacity: 0.5; margin: 0 6px;"></i>
                      <span style="opacity: 0.8;">{{ r.target_model }}</span>
                    </div>
                    <button class="btn btn-xs btn-danger icon-only"
                      @click="removeGeminiCliModelRedirect(r.source_model)" title="删除重定向">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
                <div v-else style="font-size: 12px; opacity: 0.5; margin-bottom: 12px; padding: 8px 0;">
                  暂无重定向规则。添加后，请求 source 模型将自动转发给 target 模型。
                </div>

                <!-- 添加表单 -->
                <div
                  style="display: flex; gap: 10px; align-items: flex-end; background: rgba(var(--gemini-primary-rgb), 0); padding: 10px; border-radius: 8px;">
                  <div style="flex: 1;">
                    <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">源模型名称
                      (自定义)</label>
                    <input type="text" v-model="newGeminiCliRedirectSource" class="form-input"
                      style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="例如: gpt-4o">
                  </div>
                  <div style="flex: 1;">
                    <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">目标模型 ID
                      (实际)</label>
                    <input type="text" v-model="newGeminiCliRedirectTarget" class="form-input"
                      style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="例如: gemini-1.5-pro">
                  </div>
                  <button class="btn btn-gemini" style="padding: 7px 15px; font-size: 13px;"
                    @click="addGeminiCliModelRedirect(newGeminiCliRedirectSource, newGeminiCliRedirectTarget)">
                    <i class="fas fa-plus"></i> 添加
                  </button>
                </div>
              </div>

              <!-- 底部设置网格 -->
              <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; margin-bottom: 10px;">
                <!-- 接口设置 -->
                <div>
                  <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--gemini-primary);">
                    <i class="fas fa-plug"></i> 接口设置
                  </div>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                    <div>
                      <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">API Key</label>
                      <input type="password" v-model="geminiCliSettingsForm.API_KEY" class="form-input"
                        style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="默认 123456">
                    </div>
                    <div>
                      <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">代理地址</label>
                      <input type="text" v-model="geminiCliSettingsForm.PROXY" class="form-input"
                        style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="留空使用默认">
                    </div>
                  </div>
                </div>

                <!-- 安全与负载 -->
                <div>
                  <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--gemini-primary);">
                    <i class="fas fa-shield-alt"></i> 安全与负载
                  </div>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px;">
                    <div>
                      <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">每小时上限</label>
                      <input type="number" v-model="geminiCliSettingsForm.CREDENTIAL_MAX_USAGE_PER_HOUR"
                        class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="1000">
                    </div>
                    <div>
                      <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">超时 (s)</label>
                      <input type="number" v-model="geminiCliSettingsForm.TIMEOUT" class="form-input"
                        style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="300">
                    </div>
                    <div>
                      <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">日志保留</label>
                      <input type="number" v-model="geminiCliSettingsForm.LOG_RETENTION_DAYS" class="form-input"
                        style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="7">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- ==================== Gemini CLI 管理部分结束 ==================== -->

            <!-- ==================== OpenApi 管理部分 ==================== -->
            <div v-if="mainActiveTab === 'openai'" class="tab-content openai-tab-content"
              :class="getTabAnimationClass('openai')">
              <!-- OpenApi 子标签页 -->
              <div class="sec-tabs openai-sec-tabs">
                <button class="tab-btn" :class="{ active: openaiCurrentTab === 'endpoints' }"
                  @click="openaiCurrentTab = 'endpoints'">
                  <i class="fas fa-server"></i> API 端点
                </button>
                <button class="tab-btn" :class="{ active: openaiCurrentTab === 'accounts' }"
                  @click="openaiCurrentTab = 'accounts'">
                  <i class="fas fa-users"></i> 账号管理
                </button>
              </div>

              <!-- API 端点标签页 -->
              <div v-if="openaiCurrentTab === 'endpoints'" class="sub-tab-content quick-fade-in">
                <div v-if="openaiLoading" class="loading">
                  <div class="spinner"></div>
                  <div style="margin-top: 12px;">加载中...</div>
                </div>

                <!-- 端点卡片列表 -->
                <div v-else>
                  <div v-for="endpoint in openaiEndpoints" :key="endpoint.id" class="account-card"
                    style="margin-bottom: 12px;">
                    <!-- 端点头部 - 可点击展开模型列表 -->
                    <div class="account-header" @click="toggleOpenaiModels(endpoint.id)"
                      style="cursor: pointer; align-items: center; padding-right: 10px;">
                      <div class="account-info" style="flex: 1; align-items: center; padding-right: 0;">
                        <span style="font-size: 20px; display: inline-flex; align-items: center;">
                          <i class="fas fa-chevron-right toggle-icon" :style="{
                        transition: 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                        transform: isOpenaiEndpointExpanded(endpoint.id) ? 'rotate(90deg)' : 'rotate(0deg)'
                      }"></i>
                        </span>
                        <div style="flex: 1;">
                          <div
                            style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin-bottom: 4px;">
                            <strong style="font-size: 16px;">{{ endpoint.name || '未命名' }}</strong>
                            <span class="proxied-badge"
                              :class="endpoint.status === 'valid' ? 'proxied-on' : (endpoint.status === 'invalid' ? 'proxied-off' : '')">
                              {{ endpoint.status === 'valid' ? '有效' : (endpoint.status === 'invalid' ? '无效' : '未验证') }}
                            </span>
                            <span v-if="endpoint.models && endpoint.models.length > 0"
                              style="font-size: 12px; color: var(--text-tertiary);">
                              {{ endpoint.models.length }} 个模型
                            </span>
                          </div>
                          <div class="account-email" style="font-size: 12px;">
                            {{ endpoint.baseUrl }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- 模型列表 - 可展开/收起 -->
                    <div class="openai-models-container"
                      :class="{ 'collapsed': !isOpenaiEndpointExpanded(endpoint.id) }">
                      <div v-if="endpoint.models && endpoint.models.length > 0" class="models-grid">
                        <div v-for="model in endpoint.models" :key="getModelName(model)" class="model-tag-item"
                          @click="copyToClipboard(getModelName(model))" :title="'点击复制: ' + getModelName(model)">
                          {{ getModelName(model) }}
                        </div>
                      </div>
                      <div v-else style="padding: 20px; text-align: center; color: var(--text-tertiary);">
                        <i class="fas fa-cube" style="font-size: 20px; margin-bottom: 8px; display: block;"></i>
                        暂无模型数据，点击刷新按钮获取
                      </div>
                    </div>
                  </div>

                  <div v-if="openaiEndpoints.length === 0" class="empty-state" style="padding: 40px;">
                    <i class="fas fa-robot" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <div>暂无 API 端点，点击上方按钮添加</div>
                  </div>
                </div>
                <!-- </div> -->
              </div>

              <!-- 账号管理标签页 -->
              <div v-if="openaiCurrentTab === 'accounts'" class="sub-tab-content quick-fade-in">
                <div class="panel">
                  <div class="panel-header">
                    <div class="panel-title"></div>
                    <div style="display: flex; gap: 8px;">
                      <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddOpenaiEndpointModal">
                        <i class="fas fa-plus"></i> 添加账号
                      </button>
                      <button class="btn btn-secondary" style="padding: 6px 10px;" @click="refreshAllOpenaiEndpoints"
                        :disabled="openaiRefreshing">
                        <i class="fas fa-sync-alt" :class="{ 'fa-spin': openaiRefreshing }"></i> 刷新全部
                      </button>
                      <button class="btn btn-secondary" @click="exportOpenaiEndpoints" style="padding: 6px 12px;">
                        <i class="fas fa-upload"></i> 导出
                      </button>
                      <button class="btn btn-secondary" @click="importOpenaiEndpointsFromFile"
                        style="padding: 6px 12px;">
                        <i class="fas fa-download"></i> 导入
                      </button>
                    </div>
                  </div>

                  <div v-if="openaiLoading" class="loading">
                    <div class="spinner"></div>
                    <div style="margin-top: 12px;">加载中...</div>
                  </div>

                  <div v-else class="table-container">
                    <table class="data-table">
                      <thead>
                        <tr>
                          <th>名称</th>
                          <th>API 地址</th>
                          <th>API Key</th>
                          <th>状态</th>
                          <th>模型数量</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr v-for="endpoint in openaiEndpoints" :key="endpoint.id">
                          <td>{{ endpoint.name || '未命名' }}</td>
                          <td>
                            <div style="display: flex; align-items: center; gap: 4px;">
                              <span style="font-family: monospace; font-size: 12px;">{{ endpoint.baseUrl }}</span>
                              <button class="copy-btn" @click.stop="copyToClipboard(endpoint.baseUrl)" title="复制地址"
                                style="padding: 2px 4px;">
                                <i class="fas fa-copy"></i>
                              </button>
                              <a :href="endpoint.baseUrl" target="_blank" rel="noopener noreferrer" title="在新标签页打开"
                                class="copy-btn" style="padding: 2px 4px;">
                                <i class="fas fa-external-link-alt"></i>
                              </a>
                            </div>
                          </td>
                          <td>
                            <div style="display: flex; align-items: center; gap: 4px;">
                              <span style="font-family: monospace; font-size: 12px;">
                                {{ endpoint.showKey ? endpoint.apiKey : maskApiKey(endpoint.apiKey) }}
                              </span>
                              <button class="copy-btn" @click.stop="endpoint.showKey = !endpoint.showKey"
                                :title="endpoint.showKey ? '隐藏' : '显示'" style="padding: 2px 4px;">
                                <i class="fas" :class="endpoint.showKey ? 'fa-eye-slash' : 'fa-eye'"></i>
                              </button>
                              <button class="copy-btn" @click.stop="copyToClipboard(endpoint.apiKey)" title="复制 Key"
                                style="padding: 2px 4px;">
                                <i class="fas fa-copy"></i>
                              </button>
                            </div>
                          </td>
                          <td>
                            <span class="proxied-badge"
                              :class="endpoint.status === 'valid' ? 'proxied-on' : (endpoint.status === 'invalid' ? 'proxied-off' : '')">
                              {{ endpoint.status === 'valid' ? '有效' : (endpoint.status === 'invalid' ? '无效' : '未验证') }}
                            </span>
                          </td>
                          <td>
                            <span v-if="endpoint.models && endpoint.models.length > 0">
                              {{ endpoint.models.length }} 个
                            </span>
                            <span v-else style="color: var(--text-tertiary);">-</span>
                          </td>
                          <td class="actions">
                            <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                              @click="verifyOpenaiEndpoint(endpoint)" title="验证">
                              <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;"
                              @click="editOpenaiEndpoint(endpoint)" title="编辑">
                              <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                              @click="deleteOpenaiEndpoint(endpoint)" title="删除">
                              <i class="fas fa-trash"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div v-if="openaiEndpoints.length === 0" class="empty-state">
                      <i class="fas fa-robot" style="font-size: 48px; margin-bottom: 16px;"></i>
                      <div>暂无 API 账号，点击上方按钮添加</div>
                    </div>
                  </div>
                </div>

                <!-- 批量添加 -->
                <div class="panel" style="margin-top: 16px;">
                  <div class="panel-header">
                    <div class="panel-title">批量添加端点</div>
                  </div>
                  <div>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                      每行一个端点，格式：<code>名称:API地址:API_Key</code> 或 JSON 格式
                    </p>
                    <textarea v-model="openaiBatchText" class="form-textarea" placeholder='每行一个，格式: 名称:https://api.example.com:sk-xxx
或 JSON 格式:
[{"name": "示例", "baseUrl": "https://api.example.com", "apiKey": "sk-xxx"}]'
                      style="min-height: 150px; font-family: monospace; font-size: 12px;"></textarea>
                    <div v-if="openaiBatchError" class="form-error" style="margin-top: 8px;">{{ openaiBatchError }}
                    </div>
                    <div v-if="openaiBatchSuccess" class="form-success" style="margin-top: 8px;">{{ openaiBatchSuccess
                      }}
                    </div>
                    <button class="btn btn-primary" @click="batchAddOpenaiEndpoints" :disabled="openaiAdding"
                      style="width: 100%; margin-top: 12px;">
                      {{ openaiAdding ? '添加中...' : '批量添加' }}
                    </button>
                  </div>
                </div>
              </div>

              <!-- 添加/编辑端点模态框 -->
              <div v-if="showOpenaiEndpointModal" class="modal-overlay" @keydown.esc="showOpenaiEndpointModal = false"
                @keydown.ctrl.enter="saveOpenaiEndpoint" tabindex="-1">
                <div class="modal">
                  <div class="modal-header">
                    <div class="modal-title">{{ openaiEditingEndpoint ? '编辑 API 端点' : '添加 API 端点' }}</div>
                    <button class="modal-close" @click="showOpenaiEndpointModal = false">&times;</button>
                  </div>

                  <div class="form-group">
                    <label class="form-label">名称</label>
                    <input v-model="openaiEndpointForm.name" class="form-input" placeholder="例如: OpenAI 官方" />
                  </div>

                  <div class="form-group">
                    <label class="form-label">API 地址 *</label>
                    <input v-model="openaiEndpointForm.baseUrl" class="form-input"
                      placeholder="https://api.openai.com" />
                    <div class="form-help">OpenAI 兼容的 API 基础地址（不需要 /v1）</div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">API Key *</label>
                    <input v-model="openaiEndpointForm.apiKey" type="text" class="form-input" placeholder="sk-xxxxxxxx"
                      style="font-family: monospace;" />
                  </div>

                  <div class="form-group">
                    <label class="form-label">备注</label>
                    <textarea v-model="openaiEndpointForm.notes" class="form-textarea" placeholder="可选备注信息"
                      style="min-height: 60px;"></textarea>
                  </div>

                  <div v-if="openaiEndpointFormError" class="form-error">{{ openaiEndpointFormError }}</div>

                  <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button class="btn btn-primary" @click="saveOpenaiEndpoint" :disabled="openaiSaving"
                      style="flex: 1;">
                      {{ openaiSaving ? '保存中...' : '保存' }}
                    </button>
                    <button class="btn btn-secondary" @click="showOpenaiEndpointModal = false"
                      style="flex: 1;">取消</button>
                  </div>
                </div>
              </div>

            </div>
            <!-- ==================== OpenAI API 管理部分结束 ==================== -->

            <!-- ==================== 主机管理部分 ==================== -->
            <div v-show="mainActiveTab === 'server'" class="tab-content server-tab-content"
              :class="getTabAnimationClass('server')">
              <!-- 主机子标签页 -->
              <div class="sec-tabs server-sec-tabs">
                <button class="tab-btn" :class="{ active: serverCurrentTab === 'list' }"
                  @click="serverCurrentTab = 'list'" style="background: var(--server-primary) !important;"
                  v-if="serverCurrentTab === 'list'">
                  <i class="fas fa-server"></i> 主机列表
                </button>
                <button class="tab-btn" :class="{ active: serverCurrentTab === 'list' }"
                  @click="serverCurrentTab = 'list'" v-else>
                  <i class="fas fa-server"></i> 主机列表
                </button>
                <button class="tab-btn" :class="{ active: serverCurrentTab === 'management' }"
                  @click="serverCurrentTab = 'management'" style="background: var(--server-primary) !important;"
                  v-if="serverCurrentTab === 'management'">
                  <i class="fas fa-cog"></i> 后台管理
                </button>
                <button class="tab-btn" :class="{ active: serverCurrentTab === 'management' }"
                  @click="serverCurrentTab = 'management'" v-else>
                  <i class="fas fa-cog"></i> 后台管理
                </button>
                <!-- 动态SSH终端标签页 -->
                <template v-for="session in sshSessions" :key="session.id">
                  <button class="tab-btn ssh-session-tab" :class="{ active: serverCurrentTab === 'ssh_' + session.id }"
                    @click="switchToSSHTab(session.id)" @dblclick.stop="closeSSHSession(session.id)"
                    @mousedown.middle.prevent.stop="closeSSHSession(session.id)">
                    <i class="fas fa-terminal"></i>
                    <span>{{ session.server.name }}</span>
                    <!-- <span class="ssh-tab-close" @click.stop="closeSSHSession(session.id)" title="关闭">×</span> -->
                  </button>
                </template>
                <!-- 新建SSH终端按钮 -->
                <button class="tab-btn ssh-add-tab" @click="showAddSessionModal" title="新建SSH终端"
                  v-if="serverList.length > 0">
                  <i class="fas fa-plus"></i>
                </button>
              </div>

              <!-- 主机列表标签页 -->
              <div v-show="serverCurrentTab === 'list'" class="sub-tab-content quick-fade-in">
                <!-- 主机控制条 -->
                <div class="controls-bar">
                  <div class="controls-row">
                    <div class="search-box">
                      <i class="fas fa-search"></i>
                      <input v-model="serverSearchText" placeholder="搜索名称、IP 或标签..." class="form-input" />
                    </div>

                    <div class="stats-pills">
                      <div class="stat-pill" :class="{ active: serverStatusFilter === 'all' }"
                        @click="serverStatusFilter = 'all'">
                        <span class="label">全部</span>
                        <span class="value">{{ serverList.length }}</span>
                      </div>
                      <div class="stat-pill online" :class="{ active: serverStatusFilter === 'online' }"
                        @click="serverStatusFilter = serverStatusFilter === 'online' ? 'all' : 'online'">
                        <span class="label">在线</span>
                        <span class="value">{{ serverList.filter(s => s.status === 'online').length }}</span>
                      </div>
                      <div class="stat-pill offline" :class="{ active: serverStatusFilter === 'offline' }"
                        @click="serverStatusFilter = serverStatusFilter === 'offline' ? 'all' : 'offline'">
                        <span class="label">离线</span>
                        <span class="value">{{ serverList.filter(s => s.status === 'offline').length }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="controls-row">
                    <div style="display: flex; gap: 10px; align-items: center;">
                      <button class="btn btn-primary" @click="loadServerList" :disabled="serverLoading">
                        <i class="fas fa-sync-alt" :class="{ 'fa-spin': serverLoading }"></i>
                        刷新状态
                      </button>
                    </div>

                    <div class="refresh-info">
                      <div v-if="serverPollingEnabled" style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <span style="font-size: 12px; color: var(--text-tertiary);">
                          <i class="fas fa-clock" style="margin-right: 4px;"></i>
                          {{ serverRefreshCountdown }} 秒后刷新
                        </span>
                        <div class="refresh-progress" style="flex: 1; max-width: 100px;">
                          <div class="refresh-progress-bar" :style="{ width: serverRefreshProgress + '%' }"></div>
                        </div>
                      </div>
                      <button class="btn btn-secondary icon-only"
                        @click="serverPollingEnabled = !serverPollingEnabled; serverPollingEnabled ? startServerPolling() : stopServerPolling()"
                        :title="serverPollingEnabled ? '暂停自动监测' : '开启自动监测'">
                        <i class="fas" :class="serverPollingEnabled ? 'fa-pause' : 'fa-play'"></i>
                      </button>
                      <button class="btn btn-secondary" style="padding: 6px 12px; min-width: 100px;"
                        @click="probeAllServers" :disabled="probeStatus === 'loading'">
                        <i v-if="probeStatus === 'success'" class="fas fa-check" style="margin-right: 4px;"></i>
                        <i v-else-if="probeStatus === 'error'" class="fas fa-times"
                          style="color: var(--danger-color); margin-right: 4px;"></i>
                        <i v-else class="fas" :class="{
                    'fa-heartbeat': probeStatus !== 'loading',
                    'fa-spinner fa-spin': probeStatus === 'loading'
                  }"></i>
                        批量拨测
                      </button>
                    </div>
                  </div>
                </div>

                <div v-if="serverLoading && serverList.length === 0" class="loading">
                  <div class="spinner" style="margin-bottom: 12px;"></div>
                  <p>正在同步主机状态...</p>
                </div>

                <!-- 主机卡片列表 -->
                <div v-for="server in filteredServerList" :key="server.id" class="server-card"
                  :class="{ expanded: isServerExpanded(server.id) }">
                  <div class="server-card-header" @click="toggleServer(server.id)">
                    <div class="server-card-info">
                      <div class="server-status-indicator" :class="server.status || 'unknown'"></div>
                      <div style="flex: 1; min-width: 0;">
                        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                          <span class="server-name">{{ server.name }}</span>
                          <span v-if="server.last_check_time"
                            style="font-size: 11px; color: var(--text-tertiary); display: inline-flex; align-items: center; gap: 4px;"
                            title="最近更新时间">
                            <i class="far fa-clock"></i>
                            {{ formatDateTime(server.last_check_time) }}
                          </span>
                          <span v-if="server.response_time"
                            style="font-size: 11px; color: var(--text-tertiary); display: inline-flex; align-items: center; gap: 4px;"
                            title="响应时间">
                            <i class="fas fa-bolt" style="font-size: 10px;"></i>
                            {{ server.response_time }}ms
                          </span>
                        </div>
                        <div class="server-host">{{ server.username }}@{{ server.host }}:{{ server.port }}</div>
                      </div>
                    </div>

                    <div style="display: flex; align-items: center; gap: 12px;" class="header-right">
                      <div class="server-tags" style="margin-top: 0; display: flex; gap: 4px;"
                        v-if="server.tags && server.tags.length > 0">
                        <span v-for="tag in server.tags" :key="tag" class="server-tag">{{ tag }}</span>
                      </div>

                      <div class="account-balance" style="gap: 6px;">
                        <button class="btn btn-sm btn-secondary icon-only" @click.stop="refreshServerInfo(server.id)"
                          title="刷新状态">
                          <i class="fas" :class="server.loading ? 'fa-spinner fa-spin' : 'fa-sync-alt'"></i>
                        </button>
                        <button class="btn btn-sm btn-primary" @click.stop="openSSHTerminal(server)" title="SSH 连接">
                          <i class="fas fa-terminal"></i>
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- 卡片展开详情区域 -->
                  <div class="server-card-body">
                    <div class="divider" style="margin: 0; opacity: 0.5;"></div>
                    <div class="server-details" style="border: none; padding: 8px 3px;">

                      <div v-if="server.loading" class="loading" style="padding: 8px 3px;">
                        <div class="spinner-sm"></div>
                        <p style="margin-top: 10px; font-size: 12px;">正在获取实时负载参数...</p>
                      </div>

                      <div v-else-if="server.error" class="error" style="margin: 0px 3px;">
                        <i class="fas fa-exclamation-circle"></i> {{ server.error }}
                      </div>

                      <div v-else-if="server.info">
                        <!-- 主要信息网格 -->
                        <div class="server-details-grid">
                          <!-- 系统信息 -->
                          <div class="server-detail-section">
                            <h4><i class="fas fa-microchip"></i> 硬件载荷</h4>
                            <div class="server-detail-item">
                              <span class="server-detail-label">CPU 负载 ({{ server.info.cpu.Cores }} 核心)</span>
                              <span class="server-detail-value">{{ server.info.cpu.Usage }}</span>
                            </div>
                            <div class="progress-bar">
                              <div class="progress-bar-fill" :style="{ width: server.info.cpu.Usage }"></div>
                            </div>

                            <div class="server-detail-item" style="margin-top: 12px;">
                              <span class="server-detail-label">内存使用 ({{ server.info.memory.Used }} / {{
                                server.info.memory.Total }})</span>
                              <span class="server-detail-value">{{ server.info.memory.Usage }}</span>
                            </div>
                            <div class="progress-bar">
                              <div class="progress-bar-fill" :class="getMemoryClass(server.info.memory.Usage)"
                                :style="{ width: server.info.memory.Usage }"></div>
                            </div>
                          </div>

                          <!-- 存储资源 -->
                          <div class="server-detail-section">
                            <h4><i class="fas fa-database"></i> 存储资源</h4>
                            <!-- 只显示主分区或第一个分区 -->
                            <div v-if="server.info.disk && server.info.disk.length > 0">
                              <div class="server-detail-item">
                                <span class="server-detail-label">主存储 ({{ server.info.disk[0].device }})</span>
                                <span class="server-detail-value">{{ server.info.disk[0].used }} / {{
                                  server.info.disk[0].total }}</span>
                              </div>
                              <div class="progress-bar">
                                <div class="progress-bar-fill" :class="getDiskClass(server.info.disk[0].usage)"
                                  :style="{ width: server.info.disk[0].usage }"></div>
                              </div>
                              <div class="server-detail-item" style="border:none; padding: 4px 0 0 0;">
                                <span class="server-detail-value" style="font-size: 11px; opacity: 0.7;">使用率: {{
                                  server.info.disk[0].usage }}</span>
                              </div>
                            </div>
                          </div>

                          <!-- 节点概览 -->
                          <div class="server-detail-section">
                            <h4><i class="fas fa-info-circle"></i> 系统摘要</h4>
                            <div v-for="(value, key) in server.info.system" :key="key" class="server-detail-item"
                              style="padding: 4px 0;">
                              <span class="server-detail-label">{{ translateInfoKey(key) }}</span>
                              <span class="server-detail-value">{{ key === 'Uptime' ? formatUptime(value) : value
                                }}</span>
                            </div>
                          </div>
                        </div>

                        <!-- 容器虚拟化 - 可折叠面板 -->
                        <div class="server-detail-section docker-section">
                          <div class="docker-section-header" @click.stop="toggleDockerPanel(server.id)"
                            style="cursor: pointer;">
                            <h4>
                              <i class="fab fa-docker"></i> 容器虚拟化
                              <i class="fas fa-chevron-right toggle-icon"
                                :style="{ transform: isDockerPanelExpanded(server.id) ? 'rotate(90deg)' : 'rotate(0deg)' }"></i>
                            </h4>
                            <div class="docker-section-status">
                              <span class="docker-status-badge"
                                :class="server.info.docker.installed ? 'installed' : 'not-installed'">
                                {{ server.info.docker.installed ? '已安装' : '未检测到' }}
                              </span>
                              <span v-if="server.info.docker.installed && server.info.docker.containers.length > 0"
                                class="docker-container-count">
                                <span style="color: var(--success-color);">●</span>
                                {{ getRunningContainers(server.info.docker.containers) }} 运行
                                <span v-if="getPausedContainers(server.info.docker.containers) > 0"
                                  style="margin-left: 8px; color: var(--warning-color);">●</span>
                                <span v-if="getPausedContainers(server.info.docker.containers) > 0">
                                  {{ getPausedContainers(server.info.docker.containers) }} 暂停
                                </span>
                              </span>
                            </div>
                          </div>

                          <!-- 展开的容器面板 - 使用类似 modal 的样式 -->
                          <div v-if="isDockerPanelExpanded(server.id) && server.info.docker.installed"
                            class="docker-panel-content">
                            <div v-if="server.info.docker.containers.length > 0" class="docker-containers-grid">
                              <div v-for="container in server.info.docker.containers" :key="container.id"
                                class="docker-container-mini-card" :class="{ 
                            'running': container.status.includes('Up') && !container.status.includes('Paused'),
                            'paused': container.status.includes('Paused')
                          }">
                                <div class="container-info">
                                  <span class="container-status-dot"
                                    :class="{ 'online': container.status.includes('Up') && !container.status.includes('Paused'), 'paused': container.status.includes('Paused') }"></span>
                                  <span class="container-name" :title="container.name">{{ container.name }}</span>
                                </div>
                                <div class="container-actions">
                                  <button v-if="container.status.includes('Up') && !container.status.includes('Paused')"
                                    class="btn btn-xs btn-warning icon-only"
                                    @click.stop="handleDockerAction(server.id, container.id, 'pause')" title="暂停">
                                    <i class="fas fa-pause"></i>
                                  </button>
                                  <button v-else-if="container.status.includes('Paused')"
                                    class="btn btn-xs btn-success icon-only"
                                    @click.stop="handleDockerAction(server.id, container.id, 'unpause')" title="恢复">
                                    <i class="fas fa-play"></i>
                                  </button>
                                  <button v-else class="btn btn-xs btn-success icon-only"
                                    @click.stop="handleDockerAction(server.id, container.id, 'start')" title="启动">
                                    <i class="fas fa-play"></i>
                                  </button>
                                  <button class="btn btn-xs btn-secondary icon-only"
                                    @click.stop="handleDockerAction(server.id, container.id, 'restart')" title="重启">
                                    <i class="fas fa-redo-alt"></i>
                                  </button>
                                </div>
                              </div>
                            </div>
                            <div v-else class="docker-empty-mini">
                              <i class="fab fa-docker"></i>
                              <span>暂无容器</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div v-if="!serverLoading && filteredServerList.length === 0" class="empty-state">
                  <div class="server-empty-state-icon">🔍</div>
                  <p>未找到符合条件的主机</p>
                </div>
              </div>

              <!-- 后台管理标签页 -->
              <div v-show="serverCurrentTab === 'management'" class="sub-tab-content quick-fade-in">
                <!-- 主机管理面板 -->
                <div class="panel">
                  <div class="panel-header" style="flex-wrap: wrap; gap: 8px;">
                    <!-- <div class="panel-title"></div> -->
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                      <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddServerModal">
                        <i class="fas fa-plus"></i> 添加主机
                      </button>
                      <button class="btn btn-server" style="padding: 6px 10px;" @click="loadServerList"
                        :disabled="serverLoading">
                        <i class="fas fa-sync-alt" :class="{ 'fa-spin': serverLoading }"></i>
                      </button>
                      <button class="btn btn-server" style="padding: 6px 12px; min-width: 100px;"
                        @click="probeAllServers" :disabled="probeStatus === 'loading'">
                        <i v-if="probeStatus === 'success'" class="fas fa-check" style="margin-right: 4px;"></i>
                        <i v-else-if="probeStatus === 'error'" class="fas fa-times"
                          style="color: var(--danger-color); margin-right: 4px;"></i>
                        <i v-else class="fas" :class="{
                    'fa-heartbeat': probeStatus !== 'loading',
                    'fa-spinner fa-spin': probeStatus === 'loading'
                  }"></i>
                        批量拨测
                      </button>
                      <button class="btn btn-server" style="padding: 6px 12px;" @click="exportServers">
                        <i class="fas fa-upload"></i> 导出
                      </button>
                      <button class="btn btn-server" style="padding: 6px 12px;" @click="openImportServerModal">
                        <i class="fas fa-download"></i> 导入
                      </button>
                    </div>
                  </div>

                  <div v-if="serverLoading" class="loading">
                    <div class="spinner"></div>
                    <div style="margin-top: 12px;">加载中...</div>
                  </div>

                  <div v-else class="table-container">
                    <table class="data-table">
                      <thead>
                        <tr>
                          <th>状态</th>
                          <th>主机名称</th>
                          <th>主机地址</th>
                          <th>响应</th>
                          <th>最后检查</th>
                          <th style="width: 180px;">操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr v-for="server in serverList" :key="server.id">
                          <td>
                            <span class="proxied-badge"
                              :class="server.status === 'online' ? 'proxied-on' : (server.status === 'offline' ? 'proxied-off' : '')">
                              {{ server.status === 'online' ? '在线' : (server.status === 'offline' ? '离线' : '未知') }}
                            </span>
                          </td>
                          <td>
                            <strong>{{ server.name }}</strong>
                          </td>
                          <td>
                            <code
                              style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; font-size: 11px;">
                        {{ server.username }}@{{ server.host }}:{{ server.port }}
                      </code>
                          </td>
                          <td><span v-if="server.response_time" style="font-family: monospace;">{{ server.response_time
                              }}ms</span><span v-else>-</span></td>
                          <td style="font-size: 11px; opacity: 0.8;">{{ server.last_check_time ?
                            formatDateTime(server.last_check_time) : '从未检查' }}</td>
                          <td class="actions">
                            <button class="btn btn-sm btn-secondary icon-only" @click="openEditServerModal(server.id)"
                              title="编辑"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-secondary icon-only" @click="rebootServerById(server.id)"
                              title="重启"><i class="fas fa-redo"></i></button>
                            <button class="btn btn-sm btn-danger icon-only" @click="deleteServerById(server.id)"
                              title="删除"><i class="fas fa-trash"></i></button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div v-if="serverList.length === 0" class="empty-state">
                      <i class="fas fa-server" style="font-size: 48px; margin-bottom: 16px;"></i>
                      <div>暂无主机，点击上方按钮添加</div>
                    </div>
                  </div>
                </div>

                <!-- 批量添加主机 -->
                <div class="panel" style="margin-top: 16px;">
                  <div class="panel-header">
                    <div class="panel-title">批量添加主机</div>
                  </div>
                  <div>
                    <textarea v-model="serverBatchText" class="form-textarea" placeholder="例如：
Web服务器,192.168.1.100,22,root,password123
数据库服务器,192.168.1.101,22,root,secure_pass"
                      style="min-height: 150px; font-family: monospace; font-size: 12px; white-space: pre;"></textarea>
                    <div v-if="serverBatchError" class="form-error" style="margin-top: 8px;">{{ serverBatchError }}
                    </div>
                    <div v-if="serverBatchSuccess" class="form-success" style="margin-top: 8px;">{{ serverBatchSuccess
                      }}
                    </div>
                    <button class="btn btn-primary" @click="batchAddServers" :disabled="serverAddingBatch"
                      style="width: 100%; margin-top: 12px;">
                      {{ serverAddingBatch ? '添加中...' : '批量添加' }}
                    </button>
                  </div>
                </div>

                <!-- 批量添加 -->
                <div class="panel" style="margin-top: 16px;">
                  <div class="panel-header">
                    <div class="panel-title">快捷配置</div>
                  </div>
                  <div class="secondary-config-row" style="padding: 1px;">
                    <!-- 监控全局配置 -->
                    <div class="config-card">
                      <div class="config-card-title">
                        <i class="fas fa-clock"></i> 自动拨测策略
                      </div>
                      <div class="form-row">
                        <div class="form-group flex-1">
                          <label>探测周期 (S)</label>
                          <input type="number" v-model="monitorConfig.interval" class="form-input" min="10" />
                        </div>
                        <div class="form-group flex-1">
                          <label>响应超时 (S)</label>
                          <input type="number" v-model="monitorConfig.timeout" class="form-input" min="1" />
                        </div>
                        <div class="form-group flex-1">
                          <label>日志存量 (天)</label>
                          <input type="number" v-model="monitorConfig.logRetentionDays" class="form-input" min="1" />
                        </div>
                      </div>
                      <button @click="saveMonitorConfig" class="btn btn-primary" :disabled="monitorConfigSaving"
                        style="width: 100%;">
                        <i class="fas" :class="monitorConfigSaving ? 'fa-spinner fa-spin' : 'fa-save'"></i>
                        同步配置
                      </button>
                    </div>

                    <!-- 主机凭据管理 -->
                    <div class="config-card">
                      <div class="config-card-title">
                        <i class="fas fa-shield-alt"></i> 预设访问凭据
                        <button class="btn btn-success btn-sm" style="margin-left: auto; padding: 4px 10px;"
                          @click="showAddCredentialModal = true">
                          <!-- <i class="fas fa-plus"></i>  -->
                          添加
                        </button>
                      </div>
                      <div v-if="serverCredentials.length > 0" class="credential-list" style="margin-top: 10px;">
                        <div v-for="cred in serverCredentials" :key="cred.id" class="credential-item">
                          <div class="cred-info">
                            <span class="cred-name">
                              {{ cred.name }}
                              <span class="cred-user">{{ cred.username }}</span>
                            </span>
                          </div>
                          <div class="cred-actions">
                            <button v-if="!cred.is_default" class="btn btn-sm btn-secondary"
                              style="padding: 2px 8px; font-size: 15px; margin-right: 6px;"
                              @click="setDefaultCredential(cred.id)" title="设为默认">
                              <i class="fas fa-star"></i>
                            </button>
                            <i class="fas fa-trash text-danger" @click="deleteCredential(cred.id)"
                              style="cursor: pointer;"></i>
                          </div>
                        </div>
                      </div>
                      <div v-else class="empty-mini" style="margin-top: 10px;">
                        <i class="fas fa-shield-alt"></i>
                        <span>暂无预设凭据</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- SSH 终端子标签页内容 - 使用v-show保持连接 -->
              <template v-for="session in sshSessions" :key="'content-' + session.id">
                <div v-show="serverCurrentTab === 'ssh_' + session.id" class="sub-tab-content ssh-tab-content">
                  <!-- 使用 panel 布局 -->
                  <div class="panel">
                    <div class="panel-header">
                      <div class="panel-title"></div>
                      <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" style="padding: 6px 12px;"
                          @click="reconnectSSHSession(session.id)" :disabled="session.connected" title="重新连接">
                          <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="btn btn-danger" style="padding: 6px 12px;" @click="closeSSHSession(session.id)"
                          title="关闭会话">
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </div>

                    <!-- 内容容器 -->
                    <div class="ssh-content-wrapper">
                      <!-- 终端视图 -->
                      <div class="ssh-terminal-container">
                        <div :id="'ssh-terminal-' + session.id" class="ssh-terminal-pane-embedded"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>

            </div>
            <!-- ==================== 主机管理部分结束 ==================== -->

            <!-- ==================== Antigravity 管理部分 ==================== -->
            <div v-if="mainActiveTab === 'antigravity'" class="tab-content antigravity-tab-content"
              :class="getTabAnimationClass('antigravity')">

              <!-- Antigravity 子标签栏 -->
              <div class="sec-tabs">
                <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'quotas' }"
                  @click="switchAntigravityTab('quotas')">
                  <i class="fas fa-chart-pie"></i> 额度使用
                </button>
                <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'accounts' }"
                  @click="switchAntigravityTab('accounts')">
                  <i class="fas fa-list"></i> 账号管理
                </button>
                <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'logs' }"
                  @click="switchAntigravityTab('logs')">
                  <i class="fas fa-history"></i> 调用日志
                </button>
                <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'settings' }"
                  @click="switchAntigravityTab('settings')">
                  <i class="fas fa-cog"></i> 模块配置
                </button>
              </div>

              <!-- 账号管理列表 -->
              <!-- 凭证列表 (Accounts) -->
              <div v-show="antigravityCurrentTab === 'accounts'" class="sub-tab-content quick-fade-in">
                <div class="panel">
                  <div class="panel-header">
                    <div style="display: flex; gap: 8px;">
                      <button class="btn btn-primary" @click="showOAuthExpand = !showOAuthExpand"
                        style="background: linear-gradient(135deg, #4285F4, #34A853);">
                        <i class="fab fa-google"></i> OAuth 授权
                      </button>
                      <button class="btn btn-success" @click="openAddAntigravityManualModal">
                        <i class="fas fa-plus"></i> 手动添加
                      </button>
                      <button class="btn btn-secondary" @click="refreshAllAgAccounts" title="刷新全部凭证">
                        <i class="fas fa-sync-alt" :class="{ 'fa-spin': agRefreshingAll }"></i>
                      </button>
                    </div>
                  </div>

                  <!-- Expandable OAuth Panel -->
                  <div class="ag-expandable-panel" :class="{ expanded: showOAuthExpand }">
                    <div class="panel-header" style="border-bottom: none; padding-bottom: 0;">
                      <div class="panel-title" style="width: 100%; text-align: center; padding-top: 10px;">连接 Google 账号
                      </div>
                    </div>

                    <div class="oauth-modern-body">
                      <!-- Step 1 -->
                      <div class="oauth-step-item">
                        <div class="step-badge">1</div>
                        <div class="step-content">
                          <div class="step-text">登录 Google 以获取授权码</div>
                          <button class="btn btn-ag btn-block" @click="openGoogleAuthUrl">
                            <i class="fab fa-google"></i> 获取授权链接
                          </button>
                        </div>
                      </div>

                      <!-- Divider -->
                      <div class="oauth-step-line"></div>

                      <!-- Step 2 -->
                      <div class="oauth-step-item">
                        <div class="step-badge">2</div>
                        <div class="step-content">
                          <div class="step-text">在下方粘贴重定向后的 URL</div>
                          <textarea v-model="agOauthUrl" class="form-textarea oauth-textarea"
                            placeholder="粘贴以 http:// 开头的完整 URL..." spellcheck="false"></textarea>
                        </div>
                      </div>

                      <!-- Options -->
                      <div class="oauth-options">
                        <div class="oauth-option-row">
                          <input type="text" v-model="agCustomProjectId" class="form-input input-sm"
                            placeholder="自定义项目 ID (可选)">
                          <div style="display: flex; align-items: center; gap: 8px;">
                            <label class="switch">
                              <input type="checkbox" v-model="agAllowRandomProjectId">
                              <span class="slider round"></span>
                            </label>
                            <span style="font-size: 12px; color: var(--text-secondary);">允许随机 ID</span>
                          </div>
                        </div>
                      </div>

                      <!-- Action -->
                      <button class="btn btn-success btn-block btn-lg mt-3" @click="parseAgOauthUrl"
                        :disabled="!agOauthUrl || antigravityLoading">
                        <i class="fas" :class="antigravityLoading ? 'fa-spinner fa-spin' : 'fa-link'"></i>
                        {{ antigravityLoading ? '验证中...' : '验证并连接' }}
                      </button>
                    </div>
                  </div>

                  <!-- 统计信息栏 -->
                  <div v-if="antigravityStats" class="stats-bar"
                    style="display: flex; gap: 20px; padding: 12px 16px; background: var(--bg-secondary); margin-bottom: 2px; border-radius: 8px; font-size: 13px;">
                    <div class="stat-item">
                      <span style="opacity: 0.7;">总 Token:</span>
                      <strong style="margin-left: 4px;">{{ antigravityStats.total || 0 }}</strong>
                    </div>
                    <div class="stat-item">
                      <span style="opacity: 0.7;">在线:</span>
                      <strong style="margin-left: 4px; color: var(--success-color);">{{ antigravityStats.online || 0
                        }}</strong>
                    </div>
                    <div class="stat-item">
                      <span style="opacity: 0.7;">无效:</span>
                      <strong style="margin-left: 4px; color: var(--danger-color);">{{ antigravityStats.disabled || 0
                        }}</strong>
                    </div>
                  </div>


                  <div v-if="antigravityLoading && antigravityAccounts.length === 0" class="loading">
                    <div class="spinner"></div>
                    <div style="margin-top: 12px;">加载中...</div>
                  </div>

                  <div v-else class="table-container">
                    <table class="data-table">
                      <thead>
                        <tr>
                          <th>备注名称</th>
                          <th>项目 ID</th>
                          <th>邮箱</th>
                          <th style="width: 100px;">调用统计</th>
                          <th>状态</th>
                          <th style="width: 140px;">操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr v-for="account in antigravityAccounts" :key="account.id">
                          <td><strong>{{ account.name || '未命名' }}</strong></td>
                          <td><code class="code-sm">{{ account.projectId || '-' }}</code></td>
                          <td><span style="font-size: 11px; opacity: 0.7;">{{ account.email || '-' }}</span></td>
                          <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                              <span style="color: var(--success-color); font-weight: 700; font-size: 13px;">{{
                                account.success_count || 0 }}</span>
                              <div style="width: 1px; height: 10px; background: var(--border-color); opacity: 0.5;">
                              </div>
                              <span style="color: var(--danger-color); font-weight: 700; font-size: 13px;">{{
                                account.error_count || 0 }}</span>
                            </div>
                          </td>
                          <td>
                            <span class="ag-status-badge"
                              :class="account.status === 'online' ? 'ag-status-online' : (account.status === 'error' ? 'ag-status-error' : 'ag-status-unknown')">
                              {{ account.status === 'online' ? '在线' : (account.status === 'error' ? '异常' : '未知') }}
                            </span>
                          </td>
                          <td class="actions">
                            <div style="display: flex; align-items: center; gap: 8px;">
                              <button class="btn btn-sm icon-only" @click="toggleAntigravityAccount(account)"
                                :title="account.enable ? '点击停用' : '点击启用'"
                                :class="account.enable ? 'btn-success' : 'btn-secondary'">
                                <i class="fas" :class="account.enable ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
                              </button>
                              <button class="btn btn-sm btn-secondary icon-only"
                                @click="editAntigravityAccount(account)" title="编辑">
                                <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-danger icon-only" @click="deleteAntigravityAccount(account)"
                                title="删除">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div v-if="antigravityAccounts.length === 0" class="empty-state">
                      <i class="fas fa-atom" style="font-size: 48px; margin-bottom: 16px;"></i>
                      <div>暂无账号，点击上方按钮新增授权</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 凭证用量 (Usage/Quotas) -->
              <div v-show="antigravityCurrentTab === 'quotas'" class="sub-tab-content quick-fade-in">
                <div class="panel-header" style="justify-content: space-between; padding-bottom: 10px;">
                  <div style="display: flex; gap: 16px; align-items: center;">
                    <div class="panel-title">额度状态</div>
                    <select class="ag-account-selector" v-model="antigravityQuotaSelectedAccountId"
                      @change="loadAntigravityQuotas()" style="padding-left: 8px; width: 180px;">
                      <option v-for="acc in antigravityAccounts" :key="acc.id" :value="acc.id">
                        {{ acc.name }} ({{ acc.status === 'online' ? '在线' : '离线' }})
                      </option>
                    </select>
                  </div>
                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-secondary btn-sm" @click="toggleAntigravityQuotaView()" title="切换视图">
                      <i class="fas" :class="antigravityQuotaViewMode === 'list' ? 'fa-th-large' : 'fa-list'"></i>
                      {{ antigravityQuotaViewMode === 'list' ? '分组视图' : '列表视图' }}
                    </button>
                    <button class="btn btn-secondary btn-sm" @click="loadAntigravityQuotas(false)"
                      :disabled="antigravityQuotaLoading">
                      <i class="fas fa-sync-alt" :class="{ 'fa-spin': antigravityQuotaLoading }"></i> 刷新额度
                    </button>
                  </div>
                </div>

                <div v-if="antigravityQuotaLoading && Object.keys(antigravityQuotas).length === 0" class="loading">
                  <div class="spinner"></div>
                  <div style="margin-top: 12px;">正在获取额度详情...</div>
                </div>

                <div v-else>
                  <!-- 分组视图 (Cards) -->
                  <div v-if="antigravityQuotaViewMode === 'grouped'" class="ag-quota-grid quick-fade-in">
                    <div v-for="(group, groupId) in antigravityQuotas" :key="groupId" class="quota-card">
                      <div class="panel-header"
                        style="background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); padding: 8px 12px;">
                        <div class="panel-title" style="font-size: 14px; gap: 8px;">
                          <span style="font-size: 18px;">{{ group.icon }}</span>
                          <span>{{ group.name }}</span>
                        </div>
                        <div v-if="group.remaining !== undefined" class="ag-status-badge"
                          :style="{ color: getAgQuotaColor(group.remaining), borderColor: getAgQuotaColor(group.remaining) }">
                          {{ group.remaining }}%
                        </div>
                      </div>
                      <div style="padding: 12px;">
                        <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 10px;">{{
                          group.description
                          }}</div>

                        <!-- 主进度条 (如果是分组) -->
                        <div v-if="group.remaining !== undefined" class="quota-progress-container"
                          style="margin-bottom: 12px;">
                          <div class="progress-bar-compact" style="height: 10px;">
                            <div class="progress-bar-fill"
                              :style="{ width: group.remaining + '%', background: getAgQuotaColor(group.remaining) }">
                            </div>
                          </div>
                        </div>

                        <!-- 重置时间 -->
                        <div v-if="group.resetTime"
                          style="font-size: 11px; color: var(--text-secondary); margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
                          <i class="far fa-clock"></i>
                          <span>重置: {{ group.resetTime }} <span style="opacity: 0.8;">({{
                              formatResetCountdown(group.resetTime)
                              }})</span></span>
                        </div>

                        <!-- 细分模型列表 (可选展开，或直接紧凑列出) -->
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                          <div v-for="model in group.models" :key="model.id"
                            style="display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; background: var(--bg-tertiary); border-radius: 6px; font-size: 12px;">
                            <div style="display: flex; align-items: center; gap: 6px; flex: 1; min-width: 0;">
                              <span
                                style="font-family: monospace; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                :title="model.id">{{ model.id }}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                              <span :style="{ color: getAgQuotaColor(model.remaining) }" style="font-weight: 600;">{{
                                model.remaining }}%</span>
                              <label class="switch">
                                <input type="checkbox" :checked="model.enabled !== false"
                                  @change="toggleModelStatus(model, $event)">
                                <span class="slider round"></span>
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- 列表视图 (Table) -->
                  <div v-else class="ag-quota-list-view quick-fade-in">
                    <div class="panel">
                      <div class="table-container">
                        <table class="data-table">
                          <thead>
                            <tr>
                              <th style="width: 250px;">模型 ID</th>
                              <th>分组</th>
                              <th>剩余额度</th>
                              <th style="width: 180px; text-align: center;">重置时间</th>
                              <th style="width: 80px; text-align: center;">开关</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr v-for="model in getAllAntigravityModels()" :key="model.id"
                              :style="{ opacity: model.enabled === false ? 0.5 : 1, filter: model.enabled === false ? 'grayscale(100%)' : 'none', background: model.enabled === false ? 'var(--bg-tertiary)' : 'inherit' }">
                              <td style="font-family: monospace; font-weight: 600;">{{ model.id }}</td>
                              <td>{{ model.groupIcon }} {{ model.groupName }}</td>
                              <td>
                                <div class="quota-progress-container" style="width: 100%;">
                                  <div class="progress-bar-compact">
                                    <div class="progress-bar-fill"
                                      :style="{ width: model.remaining + '%', background: getAgQuotaColor(model.remaining) }">
                                    </div>
                                  </div>
                                  <span class="quota-percent" style="margin-left: 10px; width: 40px; text-align: right;"
                                    :style="{ color: getAgQuotaColor(model.remaining) }">{{ model.remaining }}%</span>
                                </div>
                              </td>
                              <td style="text-align: center; font-size: 12px;">
                                {{ model.resetTime }} <span style="opacity: 0.7; font-size: 0.9em;">({{
                                  formatResetCountdown(model.resetTime) }})</span>
                              </td>
                              <td style="text-align: center;">
                                <label class="switch">
                                  <input type="checkbox" :checked="model.enabled !== false"
                                    @change="toggleModelStatus(model, $event)">
                                  <span class="slider round"></span>
                                </label>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 调用日志 (Logs) -->
              <div v-show="antigravityCurrentTab === 'logs'" class="sub-tab-content quick-fade-in">
                <div class="panel">
                  <div class="panel-header">
                    <div style="display: flex; gap: 8px;">
                      <button class="btn btn-secondary btn-sm" @click="loadAntigravityLogs">
                        <i class="fas fa-sync-alt" :class="{ 'fa-spin': antigravityLoading }"></i> 刷新
                      </button>
                      <button class="btn btn-danger btn-sm" @click="clearAntigravityLogs">清空</button>
                    </div>
                  </div>
                  <div class="table-container">
                    <table class="data-table">
                      <thead>
                        <tr>
                          <th>时间</th>
                          <th>凭证</th>
                          <th>模型</th>
                          <th>路径</th>
                          <th>状态</th>
                          <th>耗时</th>
                          <th>查看</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr v-for="log in antigravityLogs" :key="log.id">
                          <td style="font-size: 11px;">{{ new Date(log.timestamp).toLocaleString() }}</td>
                          <td>{{ log.accountName || 'System' }}</td>
                          <td style="font-family: monospace; font-size: 11px;">{{ log.model || '-' }}</td>
                          <td style="font-family: monospace; font-size: 11px;">{{ log.path }}</td>
                          <td>
                            <span :class="getLogStatusClass(log.statusCode)" style="font-weight: 600;">{{
                              log.statusCode }}</span>
                          </td>
                          <td>{{ log.durationMs }}ms</td>
                          <td>
                            <button class="btn btn-xs btn-secondary icon-only" @click="viewAntigravityLogDetail(log)">
                              <i class="fas fa-eye"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div v-if="antigravityLogs.length === 0" class="empty-state">
                      <i class="fas fa-file-alt" style="font-size: 40px; opacity: 0.2; margin-bottom: 12px;"></i>
                      <div>暂无调用日志</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 模块设置 (Settings) -->
              <div v-show="antigravityCurrentTab === 'settings'" class="sub-tab-content quick-fade-in">
                <div class="panel">
                  <div class="panel-header" style="border-bottom: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                      <div class="panel-title-group">
                        <div class="panel-title">Antigravity API 参数配置</div>
                      </div>
                      <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary btn-sm" @click="loadAntigravitySettings"
                          :disabled="antigravityLoading">
                          <i class="fas fa-sync-alt" :class="{ 'fa-spin': antigravityLoading }"></i> 刷新
                        </button>
                        <button class="btn btn-primary btn-sm" @click="saveAllAgSettings" :disabled="antigravitySaving">
                          <i class="fas" :class="antigravitySaving ? 'fa-spinner fa-spin' : 'fa-save'"></i> 保存全部
                        </button>
                      </div>
                    </div>
                  </div>

                  <div style="padding: 10px 3px 3px 3px;">
                    <!-- 生成参数 -->
                    <div style="margin-bottom: 20px;">
                      <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--ag-primary);">
                        <i class="fas fa-sliders-h"></i> 生成参数
                      </div>
                      <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                        <div>
                          <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认温度</label>
                          <input type="number" step="0.1" min="0" max="2" v-model="agSettingsForm.DEFAULT_TEMPERATURE"
                            class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="1">
                        </div>
                        <div>
                          <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认
                            top_p</label>
                          <input type="number" step="0.01" min="0" max="1" v-model="agSettingsForm.DEFAULT_TOP_P"
                            class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;"
                            placeholder="0.85">
                        </div>
                        <div>
                          <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认
                            top_k</label>
                          <input type="number" step="1" min="1" v-model="agSettingsForm.DEFAULT_TOP_K"
                            class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;"
                            placeholder="50">
                        </div>
                        <div>
                          <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认最大
                            Tokens</label>
                          <input type="number" step="1" min="1" v-model="agSettingsForm.DEFAULT_MAX_TOKENS"
                            class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;"
                            placeholder="8096">
                        </div>
                      </div>
                    </div>

                    <!-- 模型重定向 -->
                    <div style="margin-bottom: 24px;">
                      <div
                        style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--ag-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-exchange-alt"></i> 模型重定向 (别名)
                      </div>
                      <!-- 列表 -->
                      <div v-if="antigravityModelRedirects.length > 0"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-bottom: 12px;">
                        <div v-for="r in antigravityModelRedirects" :key="r.source_model"
                          style="background: var(--bg-tertiary); padding: 8px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color);">
                          <div style="font-size: 12px; font-family: monospace;">
                            <span style="color: var(--text-primary); font-weight: 600;">{{ r.source_model }}</span>
                            <i class="fas fa-arrow-right" style="font-size: 10px; opacity: 0.5; margin: 0 6px;"></i>
                            <span style="opacity: 0.8;">{{ r.target_model }}</span>
                          </div>
                          <button class="btn btn-xs btn-danger icon-only" @click="removeModelRedirect(r.source_model)"
                            title="删除重定向">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                      <div v-else style="font-size: 12px; opacity: 0.5; margin-bottom: 12px; padding: 8px 0;">
                        暂无重定向规则。添加后，请求 source 模型将自动转发给 target 模型。
                      </div>

                      <!-- 添加表单 -->
                      <div
                        style="display: flex; gap: 10px; align-items: flex-end; background: rgba(var(--ag-primary-rgb), 0); padding: 10px; border-radius: 8px;">
                        <div style="flex: 1;">
                          <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">源模型名称
                            (自定义)</label>
                          <input type="text" v-model="newRedirectSource" class="form-input"
                            style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="例如: gpt-4o">
                        </div>
                        <div style="flex: 1;">
                          <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">目标模型 ID
                            (实际)</label>
                          <input type="text" v-model="newRedirectTarget" class="form-input"
                            style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="例如: gemini-1.5-pro">
                        </div>
                        <button class="btn btn-secondary btn-sm"
                          @click="addModelRedirect(newRedirectSource, newRedirectTarget).then(s => { if(s) { newRedirectSource=''; newRedirectTarget=''; } })">
                          <i class="fas fa-plus"></i> 添加
                        </button>
                      </div>
                    </div>

                    <!-- 图片设置 + 限额 -->
                    <div
                      style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 0px;">
                      <div>
                        <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--ag-primary);">
                          <i class="fas fa-image"></i> 图片设置
                        </div>
                        <div
                          style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                          <div>
                            <label
                              style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">保存上限</label>
                            <input type="number" min="1" v-model="agSettingsForm.MAX_IMAGES" class="form-input"
                              style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="10">
                          </div>
                          <div>
                            <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">访问基础
                              URL</label>
                            <input type="text" v-model="agSettingsForm.IMAGE_BASE_URL" class="form-input"
                              style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="留空使用默认">
                          </div>
                        </div>
                      </div>
                      <div>
                        <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--ag-primary);">
                          <i class="fas fa-tachometer-alt"></i> 限额设置
                        </div>
                        <div
                          style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                          <div>
                            <label
                              style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">每小时上限</label>
                            <input type="number" v-model="agSettingsForm.CREDENTIAL_MAX_USAGE_PER_HOUR"
                              class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;"
                              placeholder="20">
                          </div>
                          <div>
                            <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">超时
                              (ms)</label>
                            <input type="number" v-model="agSettingsForm.TIMEOUT" class="form-input"
                              style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="120000">
                          </div>
                          <div>
                            <label
                              style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">日志保留天数</label>
                            <input type="number" v-model="agSettingsForm.REQUEST_LOG_RETENTION_DAYS" class="form-input"
                              style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="7">
                          </div>
                        </div>
                      </div>
                    </div>


                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ==================== Antigravity 日志详情模态框 ==================== -->
          <div v-if="showAntigravityLogDetailModal" class="modal-overlay"
            @click.self="showAntigravityLogDetailModal = false" @keydown.esc="showAntigravityLogDetailModal = false"
            tabindex="-1">
            <div class="modal" style="max-width: 600px;">
              <div class="modal-header">
                <div class="modal-title">
                  <i class="fas fa-file-alt"></i> 调用日志详情
                </div>
                <button class="modal-close" @click="showAntigravityLogDetailModal = false">&times;</button>
              </div>
              <div class="modal-body" v-if="antigravityLogDetail" style="padding: 20px;">
                <div class="log-detail-grid"
                  style="display: grid; grid-template-columns: 120px 1fr; gap: 12px; font-size: 13px;">
                  <div style="opacity: 0.6;">请求时间</div>
                  <div>{{ new Date(antigravityLogDetail.created_at).toLocaleString() }}</div>

                  <div style="opacity: 0.6;">请求方法</div>
                  <div><code class="code-sm">{{ antigravityLogDetail.request_method }}</code></div>

                  <div style="opacity: 0.6;">请求路径</div>
                  <div><code class="code-sm">{{ antigravityLogDetail.request_path }}</code></div>

                  <div style="opacity: 0.6;">状态码</div>
                  <div>
                    <span :class="antigravityLogDetail.status_code < 400 ? 'text-success' : 'text-danger'"
                      style="font-weight: 600;">
                      {{ antigravityLogDetail.status_code }}
                    </span>
                  </div>

                  <div style="opacity: 0.6;">耗时</div>
                  <div>{{ antigravityLogDetail.duration_ms }} ms</div>

                  <div style="opacity: 0.6;">账号 ID</div>
                  <div><code class="code-sm">{{ antigravityLogDetail.account_id || '-' }}</code></div>

                  <div style="opacity: 0.6;">客户端 IP</div>
                  <div>{{ antigravityLogDetail.client_ip || '-' }}</div>

                  <div style="opacity: 0.6;">User-Agent</div>
                  <div style="word-break: break-all; font-size: 11px; opacity: 0.8;">{{ antigravityLogDetail.user_agent
                    ||
                    '-'
                    }}</div>
                </div>

                <div v-if="antigravityLogDetail.detail" style="margin-top: 16px;">
                  <div style="opacity: 0.6; margin-bottom: 8px; font-size: 13px;">详情信息</div>
                  <pre
                    style="background: var(--bg-secondary); padding: 12px; border-radius: 8px; font-size: 12px; overflow-x: auto; margin: 0;">{{ JSON.stringify(antigravityLogDetail.detail, null, 2) }}</pre>
                </div>
              </div>
              <div class="modal-footer" style="padding: 12px 20px; border-top: 1px solid var(--border-color);">
                <button class="btn btn-secondary" @click="showAntigravityLogDetailModal = false">
                  关闭
                </button>
              </div>
            </div>
          </div>

          <!-- ==================== Gemini CLI 日志详情模态框 ==================== -->
          <div v-if="showGeminiCliLogDetailModal" class="modal-overlay"
            @click.self="showGeminiCliLogDetailModal = false" @keydown.esc="showGeminiCliLogDetailModal = false"
            tabindex="-1">
            <div class="modal" style="max-width: 600px;">
              <div class="modal-header">
                <div class="modal-title" style="color: var(--gemini-primary);">
                  <i class="fas fa-file-alt"></i> Gemini 调用详情
                </div>
                <button class="modal-close" @click="showGeminiCliLogDetailModal = false">&times;</button>
              </div>
              <div class="modal-body" v-if="geminiCliLogDetail" style="padding: 20px;">
                <div class="log-detail-grid"
                  style="display: grid; grid-template-columns: 100px 1fr; gap: 12px; font-size: 13px;">
                  <div style="opacity: 0.6;">时间</div>
                  <div>{{ formatDateTime(geminiCliLogDetail.created_at) }}</div>

                  <div style="opacity: 0.6;">方法</div>
                  <div><code class="code-sm">{{ geminiCliLogDetail.request_method }}</code></div>

                  <div style="opacity: 0.6;">路径</div>
                  <div>{{ geminiCliLogDetail.request_path }}</div>

                  <div style="opacity: 0.6;">状态码</div>
                  <div>
                    <span :class="geminiCliLogDetail.status_code < 400 ? 'status-ok' : 'status-err'">
                      {{ geminiCliLogDetail.status_code }}
                    </span>
                  </div>

                  <div style="opacity: 0.6;">延迟</div>
                  <div>{{ geminiCliLogDetail.duration_ms }} ms</div>

                  <div style="opacity: 0.6;">账号</div>
                  <div><code class="code-sm">{{ geminiCliLogDetail.account_id }}</code></div>
                </div>

                <div v-if="geminiCliLogDetail.detail" style="margin-top: 16px;">
                  <div style="opacity: 0.6; margin-bottom: 8px; font-size: 12px; font-weight: 600;">数据快照</div>
                  <pre
                    style="background: var(--bg-secondary); padding: 12px; border-radius: 8px; font-size: 11px; overflow-x: auto; margin: 0; max-height: 400px; border: 1px solid var(--border-color);">{{ JSON.stringify(geminiCliLogDetail.detail, null, 2) }}</pre>
                </div>
              </div>
              <div class="modal-footer" style="padding: 12px 20px; border-top: 1px solid var(--border-color);">
                <button class="btn btn-secondary" @click="showGeminiCliLogDetailModal = false">
                  关闭
                </button>
              </div>
            </div>
          </div>

          <!-- ==================== 主机管理模态框 ==================== -->
          <!-- 添加/编辑主机模态框 -->
          <div v-if="showServerModal" class="modal-overlay" @keydown.esc="closeServerModal"
            @keydown.ctrl.enter="saveServer" tabindex="-1">
            <div class="modal server-modal">
              <div class="modal-header">
                <div class="modal-title">
                  <i class="fas fa-server"></i>
                  {{ serverModalMode === 'add' ? '添加主机' : '编辑主机' }}
                </div>
                <button class="modal-close" @click="closeServerModal">&times;</button>
              </div>
              <div class="modal-body">
                <!-- 基础信息区 -->
                <div class="server-form-section">
                  <div class="form-row">
                    <div class="form-group flex-1">
                      <label>常用凭据</label>
                      <select class="form-input" @change="applyCredential($event)">
                        <option value="">-- 选择预设凭据 --</option>
                        <option v-for="cred in serverCredentials" :key="cred.id" :value="cred.id">
                          {{ cred.name }} ({{ cred.username }})
                        </option>
                      </select>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group flex-1">
                      <label><i class="fas fa-id-badge"></i> 实例名称</label>
                      <input type="text" v-model="serverForm.name" class="form-input" placeholder="如: 生产环境-网关"
                        required />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group" style="flex: 7;">
                      <label><i class="fas fa-network-wired"></i> 主机地址</label>
                      <input type="text" v-model="serverForm.host" class="form-input" placeholder="IP 或 域名" required />
                    </div>
                    <div class="form-group" style="flex: 3;">
                      <label><i class="fas fa-door-open"></i> 端口</label>
                      <input type="number" v-model="serverForm.port" class="form-input" placeholder="22" />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group flex-1">
                      <label><i class="fas fa-user-shield"></i> 登录用户</label>
                      <input type="text" v-model="serverForm.username" class="form-input" placeholder="root" required />
                    </div>
                  </div>
                </div>

                <!-- 认证方式区 -->
                <div class="server-form-section">
                  <div class="server-auth-toggle">
                    <button type="button" :class="{ active: serverForm.authType === 'password' }"
                      @click="serverForm.authType = 'password'">
                      <i class="fas fa-key"></i> 密码认证
                    </button>
                    <button type="button" :class="{ active: serverForm.authType === 'privateKey' }"
                      @click="serverForm.authType = 'privateKey'">
                      <i class="fas fa-file-code"></i> 密钥认证
                    </button>
                  </div>

                  <div v-if="serverForm.authType === 'password'" class="server-form-field">
                    <label><i class="fas fa-lock"></i> 密码</label>
                    <input v-model="serverForm.password" type="password" placeholder="请输入密码" />
                  </div>

                  <div v-if="serverForm.authType === 'privateKey'">
                    <div class="server-form-field">
                      <label><i class="fas fa-file-alt"></i> 私钥内容</label>
                      <textarea v-model="serverForm.privateKey" rows="4"
                        placeholder="粘贴 SSH 私钥（支持 RSA、ECDSA、Ed25519）"></textarea>
                    </div>
                    <div class="server-form-field">
                      <label><i class="fas fa-unlock-alt"></i> 私钥密码 <span class="optional-tag">可选</span></label>
                      <input v-model="serverForm.passphrase" type="password" placeholder="私钥有密码保护时填写" />
                    </div>
                  </div>
                </div>

                <!-- 扩展信息区 -->
                <!-- <div class="server-form-section collapsed-section">
              <div class="server-form-row">
                <div class="server-form-field" style="flex: 1;">
                  <label><i class="fas fa-tags"></i> 标签 <span class="optional-tag">可选</span></label>
                  <input v-model="serverForm.tagsInput" type="text" placeholder="生产, Web主机" />
                  <label><i class="fas fa-sticky-note"></i> 备注 <span class="optional-tag">可选</span></label>
                  <textarea v-model="serverForm.description" rows="2" placeholder="主机用途说明"></textarea>
                </div>
              </div>
            </div> -->

                <div v-if="serverModalError" class="server-form-error">
                  <i class="fas fa-exclamation-circle"></i> {{ serverModalError }}
                </div>
              </div>
              <div class="server-modal-footer">
                <button class="btn-server-cancel" @click="closeServerModal" :disabled="serverModalSaving">
                  取消
                </button>
                <div class="server-modal-actions">
                  <button class="btn-server-test" @click="testServerConnection" :disabled="serverModalSaving">
                    <i class="fas fa-plug"></i> 测试
                  </button>
                  <button class="btn-server-save" @click="saveServer" :disabled="serverModalSaving">
                    <i class="fas" :class="serverModalSaving ? 'fa-spinner fa-spin' : 'fa-check'"></i>
                    {{ serverModalSaving ? '保存中' : '保存' }}
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 批量导入主机模态框 -->
          <div v-if="showImportServerModal" class="modal-overlay" @keydown.esc="closeImportServerModal"
            @keydown.enter="confirmImportServers" tabindex="-1">
            <div class="modal server-modal" style="max-width: 500px;">
              <div class="modal-header">
                <div class="modal-title">
                  <i class="fas fa-file-import"></i>
                  批量导入主机
                </div>
                <button class="modal-close" @click="closeImportServerModal">&times;</button>
              </div>
              <div class="modal-body">
                <div class="server-form-section">
                  <div class="form-group">
                    <label><i class="fas fa-file"></i> 选择 JSON 文件</label>
                    <input type="file" ref="importFileInput" accept=".json" class="form-input"
                      @change="handleImportFileChange" />
                  </div>
                </div>
                <div v-if="importPreview" class="server-form-section" style="margin-top: 8px;">
                  <div class="form-group">
                    <label><i class="fas fa-list"></i> 预览（将导入 {{ importPreview.length }} 台主机）</label>
                    <div class="import-preview-list">
                      <div v-for="(server, index) in importPreview" :key="index" class="import-preview-item">
                        <i class="fas fa-server"></i>
                        <span>{{ server.name }} ({{ server.username }}@{{ server.host }}:{{ server.port }})</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div v-if="importModalError" class="server-form-error">
                  <i class="fas fa-exclamation-circle"></i> {{ importModalError }}
                </div>
              </div>
              <div class="server-modal-footer">
                <button class="btn-server-cancel" @click="closeImportServerModal" :disabled="importModalSaving">
                  取消
                </button>
                <button class="btn-server-save" @click="confirmImportServers"
                  :disabled="importModalSaving || !importPreview || importPreview.length === 0">
                  <i class="fas fa-check"></i>
                  {{ importModalSaving ? '导入中...' : '确认导入' }}
                </button>
              </div>
            </div>
          </div>

          <!-- 新建终端会话选择模态框 -->
          <div v-if="showAddSessionSelectModal" class="modal-overlay" @keydown.esc="showAddSessionSelectModal = false"
            tabindex="-1">
            <div class="modal server-modal" style="max-width: 360px;">
              <div class="modal-header">
                <div class="modal-title">
                  <i class="fas fa-terminal"></i>
                  选择主机
                </div>
                <button class="modal-close" @click="showAddSessionSelectModal = false">&times;</button>
              </div>
              <div class="modal-body" style="max-height: 400px; overflow-y: auto; padding: 8px;">
                <div v-if="serverList.length === 0" class="empty-state">
                  <p>暂无可用主机</p>
                </div>
                <div v-else class="server-select-list">
                  <div v-for="server in serverList" :key="server.id" class="server-select-item"
                    @click="addSessionForServer(server)">
                    <div class="server-status-indicator" :class="server.status || 'unknown'"></div>
                    <div class="server-select-info">
                      <div class="server-select-name">{{ server.name }}</div>
                      <div class="server-select-host">{{ server.host }}:{{ server.port }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 设置侧边栏 -->
          <div v-if="showSettingsModal" @keydown.esc="showSettingsModal = false" tabindex="-1">
            <div class="settings-sidebar-overlay"></div>
            <div class="settings-sidebar">
              <!-- 侧边栏头部 -->
              <div class="settings-sidebar-header">
                <div class="settings-sidebar-title">
                  <i class="fas fa-cog"></i>
                  <span>系统设置</span>
                </div>
                <button class="settings-sidebar-close" @click="showSettingsModal = false">&times;</button>
              </div>

              <!-- 侧边栏内容 -->
              <div class="settings-container">
                <!-- settings-sidebar-left: Navigation -->
                <div class="settings-nav">
                  <button class="settings-nav-item" :class="{ active: settingsCurrentTab === 'general' }"
                    @click="settingsCurrentTab = 'general'">
                    <i class="fas fa-sliders-h"></i> 通用设置
                  </button>
                  <button class="settings-nav-item" :class="{ active: settingsCurrentTab === 'api' }"
                    @click="settingsCurrentTab = 'api'">
                    <i class="fas fa-network-wired"></i> API 配置
                  </button>
                  <button class="settings-nav-item" :class="{ active: settingsCurrentTab === 'modules' }"
                    @click="settingsCurrentTab = 'modules'">
                    <i class="fas fa-cubes"></i> 模块管理
                  </button>
                  <button class="settings-nav-item" :class="{ active: settingsCurrentTab === 'database' }"
                    @click="settingsCurrentTab = 'database'">
                    <i class="fas fa-database"></i> 数据库
                  </button>
                  <button class="settings-nav-item" :class="{ active: settingsCurrentTab === 'appearance' }"
                    @click="settingsCurrentTab = 'appearance'">
                    <i class="fas fa-paint-brush"></i> 个性化
                  </button>
                </div>

                <!-- settings-main: Content Area -->
                <div class="settings-main">
                  <!-- ==================== General Tab ==================== -->
                  <div v-if="settingsCurrentTab === 'general'" class="settings-tab-content fade-in">
                    <div class="settings-group">
                      <div class="settings-group-title">账户安全</div>
                      <div class="form-group">
                        <label class="form-label">新密码</label>
                        <input v-model="newPassword" type="password" class="form-input" placeholder="输入新密码（至少6位）" />
                      </div>
                      <div class="form-group">
                        <label class="form-label">确认密码</label>
                        <input v-model="confirmPassword" type="password" class="form-input" placeholder="确认新密码" />
                      </div>
                      <div v-if="passwordError" class="form-error">{{ passwordError }}</div>
                      <div v-if="passwordSuccess" class="form-success">{{ passwordSuccess }}</div>
                      <button class="btn btn-primary" @click="changePassword" style="width: 100%; margin-top: 8px;">
                        <i class="fas fa-key"></i> 修改密码
                      </button>
                    </div>

                    <div class="settings-group">
                      <div class="settings-group-title">数据备份 & 恢复</div>
                      <div class="settings-description">
                        导出包含所有模块配置和数据的 JSON 文件，以便迁移或备份。
                      </div>
                      <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="btn btn-secondary" @click="exportAllData" style="flex: 1;">
                          <i class="fas fa-upload"></i> 导出数据
                        </button>
                        <button class="btn btn-secondary" @click="importAllData" style="flex: 1;">
                          <i class="fas fa-download"></i> 导入数据
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- ==================== API Configuration Tab ==================== -->
                  <div v-if="settingsCurrentTab === 'api'" class="settings-tab-content fade-in">
                    <div class="settings-group">
                      <div class="settings-group-title">全局 API & 网络配置</div>
                      <div class="settings-description">
                        此处设置的 API 密钥和代理将统一应用于 Antigravity 和 Gemini CLI 模块。
                      </div>

                      <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">全局 API 访问密钥 (API_KEY)</label>
                        <div class="input-with-icon">
                          <i class="fas fa-key"></i>
                          <input type="password" v-model="agSettingsForm.API_KEY" class="form-input"
                            placeholder="留空则无需认证" />
                        </div>
                        <div class="form-help">用于 v1/chat/completions 等接口的身份验证</div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">全局 HTTP 代理地址 (PROXY)</label>
                        <div class="input-with-icon">
                          <i class="fas fa-globe"></i>
                          <input type="text" v-model="agSettingsForm.PROXY" class="form-input"
                            placeholder="例如: http://127.0.0.1:7890" />
                        </div>
                        <div class="form-help">如果服务器无法直连 Google API，请配置代理</div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">负载均衡策略 (Load Balancing)</label>
                        <div class="input-with-icon">
                          <i class="fas fa-balance-scale"></i>
                          <select v-model="agSettingsForm.load_balancing_strategy" class="form-input">
                            <option value="random">随机 (Random)</option>
                            <option value="round_robin">轮询 (Round Robin)</option>
                          </select>
                        </div>
                        <div class="form-help">决定多个启用账号之间的调用分配方式</div>
                      </div>

                      <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">渠道模块开关</label>
                        <div
                          style="display: flex; gap: 24px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                          <div style="display: flex; align-items: center; gap: 10px;">
                            <label class="switch">
                              <input type="checkbox" :checked="channelEnabled && channelEnabled['antigravity']"
                                @change="toggleChannelEnabled('antigravity')">
                              <span class="slider round"></span>
                            </label>
                            <span style="font-size: 13px; font-weight: 500;">Antigravity</span>
                          </div>

                          <div style="display: flex; align-items: center; gap: 10px;">
                            <label class="switch">
                              <input type="checkbox" :checked="channelEnabled && channelEnabled['gemini-cli']"
                                @change="toggleChannelEnabled('gemini-cli')">
                              <span class="slider round"></span>
                            </label>
                            <span style="font-size: 13px; font-weight: 500;">Gemini CLI</span>
                          </div>
                        </div>
                      </div>

                      <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label" style="font-size: 14px; font-weight: 600;">模型前缀配置 (Model
                          Prefix)</label>
                        <div class="form-help" style="margin-bottom: 12px; font-size: 13px; opacity: 0.8;">
                          为每个渠道的模型添加前缀，避免名称冲突
                          (例如 "ag/" 或 "gcli/")</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                          <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label"
                              style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 500;">Antigravity
                              前缀</label>
                            <input type="text" class="form-input" v-model="channelModelPrefix['antigravity']"
                              placeholder="例如: ag/">
                          </div>
                          <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label"
                              style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 500;">Gemini
                              CLI 前缀</label>
                            <input type="text" class="form-input" v-model="channelModelPrefix['gemini-cli']"
                              placeholder="例如: gcli/">
                          </div>
                        </div>
                      </div>

                      <button class="btn btn-primary" @click="saveGlobalApiSettings" :disabled="antigravitySaving"
                        style="width: 100%; margin-top: 12px; height: 42px; font-weight: 600;">
                        <i class="fas" :class="antigravitySaving ? 'fa-spinner fa-spin' : 'fa-save'"></i>
                        同步并应用配置
                      </button>
                    </div>
                  </div>

                  <!-- ==================== Modules Tab ==================== -->
                  <div v-if="settingsCurrentTab === 'modules'" class="settings-tab-content fade-in">
                    <div class="settings-group">
                      <div class="settings-group-title">功能模块管理</div>
                      <div class="settings-description" style="margin-bottom: 12px;">
                        拖拽调整菜单顺序，点击眼睛图标控制显示/隐藏。
                      </div>
                      <div class="modules-list">
                        <div v-for="(module, index) in moduleOrder" :key="module" class="draggable-module-item"
                          draggable="true" @dragstart="handleDragStart($event, index)" @dragend="handleDragEnd"
                          @dragover.prevent="handleDragOver($event, index)" @drop="handleDrop($event, index)">
                          <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                            <i class="fas fa-grip-vertical drag-handle"></i>
                            <div class="module-icon-wrapper">
                              <i class="draggable-module-icon fas" :class="getModuleIcon(module)"></i>
                            </div>
                            <span class="draggable-module-name">{{ getModuleName(module) }}</span>
                          </div>
                          <button class="btn btn-sm btn-icon"
                            :class="moduleVisibility[module] ? 'text-success' : 'text-muted'"
                            @click.stop="toggleModuleVisibility(module)"
                            :title="moduleVisibility[module] ? '已显示' : '已隐藏'">
                            <i class="fas" :class="moduleVisibility[module] ? 'fa-eye' : 'fa-eye-slash'"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="settings-actions">
                      <button class="btn btn-primary" @click="saveSettings">
                        <i class="fas fa-check"></i> 保存排序与可见性
                      </button>
                    </div>
                  </div>

                  <!-- ==================== Database Tab ==================== -->
                  <div v-if="settingsCurrentTab === 'database'" class="settings-tab-content fade-in">
                    <div class="settings-group">
                      <div class="settings-group-title">存储状态</div>
                      <div class="db-stats-card">
                        <div class="db-stat-item">
                          <div class="db-stat-label">数据库大小</div>
                          <div class="db-stat-value" v-if="dbStats">{{ formatFileSize(dbStats.dbSize) }}</div>
                          <div class="db-stat-value" v-else>--</div>
                        </div>
                        <div class="db-stat-item">
                          <div class="db-stat-label">数据表总数</div>
                          <div class="db-stat-value" v-if="dbStats">{{ Object.keys(dbStats.tables || {}).length }}</div>
                          <div class="db-stat-value" v-else>--</div>
                        </div>
                      </div>
                      <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="btn btn-warning" @click="handleClearLogs" style="flex: 1;">
                          <i class="fas fa-trash-alt"></i> 清理所有日志
                        </button>
                        <button class="btn btn-secondary" @click="handleVacuumDb" style="flex: 1;">
                          <i class="fas fa-compress-arrows-alt"></i> 压缩数据库
                        </button>
                      </div>
                    </div>

                    <div class="settings-group">
                      <div class="settings-group-title">自动清理策略</div>
                      <div class="settings-description">
                        系统将自动删除超过限制的旧日志数据。
                      </div>

                      <div class="form-group">
                        <label class="form-label">日志保留天数</label>
                        <div class="input-with-suffix">
                          <input v-model.number="logSettings.days" type="number" class="form-input" min="0"
                            placeholder="0" @change="saveLogSettings">
                          <span class="input-suffix">天</span>
                        </div>
                        <div class="form-help">0 表示不限制</div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">单表最大记录数</label>
                        <div class="input-with-suffix">
                          <input v-model.number="logSettings.count" type="number" class="form-input" min="0" step="1000"
                            placeholder="0" @change="saveLogSettings">
                          <span class="input-suffix">条</span>
                        </div>
                        <div class="form-help">0 表示不限制</div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">数据库最大体积</label>
                        <div class="input-with-suffix">
                          <input v-model.number="logSettings.dbSizeMB" type="number" class="form-input" min="0"
                            placeholder="0" @change="saveLogSettings">
                          <span class="input-suffix">MB</span>
                        </div>
                        <div class="form-help">0 表示不限制</div>
                      </div>

                      <button class="btn btn-secondary" style="width: 100%; margin-top: 8px;" @click="enforceLogLimits"
                        :disabled="logLimitsEnforcing">
                        <i class="fas" :class="logLimitsEnforcing ? 'fa-spinner fa-spin' : 'fa-broom'"></i>
                        {{ logLimitsEnforcing ? '正在清理...' : '立即执行清理' }}
                      </button>
                    </div>
                  </div>

                  <!-- ==================== Appearance Tab ==================== -->
                  <div v-if="settingsCurrentTab === 'appearance'" class="settings-tab-content fade-in">
                    <div class="settings-group">
                      <div class="settings-group-title">自定义 CSS</div>
                      <div class="settings-description">
                        注入自定义 CSS 样式以覆盖默认主题。
                      </div>
                      <textarea v-model="customCss" class="form-textarea code-font" placeholder="/* 在此处输入 CSS 代码 */"
                        style="min-height: 200px;"></textarea>
                      <div v-if="customCssError" class="form-error" style="margin-top: 8px;">{{ customCssError }}</div>
                      <div v-if="customCssSuccess" class="form-success" style="margin-top: 8px;">{{ customCssSuccess }}
                      </div>

                      <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="btn btn-primary" @click="saveCustomCss" style="flex: 1;">
                          <i class="fas fa-save"></i> 应用并保存
                        </button>
                        <button class="btn btn-secondary" @click="resetCustomCss" style="flex: 1;">
                          <i class="fas fa-undo"></i> 重置默认
                        </button>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>

          <!-- 日志模态框 -->
          <div v-if="showLogsModal" class="modal-overlay" :class="{ 'logs-fullscreen-overlay': logsFullscreen }"
            @keydown.esc="showLogsModal = false" tabindex="-1">
            <div class="modal logs-modal" :class="{ 'logs-modal-fullscreen': logsFullscreen }">
              <div class="logs-header">
                <div class="logs-title">📋 {{ logsModalTitle }}</div>
                <div class="logs-controls">
                  <button class="btn btn-secondary" @click="toggleRealTimeRefresh"
                    style="margin-right: 8px; padding: 6px 10px; font-size: 12px;">
                    <i class="fas" :class="logsRealTime ? 'fa-stop' : 'fa-play'"></i>
                    {{ logsRealTime ? '停止实时' : '实时刷新' }}
                  </button>
                  <button class="btn btn-secondary" @click="toggleAutoScroll"
                    style="margin-right: 8px; padding: 6px 10px; font-size: 12px;">
                    <i class="fas" :class="logsAutoScroll ? 'fa-pause' : 'fa-play'"></i>
                    {{ logsAutoScroll ? '停止滚动' : '自动滚动' }}
                  </button>
                  <button class="btn btn-secondary" @click="toggleFullscreen"
                    style="margin-right: 8px; padding: 6px 10px; font-size: 12px;">
                    <i class="fas" :class="logsFullscreen ? 'fa-compress' : 'fa-expand'"></i>
                    {{ logsFullscreen ? '退出全屏' : '全屏' }}
                  </button>
                  <button class="btn btn-danger" @click="showLogsModal = false"
                    style="padding: 6px 10px; font-size: 12px;">
                    <i class="fas fa-times"></i>
                    关闭
                  </button>
                </div>
              </div>
              <div class="logs-info">
                <span>项目: {{ logsModalInfo.project }}</span>
                <span>账号: {{ logsModalInfo.account }}</span>
                <span>日志: {{ logsModalInfo.count }} 条</span>
                <span>时间: {{ logsModalInfo.time }}</span>
              </div>
              <div class="logs-content" ref="logsContent" @wheel.stop @touchmove.stop>
                <div v-if="logsLoading" style="text-align: center; padding: 40px;">⏳ 正在加载日志...</div>
                <div v-else class="logs-text-container" ref="logsTextContainer">
                  <pre class="logs-text" ref="logsText">{{ logsContent || '暂无日志' }}</pre>
                  <div class="logs-horizontal-scrollbar" ref="logsScrollbar">
                    <div class="logs-scrollbar-thumb" ref="logsScrollbarThumb"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Toast 系统容器将由 toast.js 自动创建 -->

          <!-- 自定义确认对话框 -->
          <div v-if="customDialog.show" class="custom-dialog-overlay"
            @keydown.esc="customDialog.onCancel ? customDialog.onCancel() : (customDialog.show = false)"
            @keydown.enter="customDialog.onConfirm" tabindex="-1">
            <div class="custom-dialog">
              <div class="custom-dialog-title">
                <i class="fas" :class="customDialog.icon || 'fa-question-circle'"></i>
                {{ customDialog.title || '确认' }}
              </div>
              <div class="custom-dialog-message">{{ customDialog.message }}</div>
              <input v-if="customDialog.isPrompt" v-model="customDialog.promptValue"
                :placeholder="customDialog.placeholder" @keyup.enter="customDialog.onConfirm"
                class="custom-dialog-input" ref="promptInput" />
              <div class="custom-dialog-buttons">
                <button v-if="customDialog.cancelText" class="btn btn-secondary"
                  @click="customDialog.onCancel ? customDialog.onCancel() : (customDialog.show = false)">
                  {{ customDialog.cancelText }}
                </button>
                <button class="btn" :class="customDialog.confirmClass || 'btn-primary'" @click="customDialog.onConfirm">
                  {{ customDialog.confirmText || '确定' }}
                </button>
              </div>
            </div>
          </div>

          <!-- 凭据管理模态框 -->
          <div v-if="showAddCredentialModal" class="modal-overlay" @click.self="showAddCredentialModal = false"
            @keydown.esc="showAddCredentialModal = false" tabindex="-1">
            <div class="modal server-modal" style="max-width: 380px;">
              <div class="modal-header">
                <div class="modal-title">
                  <i class="fas fa-key"></i> 保存新凭据
                </div>
                <button class="modal-close" @click="showAddCredentialModal = false">&times;</button>
              </div>
              <div class="modal-body">
                <div class="server-form-section">
                  <div class="form-group">
                    <label><i class="fas fa-tag"></i> 凭据标识</label>
                    <input type="text" v-model="credForm.name" class="form-input" placeholder="例如: 默认密码" />
                  </div>
                  <div class="form-group">
                    <label><i class="fas fa-user"></i> 用户名</label>
                    <input type="text" v-model="credForm.username" class="form-input" placeholder="root" />
                  </div>
                  <div class="form-group">
                    <label><i class="fas fa-lock"></i> 密码</label>
                    <input type="password" v-model="credForm.password" class="form-input" placeholder="登录密码" />
                  </div>
                </div>
                <div v-if="credError" class="server-form-error">
                  <i class="fas fa-exclamation-circle"></i> {{ credError }}
                </div>
              </div>
              <div class="server-modal-footer">
                <button class="btn-server-cancel" @click="showAddCredentialModal = false">取消</button>
                <button class="btn-server-save" @click="saveCredential">
                  <i class="fas fa-save"></i> 保存
                </button>
              </div>
            </div>
          </div>

          <!-- Docker 详细列表模态框 -->
          <div v-if="showDockerModal" class="modal-overlay" @click.self="showDockerModal = false">
            <div class="modal-container glass-panel modal-lg" style="border-radius: 20px;">
              <div class="modal-header">
                <div class="modal-title">云容器管理 - {{ dockerModalServer ? dockerModalServer.name : '' }}</div>
                <button class="close-btn" @click="showDockerModal = false">×</button>
              </div>
              <div class="modal-body">
                <div v-if="dockerModalData && dockerModalData.containers" class="docker-container-list">
                  <div v-for="container in dockerModalData.containers" :key="container.id" class="docker-container-card"
                    :class="{ 'running': container.status.includes('Up') }">
                    <div class="docker-container-info">
                      <div class="docker-container-header-row">
                        <div>
                          <div style="font-weight: 700; font-size: 14px;">{{ container.name }}</div>
                          <div class="docker-container-image">{{ container.image }}</div>
                        </div>
                        <span class="docker-status-badge"
                          :class="container.status.includes('Up') ? 'status-running' : 'status-exited'">
                          {{ container.status }}
                        </span>
                      </div>
                      <div class="docker-container-ports">端口: {{ container.ports }}</div>
                      <div class="docker-container-actions">
                        <button v-if="container.status.includes('Up')" class="btn btn-sm btn-secondary"
                          @click="handleDockerAction(dockerModalServer.id, container.id, 'stop')" title="停止"><i
                            class="fas fa-stop"></i></button>
                        <button v-else class="btn btn-sm btn-success"
                          @click="handleDockerAction(dockerModalServer.id, container.id, 'start')" title="启动"><i
                            class="fas fa-play"></i></button>
                        <button class="btn btn-sm btn-secondary"
                          @click="handleDockerAction(dockerModalServer.id, container.id, 'restart')" title="重启"><i
                            class="fas fa-redo"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
                <div v-else class="loading">正在获取容器信息...</div>
              </div>
            </div>
          </div> <!-- 闭合 Docker 详细列表模态框 -->

          <!-- ==================== Antigravity 账号模态框 ==================== -->
          <div v-if="showAntigravityAccountModal" class="modal-overlay"
            @keydown.esc="showAntigravityAccountModal = false">
            <div class="modal">
              <div class="modal-header">
                <div class="modal-title">
                  <i class="fas fa-atom"></i>
                  {{ antigravityEditingAccount ? '编辑账号' : '添加账号' }}
                </div>
                <button class="modal-close" @click="showAntigravityAccountModal = false">&times;</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label class="form-label">账号名称 *</label>
                  <input v-model="antigravityAccountForm.name" class="form-input" placeholder="例如: Google Pro" />
                </div>
                <div class="form-group">
                  <label class="form-label">Email (可选)</label>
                  <input v-model="antigravityAccountForm.email" class="form-input" placeholder="user@gmail.com" />
                </div>

                <div v-if="antigravityAccountFormError" class="form-error">{{ antigravityAccountFormError }}</div>
              </div>
              <div class="modal-footer ag-modal-footer">
                <button class="btn btn-primary" @click="saveAntigravityAccount" :disabled="antigravitySaving"
                  style="flex: 1;">
                  {{ antigravitySaving ? '保存中...' : '提交' }}
                </button>
                <button class="btn btn-secondary" @click="showAntigravityAccountModal = false"
                  style="flex: 1;">取消</button>
              </div>
            </div>
          </div>

          <!-- Antigravity 手动添加模态框 -->
          <div v-if="showAntigravityManualModal" class="modal-overlay" @click.self="showAntigravityManualModal = false">
            <div class="modal ag-modal-manual">
              <div class="modal-header">
                <div class="modal-title">手动添加 Token</div>
                <button class="modal-close" @click="showAntigravityManualModal = false">&times;</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label>账号名称 (可选)</label>
                  <input type="text" v-model="antigravityManualForm.name" class="form-input"
                    placeholder="默认为 Manual Account">
                </div>
                <div class="form-group">
                  <label>Access Token <span style="color:red">*</span></label>
                  <textarea v-model="antigravityManualForm.accessToken"
                    class="form-textarea ag-form-textarea ag-form-textarea-lg" placeholder="ya29.a0..."></textarea>
                </div>
                <div class="form-group">
                  <label>Refresh Token <span style="color:red">*</span></label>
                  <textarea v-model="antigravityManualForm.refreshToken" class="form-textarea ag-form-textarea"
                    placeholder="1//0..."></textarea>
                </div>
                <div class="form-row">
                  <div class="form-group flex-1">
                    <label>Project ID (可选)</label>
                    <input type="text" v-model="antigravityManualForm.projectId" class="form-input"
                      placeholder="如未填将尝试自动获取">
                  </div>
                  <div class="form-group" style="flex: 0 0 120px;">
                    <label>有效期 (秒)</label>
                    <input type="number" v-model="antigravityManualForm.expiresIn" class="form-input"
                      placeholder="3599">
                  </div>
                </div>
                <div v-if="antigravityManualFormError" class="form-error">{{ antigravityManualFormError }}</div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" @click="showAntigravityManualModal = false">取消</button>
                <button class="btn btn-primary" @click="saveAntigravityManualAccount" :disabled="antigravitySaving">
                  <i class="fas" :class="antigravitySaving ? 'fa-spinner fa-spin' : 'fa-save'"></i> 保存
                </button>
              </div>
            </div>
          </div>

          <!-- ==================== Gemini CLI 账号模态框 ==================== -->
          <div v-if="showGeminiCliAccountModal" class="modal-overlay" @click.self="showGeminiCliAccountModal = false">
            <div class="modal">
              <div class="modal-header">
                <div class="modal-title">
                  <i class="fas fa-terminal"></i>
                  {{ geminiCliEditingAccount ? '编辑 Gemini 账号' : '添加 Gemini 账号' }}
                </div>
                <button class="modal-close" @click="showGeminiCliAccountModal = false">&times;</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label class="form-label">备注名称 <span style="color:red">*</span></label>
                  <input v-model="geminiCliAccountForm.name" class="form-input" placeholder="例如: Gemini Project 1" />
                </div>
                <div class="form-group">
                  <label class="form-label" style="display: flex; justify-content: space-between;">
                    <span>Email 地址 (可选)</span>
                    <a href="javascript:void(0)" @click="fetchGeminiCliEmail"
                      style="font-size: 11px; text-decoration: none; color: var(--gemini-primary); line-height: 1.5; display: inline-flex; align-items: center;">
                      <i class="fas fa-magic"></i> 获取地址
                    </a>
                  </label>
                  <input v-model="geminiCliAccountForm.email" class="form-input" placeholder="自动获取或手动填写" />
                </div>
                <div class="form-group">
                  <label class="form-label">Client ID <span style="color:red">*</span></label>
                  <input v-model="geminiCliAccountForm.client_id" class="form-input"
                    placeholder="717...-....apps.googleusercontent.com" />
                </div>
                <div class="form-group">
                  <label class="form-label">Client Secret (可选)</label>
                  <input v-model="geminiCliAccountForm.client_secret" type="password" class="form-input"
                    placeholder="GOCSPX-..." />
                  <div style="font-size: 10px; opacity: 0.5; margin-top: 4px;">如果凭据包含 Client Secret 请填写。</div>
                </div>
                <div class="form-group">
                  <label class="form-label">Refresh Token <span style="color:red">*</span></label>
                  <textarea v-model="geminiCliAccountForm.refresh_token" class="form-textarea" placeholder="1//0..."
                    style="min-height: 80px;"></textarea>
                </div>
                <div class="form-group">
                  <label class="form-label">Project ID (可选)</label>
                  <input v-model="geminiCliAccountForm.project_id" class="form-input" placeholder="my-gemini-project" />
                </div>
                <div v-if="geminiCliAccountFormError" class="form-error">{{ geminiCliAccountFormError }}</div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" @click="showGeminiCliAccountModal = false">取消</button>
                <button class="btn btn-primary" @click="saveGeminiCliAccount" :disabled="geminiCliSaving">
                  <i class="fas" :class="geminiCliSaving ? 'fa-spinner fa-spin' : 'fa-save'"></i> 保存并同步
                </button>
              </div>
            </div>
          </div>

          <!-- 添加 Zeabur 账号模态框 -->
          <div v-if="showAddZeaburAccountModal" class="modal-overlay" @keydown.esc="showAddZeaburAccountModal = false"
            @keydown.enter="addAccountToList" tabindex="-1">
            <div class="modal">
              <div class="modal-header">
                <div class="modal-title">添加 Zeabur 账号</div>
                <button class="modal-close" @click="showAddZeaburAccountModal = false">&times;</button>
              </div>

              <div class="form-group">
                <label class="form-label">账号名称 *</label>
                <input v-model="newAccount.name" class="form-input" placeholder="例如: 我的账号" />
              </div>

              <div class="form-group">
                <label class="form-label">API Token *</label>
                <input v-model="newAccount.token" type="password" class="form-input"
                  placeholder="sk-xxxxxxxxxxxxxxxx" />
                <div class="form-help">在 Zeabur 控制台的设置中创建 API Token</div>
              </div>

              <div v-if="addAccountError" class="form-error">{{ addAccountError }}</div>
              <div v-if="addAccountSuccess" class="form-success">{{ addAccountSuccess }}</div>

              <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-primary" @click="addAccountToList" :disabled="addingAccount" style="flex: 1;">
                  {{ addingAccount ? '验证中...' : '添加账号' }}
                </button>
                <button class="btn btn-secondary" @click="showAddZeaburAccountModal = false"
                  style="flex: 1;">取消</button>
              </div>
            </div>
          </div>

          <!-- ==================== DNS 相关模态框 ==================== -->
          <!-- 将这些模态框移出 tab-content 以修复因为 will-change: transform 导致的 fixed 定位失效及无法居中问题 -->

          <!-- 添加 CF 账号模态框 -->
          <div v-if="showAddDnsAccountModal" class="modal-overlay" @keydown.esc="showAddDnsAccountModal = false"
            @keydown.enter="addDnsAccount" tabindex="-1">
            <div class="modal">
              <div class="modal-header">
                <div class="modal-title">添加 Cloudflare 账号</div>
                <button class="modal-close" @click="showAddDnsAccountModal = false">&times;</button>
              </div>

              <div class="form-group">
                <label class="form-label">账号名称 *</label>
                <input v-model="dnsAccountForm.name" class="form-input" placeholder="例如: 主账号" />
              </div>

              <div class="form-group">
                <label class="form-label">API Token *</label>
                <input v-model="dnsAccountForm.apiToken" type="password" class="form-input"
                  placeholder="Cloudflare API Token" />
                <div class="form-help">在 Cloudflare 控制台 → My Profile → API Tokens 创建</div>
              </div>

              <div class="form-group">
                <label class="form-label">邮箱（可选）</label>
                <input v-model="dnsAccountForm.email" class="form-input" placeholder="用于标识账号" />
              </div>

              <div v-if="dnsAccountFormError" class="form-error">{{ dnsAccountFormError }}</div>
              <div v-if="dnsAccountFormSuccess" class="form-success">{{ dnsAccountFormSuccess }}</div>

              <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-primary" @click="addDnsAccount" :disabled="dnsSavingAccount" style="flex: 1;">
                  {{ dnsSavingAccount ? '验证中...' : '添加账号' }}
                </button>
                <button class="btn btn-secondary" @click="showAddDnsAccountModal = false" style="flex: 1;">取消</button>
              </div>
            </div>
          </div>

          <!-- 编辑 CF 账号模态框 -->
          <div v-if="showEditDnsAccountModal" class="modal-overlay" @keydown.esc="showEditDnsAccountModal = false"
            @keydown.enter="updateDnsAccount" tabindex="-1">
            <div class="modal">
              <div class="modal-header">
                <div class="modal-title">编辑 Cloudflare 账号</div>
                <button class="modal-close" @click="showEditDnsAccountModal = false">&times;</button>
              </div>

              <div class="form-group">
                <label class="form-label">账号名称 *</label>
                <input v-model="dnsEditAccountForm.name" class="form-input" placeholder="例如: 主账号" />
              </div>

              <div class="form-group">
                <label class="form-label">API Token *</label>
                <input v-model="dnsEditAccountForm.apiToken" type="password" class="form-input"
                  placeholder="Cloudflare API Token" />
                <div class="form-help">留空表示不修改 Token</div>
              </div>

              <div class="form-group">
                <label class="form-label">邮箱（可选）</label>
                <input v-model="dnsEditAccountForm.email" class="form-input" placeholder="用于标识账号" />
              </div>

              <div v-if="dnsEditAccountFormError" class="form-error">{{ dnsEditAccountFormError }}</div>
              <div v-if="dnsEditAccountFormSuccess" class="form-success">{{ dnsEditAccountFormSuccess }}</div>

              <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-primary" @click="updateDnsAccount" :disabled="dnsSavingAccount" style="flex: 1;">
                  {{ dnsSavingAccount ? '保存中...' : '保存修改' }}
                </button>
                <button class="btn btn-secondary" @click="showEditDnsAccountModal = false" style="flex: 1;">取消</button>
              </div>
            </div>
          </div>

          <!-- 添加/编辑 DNS 记录模态框 -->
          <div v-if="showDnsRecordModal" class="modal-overlay" @keydown.esc="showDnsRecordModal = false"
            @keydown.enter="saveDnsRecord" tabindex="-1">
            <div class="modal">
              <div class="modal-header">
                <div class="modal-title">{{ dnsEditingRecord ? '编辑 DNS 记录' : '添加 DNS 记录' }}</div>
                <button class="modal-close" @click="showDnsRecordModal = false">&times;</button>
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="form-group">
                  <label class="form-label">类型 *</label>
                  <select v-model="dnsRecordForm.type" class="form-input" :disabled="!!dnsEditingRecord">
                    <option v-for="t in dnsRecordTypes" :key="t" :value="t">{{ t }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">名称 *</label>
                  <input v-model="dnsRecordForm.name" class="form-input" placeholder="@ 或 www" />
                  <div class="form-help">@ 表示根域名</div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">内容 *</label>
                <input v-model="dnsRecordForm.content" class="form-input" placeholder="IP 地址或目标域名" />
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="form-group">
                  <label class="form-label">TTL</label>
                  <select v-model="dnsRecordForm.ttl" class="form-input">
                    <option :value="1">Auto</option>
                    <option :value="60">1 分钟</option>
                    <option :value="300">5 分钟</option>
                    <option :value="600">10 分钟</option>
                    <option :value="3600">1 小时</option>
                    <option :value="86400">1 天</option>
                  </select>
                </div>
                <div class="form-group" v-if="dnsRecordForm.type === 'MX'">
                  <label class="form-label">优先级</label>
                  <input v-model.number="dnsRecordForm.priority" type="number" class="form-input" placeholder="10" />
                </div>
              </div>

              <div class="form-group" v-if="canDnsBeProxied(dnsRecordForm.type)">
                <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
                  <input type="checkbox" v-model="dnsRecordForm.proxied" style="width: 16px; height: 16px;" />
                  启用 Cloudflare 代理 (橙云)
                </label>
                <div class="form-help">启用后流量将通过 Cloudflare CDN</div>
              </div>

              <div v-if="dnsRecordFormError" class="form-error">{{ dnsRecordFormError }}</div>

              <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-primary" @click="saveDnsRecord" :disabled="dnsSavingRecord" style="flex: 1;">
                  {{ dnsSavingRecord ? '保存中...' : '保存' }}
                </button>
                <button class="btn btn-secondary" @click="showDnsRecordModal = false" style="flex: 1;">取消</button>
              </div>
            </div>
          </div>

          <!-- 添加/编辑模板模态框 -->
          <div v-if="showDnsTemplateModal" class="modal-overlay" @keydown.esc="showDnsTemplateModal = false"
            @keydown.enter="saveDnsTemplate" tabindex="-1">
            <div class="modal">
              <div class="modal-header">
                <div class="modal-title">{{ dnsEditingTemplate ? '编辑模板' : '添加模板' }}</div>
                <button class="modal-close" @click="showDnsTemplateModal = false">&times;</button>
              </div>

              <div class="form-group">
                <label class="form-label">模板名称 *</label>
                <input v-model="dnsTemplateForm.name" class="form-input" placeholder="例如: CDN 记录" />
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="form-group">
                  <label class="form-label">记录类型 *</label>
                  <select v-model="dnsTemplateForm.type" class="form-input">
                    <option v-for="t in dnsRecordTypes" :key="t" :value="t">{{ t }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">TTL</label>
                  <select v-model="dnsTemplateForm.ttl" class="form-input">
                    <option :value="1">Auto</option>
                    <option :value="300">5 分钟</option>
                    <option :value="3600">1 小时</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">内容 *</label>
                <input v-model="dnsTemplateForm.content" class="form-input" placeholder="IP 地址或目标域名" />
              </div>

              <div class="form-group">
                <label class="form-label">描述（可选）</label>
                <input v-model="dnsTemplateForm.description" class="form-input" placeholder="模板用途说明" />
              </div>

              <div class="form-group" v-if="canDnsBeProxied(dnsTemplateForm.type)">
                <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
                  <input type="checkbox" v-model="dnsTemplateForm.proxied" style="width: 16px; height: 16px;" />
                  启用 Cloudflare 代理
                </label>
              </div>

              <div v-if="dnsTemplateFormError" class="form-error">{{ dnsTemplateFormError }}</div>

              <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-primary" @click="saveDnsTemplate" :disabled="dnsSavingTemplate" style="flex: 1;">
                  {{ dnsSavingTemplate ? '保存中...' : '保存' }}
                </button>
                <button class="btn btn-secondary" @click="showDnsTemplateModal = false" style="flex: 1;">取消</button>
              </div>
            </div>
          </div>

        </div> <!-- 闭合 isAuthenticated container -->
      </div> <!-- 闭合 app -->



      <!-- 模块化 JavaScript -->
      <script type="module" src="/js/main.js"></script>
</body>

</html>