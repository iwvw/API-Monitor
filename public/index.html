<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Monitor</title>
  <link rel="icon" type="image/png" href="/logo.png">
  <link rel="shortcut icon" href="/logo.png">
  <link rel="icon" href="/logo.png" sizes="32x32">
  <meta name="msapplication-TileImage" content="/logo.png">
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Custom Styles - Modularized CSS -->
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/projects.css">
  <link rel="stylesheet" href="/css/modals.css">
  <link rel="stylesheet" href="/css/dns.css">
  <link rel="stylesheet" href="/css/tables.css">
  <link rel="stylesheet" href="/css/tabs.css">
  <link rel="stylesheet" href="/css/settings.css">
  <link rel="stylesheet" href="/css/logs.css">
</head>

<body>
  <div id="app">
    <!-- é¦–æ¬¡è®¾ç½®å¯†ç ç•Œé¢ -->
    <div v-if="showSetPasswordModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">ğŸ‰ æ¬¢è¿ä½¿ç”¨</div>
        </div>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 24px;">è¯·è®¾ç½®ç®¡ç†å‘˜å¯†ç </p>
        <div class="form-group">
          <input v-model="setPassword" type="password" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
            @keyup.enter="setAdminPassword" />
        </div>
        <div class="form-group">
          <input v-model="setPasswordConfirm" type="password" class="form-input" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
            @keyup.enter="setAdminPassword" />
        </div>
        <div v-if="setPasswordError" class="form-error">
          {{ setPasswordError }}
        </div>
        <button @click="setAdminPassword" class="btn btn-primary" style="width: 100%;">
          è®¾ç½®å¯†ç 
        </button>
      </div>
    </div>

    <!-- ç™»å½•ç•Œé¢ -->
    <div v-if="showLoginModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">ğŸ” ç®¡ç†å‘˜ç™»å½•</div>
        </div>
        <div class="form-group">
          <input v-model="loginPassword" type="password" class="form-input" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç "
            @keyup.enter="verifyPassword" />
        </div>
        <div v-if="loginError" class="form-error">
          {{ loginError }}
        </div>
        <button @click="verifyPassword" class="btn btn-primary" style="width: 100%;">
          ç™»å½•
        </button>
      </div>
    </div>

    <div v-if="isAuthenticated" class="container">
      <!-- é¡µé¢å¤´éƒ¨ - æ¨¡å—æ§åˆ¶å’Œè®¾ç½® -->
      <div class="header">
        <div class="title">
          <i class="fas fa-chart-line"></i>
          API Monitor
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
          <!-- è®¾ç½®æŒ‰é’® -->
          <button class="btn btn-secondary icon-only" @click="showSettingsModal = true" title="ç³»ç»Ÿè®¾ç½®">
            <i class="fas fa-cog"></i>
          </button>
        </div>
      </div>

      <!-- ä¸»æ ‡ç­¾é¡µå¯¼èˆª -->
      <div class="main-tabs">
        <button v-if="moduleVisibility.zeabur" class="main-tab" :class="{ active: mainActiveTab === 'zeabur' }" @click="mainActiveTab = 'zeabur'">
          <i class="fas fa-rocket"></i><span> Zeabur</span>
        </button>
        <button v-if="moduleVisibility.dns" class="main-tab dns-tab" :class="{ active: mainActiveTab === 'dns' }" @click="switchToDns">
          <i class="fas fa-cloud"></i><span> CF DNS</span>
        </button>
        <button v-if="moduleVisibility.openai" class="main-tab openai-tab" :class="{ active: mainActiveTab === 'openai' }" @click="switchToOpenai">
          <i class="fas fa-robot"></i><span> OpenAI API</span>
        </button>
      </div>

      <!-- ==================== Zeabur ç›‘æ§éƒ¨åˆ† ==================== -->
      <div v-if="mainActiveTab === 'zeabur'">
        <!-- Zeabur å­æ ‡ç­¾é¡µ -->
        <div class="dns-tabs">
          <button class="dns-tab-btn" :class="{ active: zeaburCurrentTab === 'monitor' }"
            @click="zeaburCurrentTab = 'monitor'" style="background: var(--primary-color) !important;"
            v-if="zeaburCurrentTab === 'monitor'">
            <i class="fas fa-chart-line"></i> æœåŠ¡ç›‘æ§
          </button>
          <button class="dns-tab-btn" :class="{ active: zeaburCurrentTab === 'monitor' }"
            @click="zeaburCurrentTab = 'monitor'" v-else>
            <i class="fas fa-chart-line"></i> æœåŠ¡ç›‘æ§
          </button>
          <button class="dns-tab-btn" :class="{ active: zeaburCurrentTab === 'accounts' }"
            @click="zeaburCurrentTab = 'accounts'" style="background: var(--primary-color) !important;"
            v-if="zeaburCurrentTab === 'accounts'">
            <i class="fas fa-users"></i> è´¦å·ç®¡ç†
          </button>
          <button class="dns-tab-btn" :class="{ active: zeaburCurrentTab === 'accounts' }"
            @click="zeaburCurrentTab = 'accounts'" v-else>
            <i class="fas fa-users"></i> è´¦å·ç®¡ç†
          </button>
        </div>

        <!-- æœåŠ¡ç›‘æ§æ ‡ç­¾é¡µ -->
        <div v-if="zeaburCurrentTab === 'monitor'">
          <div class="info-card">
            <div class="info-card-title">ğŸ’¡ ä½¿ç”¨è¯´æ˜</div>
            <div class="info-card-content">
              æ•°æ®æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
            </div>
          </div>

          <div class="controls" style="justify-content: space-between;">
            <div style="display: flex; gap: 10px; align-items: center;">
              <button class="btn btn-primary" @click="fetchData" :disabled="loading">
                <i class="fas fa-sync-alt"></i>
                {{ loading ? 'æ•°æ®æ›´æ–°' : 'åˆ·æ–°æ•°æ®' }}
              </button>
              <button class="btn btn-secondary" @click="toggleDataRefresh"
                :class="dataRefreshPaused ? 'btn-success' : 'btn-warning'">
                <i class="fas" :class="dataRefreshPaused ? 'fa-play' : 'fa-pause'"></i>
                {{ dataRefreshPaused ? 'ç»§ç»­æ›´æ–°' : 'æš‚åœæ›´æ–°' }}
              </button>
              <button class="btn btn-danger" @click="clearCache">
                <i class="fas fa-trash"></i>
                æ¸…é™¤ç¼“å­˜
              </button>
            </div>
            <div class="refresh-info">
              <div class="last-update">å°†åœ¨ {{ refreshCountdown }} ç§’ååˆ·æ–°</div>
              <div class="refresh-progress">
                <div class="refresh-progress-bar" :style="{ width: refreshProgress + '%' }"></div>
              </div>
            </div>
          </div>

        <!-- æ—¥å¿—æ¨¡æ€æ¡† -->
        <div v-if="showLogsModal" class="modal-overlay" :class="{ 'logs-fullscreen-overlay': logsFullscreen }"
          @keydown.esc="showLogsModal = false" tabindex="-1">
          <div class="modal logs-modal" :class="{ 'logs-modal-fullscreen': logsFullscreen }">
            <div class="logs-header">
              <div class="logs-title">ğŸ“‹ {{ logsModalTitle }}</div>
              <div class="logs-controls">
                <button class="btn btn-secondary" @click="toggleRealTimeRefresh"
                  style="margin-right: 8px; padding: 6px 10px; font-size: 12px;">
                  <i class="fas" :class="logsRealTime ? 'fa-stop' : 'fa-play'"></i>
                  {{ logsRealTime ? 'åœæ­¢å®æ—¶' : 'å®æ—¶åˆ·æ–°' }}
                </button>
                <button class="btn btn-secondary" @click="toggleAutoScroll"
                  style="margin-right: 8px; padding: 6px 10px; font-size: 12px;">
                  <i class="fas" :class="logsAutoScroll ? 'fa-pause' : 'fa-play'"></i>
                  {{ logsAutoScroll ? 'åœæ­¢æ»šåŠ¨' : 'è‡ªåŠ¨æ»šåŠ¨' }}
                </button>
                <button class="btn btn-secondary" @click="toggleFullscreen"
                  style="margin-right: 8px; padding: 6px 10px; font-size: 12px;">
                  <i class="fas" :class="logsFullscreen ? 'fa-compress' : 'fa-expand'"></i>
                  {{ logsFullscreen ? 'é€€å‡ºå…¨å±' : 'å…¨å±' }}
                </button>
                <button class="btn btn-danger" @click="showLogsModal = false"
                  style="padding: 6px 10px; font-size: 12px;">
                  <i class="fas fa-times"></i>
                  å…³é—­
                </button>
              </div>
            </div>
            <div class="logs-info">
              <span>é¡¹ç›®: {{ logsModalInfo.project }}</span>
              <span>è´¦å·: {{ logsModalInfo.account }}</span>
              <span>æ—¥å¿—: {{ logsModalInfo.count }} æ¡</span>
              <span>æ—¶é—´: {{ logsModalInfo.time }}</span>
            </div>
            <div class="logs-content" ref="logsContent" @wheel.stop @touchmove.stop>
              <div v-if="logsLoading" style="text-align: center; padding: 40px;">â³ æ­£åœ¨åŠ è½½æ—¥å¿—...</div>
              <div v-else class="logs-text-container" ref="logsTextContainer">
                <pre class="logs-text" ref="logsText">{{ logsContent || 'æš‚æ— æ—¥å¿—' }}</pre>
                <div class="logs-horizontal-scrollbar" ref="logsScrollbar">
                  <div class="logs-scrollbar-thumb" ref="logsScrollbarThumb"></div>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div v-if="accounts.length > 0" class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">è´¦å·æ•°</div>
            <div class="stat-value">{{ accounts.length }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">é¡¹ç›®æ€»æ•°</div>
            <div class="stat-value">{{ totalProjects }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">æœåŠ¡æ€»æ•°</div>
            <div class="stat-value">{{ totalServices }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">è¿è¡Œä¸­</div>
            <div class="stat-value">{{ runningServices }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">æ€»è´¹ç”¨</div>
            <div class="stat-value">${{ totalCost.toFixed(2) }}</div>
          </div>
        </div>

        <div v-if="loading && accounts.length === 0" class="loading">
          âš¡ æ­£åœ¨åŠ è½½æ•°æ®...
        </div>

        <div v-for="account in accounts" :key="account.name" class="account-card">
          <div class="account-header" @click="toggleAccount(account.name)">
            <div class="account-info">
              <span style="font-size: 20px; transition: transform 0.3s; display: inline-flex; align-items: center;"
                :style="{ 
          /* ä¿æŒ span ä½œä¸ºä¸€ä¸ªå®¹å™¨ï¼Œä¸æ—‹è½¬æˆ–æ—‹è½¬åˆ°ç‰¹å®šè§’åº¦ */
          transform: isAccountExpanded(account.name) ? 'rotate(0deg)' : 'rotate(0deg)' 
      }">

                <i class="fas fa-chevron-right toggle-icon" :style="{ 
           transition: 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)', 
           // é€»è¾‘è°ƒæ•´ï¼š
           // å±•å¼€ (true) -> 0deg (å‘ä¸‹)
           // æ”¶èµ· (false) -> 90deg (å‘å³)
           transform: isAccountExpanded(account.name) ? 'rotate(90deg)' : 'rotate(0deg)' 
       }">
                </i>
              </span>
              <div>
                <div class="account-name" v-if="!account.isEditingName" @dblclick.stop="startEditAccountName(account)">
                  {{ account.name }}
                </div>
                <div v-else class="account-name-edit" @click.stop>
                  <input v-model="account.editingName" @keyup.enter="saveAccountName(account)"
                    @keyup.esc="cancelEditAccountName(account)" @blur="saveAccountName(account)" class="edit-input"
                    ref="accountNameInput" style="width: 150px;" />
                  <button @click.stop="cancelEditAccountName(account)" class="cancel-btn" title="å–æ¶ˆ"
                    style="margin-left: 4px;">
                    âœ–ï¸
                  </button>
                </div>
                <div v-if="account.data" class="account-email">
                  {{ maskEmail(account.data.email) || account.data.username }}
                </div>
              </div>
            </div>
            <div class="account-balance">
              <div style="display: flex; flex-direction: column; gap: 3px;">
                <div class="balance-card credit-balance-card">
                  <div class="balance-icon">ğŸ’°</div>
                  <div class="balance-amount" :class="getBalanceClass(account.data.credit)">
                    ${{ (account.data.credit / 100).toFixed(2) }}
                  </div>
                </div>
                <div class="balance-card ai-balance-card">
                  <div class="balance-icon">ğŸ¤–</div>
                  <div class="balance-amount">
                    {{ account.aihub && account.aihub.balance ? '$' + (account.aihub.balance / 100000).toFixed(2) : 'æ— '
                    }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-if="account.error" class="error">
            âŒ é”™è¯¯: {{ account.error }}
          </div>

          <div v-if="account.projects" class="projects-grid" :class="{ 'collapsed': !isAccountExpanded(account.name) }">
            <div v-for="project in account.projects" :key="project._id" :id="'proj-' + project._id"
              class="project-card">
              <div class="project-header">
                <div style="flex: 1;">
                  <div class="project-name">
                    <span v-if="!project.isEditing">ğŸ“¦ {{ project.name }}</span>
                    <input v-else v-model="project.editingName" @keyup.enter="saveProjectName(account, project)"
                      @keyup.esc="cancelEditProjectName(project)" @blur="saveProjectName(account, project)"
                      class="edit-input" ref="projectNameInput" />
                    <button v-if="!project.isEditing" @click="startEditProjectName(project)" class="edit-btn"
                      title="é‡å‘½åé¡¹ç›®">
                      âœï¸
                    </button>
                    <button v-else @click="cancelEditProjectName(project)" class="cancel-btn" title="å–æ¶ˆ">
                      âœ–ï¸
                    </button>
                  </div>
                  <div class="project-info">
                    ğŸ“ {{ project.region }}
                  </div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 2px;">æœ¬æœˆç”¨é‡</div>
                  <div class="project-cost"
                    :style="{ color: project.cost === 0 ? 'var(--info-color)' : 'var(--info-color)' }"
                    :title="project.cost === 0 ? 'æš‚æ— è´¹ç”¨è®°å½•' : ''">
                    ${{ formatCost(project.cost) }}
                  </div>
                </div>
              </div>
              <div class="project-stats">
                <span>ğŸ”§ {{ project.services.length }} ä¸ªæœåŠ¡</span>
                <span>âœ… {{ project.services.filter(s => s.status === 'RUNNING').length }} è¿è¡Œä¸­</span>
                <span>â¸ï¸ {{ project.services.filter(s => s.status === 'SUSPENDED').length }} å·²æš‚åœ</span>
              </div>
              <div class="services-container">
                <div v-for="service in project.services" :key="service._id"
                  :class="['service-item', service.status.toLowerCase()]">
                  <div class="service-header">
                    <div class="service-name" :title="service.name">
                      {{ service.name }}
                    </div>
                    <div :class="['service-status', service.status.toLowerCase()]">
                      {{ service.status === 'RUNNING' ? 'è¿è¡Œä¸­' : service.status === 'SUSPENDED' ? 'å·²æš‚åœ' : service.status
                      }}
                    </div>
                  </div>
                  <div v-if="service.resourceLimit" class="service-info">
                    <span style="display: inline-flex; align-items: center; gap: 4px; margin-right: 12px;">
                      <i class="fas fa-microchip"></i>
                      {{ service.resourceLimit.cpu }}m
                    </span>
                    <span style="display: inline-flex; align-items: center; gap: 4px;">
                      <i class="fas fa-memory"></i>
                      {{ service.resourceLimit.memory }}MB
                    </span>
                  </div>
                  <div class="service-actions">
                    <button v-if="service.status === 'RUNNING'" @click="pauseService(account, project, service)"
                      class="service-btn btn-pause">
                      <i class="fas fa-pause"></i>
                      æš‚åœ
                    </button>
                    <button @click="restartService(account, project, service)" class="service-btn btn-restart">
                      <i class="fas fa-redo"></i>
                      {{ service.status === 'SUSPENDED' ? 'å¯åŠ¨' : 'é‡å¯' }}
                    </button>
                    <button @click="showServiceLogs(account, project, service)" class="service-btn btn-logs">
                      <i class="fas fa-file-alt"></i>
                      æ—¥å¿—
                    </button>
                  </div>
                </div>
                <div v-if="project.services.length === 0" class="empty-state">
                  æš‚æ— æœåŠ¡
                </div>
              </div>

              <!-- é¡¹ç›®åŸŸå -->
              <div v-if="getProjectDomains(project).length > 0" class="domains-container">
                <a v-for="domainInfo in getProjectDomains(project)" :key="domainInfo.domain"
                  :href="'https://' + domainInfo.domain" target="_blank" class="domain-link">
                  <i class="fas fa-globe"></i>
                  <span>{{ domainInfo.domain }}</span>
                  <span v-if="domainInfo.isGenerated" class="domain-badge">è‡ªåŠ¨</span>
                </a>
              </div>
            </div>
          </div>
        </div>

          <div v-if="!loading && accounts.length === 0" class="error">
            æœªé…ç½®è´¦å·æˆ–æ— æ³•è·å–æ•°æ®ã€‚è¯·æ£€æŸ¥ .env é…ç½®æ–‡ä»¶ã€‚
          </div>
        </div>
        <!-- æœåŠ¡ç›‘æ§æ ‡ç­¾é¡µç»“æŸ -->

        <!-- è´¦å·ç®¡ç†æ ‡ç­¾é¡µ -->
        <div v-if="zeaburCurrentTab === 'accounts'">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Zeabur è´¦å·</div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-secondary" @click="exportAllAccounts" style="padding: 6px 12px;">
                  <i class="fas fa-download"></i> å¯¼å‡º
                </button>
                <button class="btn btn-secondary" @click="importAllAccounts" style="padding: 6px 12px;">
                  <i class="fas fa-upload"></i> å¯¼å…¥
                </button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>åç§°</th>
                    <th>é‚®ç®±</th>
                    <th>ä½™é¢</th>
                    <th>çŠ¶æ€</th>
                    <th style="width: 150px;">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(account, index) in managedAccounts" :key="'local-' + index">
                    <td>{{ account.name }}</td>
                    <td>{{ account.email || '-' }}</td>
                    <td>
                      <span v-if="account.balance !== null && account.balance !== undefined">
                        ${{ account.balance.toFixed(2) }}
                      </span>
                      <span v-else>-</span>
                    </td>
                    <td>
                      <span class="proxied-badge" :class="account.status === 'active' ? 'proxied-on' : 'proxied-off'">
                        {{ account.status === 'active' ? 'æ­£å¸¸' : 'æœªçŸ¥' }}
                      </span>
                    </td>
                    <td class="actions">
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="removeAccount(index)" title="åˆ é™¤">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  <!-- æ˜¾ç¤ºæœåŠ¡å™¨é…ç½®çš„è´¦å·ï¼ˆåªè¯»ï¼‰ -->
                  <tr v-if="managedAccounts.length === 0 && accounts.length > 0" v-for="account in accounts" :key="'server-' + account.name">
                    <td>{{ account.name }}</td>
                    <td>{{ account.data?.email || '-' }}</td>
                    <td>
                      <span v-if="account.data?.credit">
                        ${{ (account.data.credit / 100).toFixed(2) }}
                      </span>
                      <span v-else>-</span>
                    </td>
                    <td>
                      <span class="proxied-badge proxied-off">
                        æœåŠ¡å™¨é…ç½®
                      </span>
                    </td>
                    <td class="actions">
                      <span style="font-size: 12px; color: var(--text-tertiary);">
                        ğŸ”’ åªè¯»
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="managedAccounts.length === 0 && accounts.length === 0" class="empty-state">
                <i class="fas fa-user-plus" style="font-size: 48px; margin-bottom: 16px;"></i>
                <div>æš‚æ— è´¦å·ï¼Œè¯·æ·»åŠ  Zeabur è´¦å·</div>
              </div>
            </div>
          </div>

          <!-- æ·»åŠ æ–°è´¦å·è¡¨å• -->
          <div class="panel" style="margin-top: 16px;">
            <div class="panel-header">
              <div class="panel-title">â• æ·»åŠ æ–°è´¦å·</div>
            </div>

            <div style="padding: 16px;">
              <div class="form-group" style="margin-bottom: 12px;">
                <label class="form-label">è´¦å·åç§°</label>
                <input v-model="newAccount.name" type="text" class="form-input" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„è´¦å·" />
              </div>

              <div class="form-group" style="margin-bottom: 12px;">
                <label class="form-label">API Token</label>
                <input v-model="newAccount.token" type="password" class="form-input"
                  placeholder="sk-xxxxxxxxxxxxxxxx" />
                <div class="form-help">
                  åœ¨ Zeabur æ§åˆ¶å°çš„è®¾ç½®ä¸­åˆ›å»º API Token
                </div>
              </div>

              <div v-if="addAccountError" class="form-error">
                {{ addAccountError }}
              </div>

              <div v-if="addAccountSuccess" class="form-success">
                {{ addAccountSuccess }}
              </div>

              <button class="btn btn-primary" @click="addAccountToList" :disabled="addingAccount" style="width: 100%;">
                {{ addingAccount ? 'éªŒè¯ä¸­...' : 'â• æ·»åŠ åˆ°åˆ—è¡¨' }}
              </button>
            </div>
          </div>

          <!-- æ‰¹é‡æ·»åŠ  -->
          <div class="panel" style="margin-top: 16px;">
            <div class="panel-header">
              <div class="panel-title">ğŸ“¦ æ‰¹é‡æ·»åŠ è´¦å·</div>
            </div>
            <div style="padding: 16px;">
              <div class="form-help" style="margin-bottom: 12px;">
                æ¯è¡Œä¸€ä¸ªè´¦å·ï¼Œæ”¯æŒæ ¼å¼ï¼š<code>åç§°:Token</code> æˆ– <code>åç§°ï¼šToken</code> æˆ– <code>åç§°(Token)</code> æˆ–
                <code>åç§°ï¼ˆTokenï¼‰</code>
              </div>
              <div style="position: relative; min-height: 120px;">
                <div
                  style="width: 100%; min-height: 120px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 13px; font-family: monospace; white-space: pre-wrap; word-break: break-all; pointer-events: none; color: var(--text-primary); line-height: 1.5; background-color: var(--input-bg);">
                  {{ maskedBatchAccounts }}</div>
                <textarea v-model="batchAccounts" @input="updateBatchDisplay" placeholder="æ¯è¡Œä¸€ä¸ªè´¦å·ï¼Œæ ¼å¼ï¼šè´¦å·åç§°:API_Token"
                  class="form-textarea"
                  style="position: absolute; top: 0; left: 0; color: transparent; caret-color: var(--text-primary); background: transparent; line-height: 1.5;"></textarea>
              </div>
              <div v-if="batchAddError" class="form-error">
                {{ batchAddError }}
              </div>
              <div v-if="batchAddSuccess" class="form-success">
                {{ batchAddSuccess }}
              </div>
              <button class="btn btn-primary" @click="batchAddAccounts" :disabled="addingAccount"
                style="width: 100%; margin-top: 12px;">
                {{ addingAccount ? 'æ·»åŠ ä¸­...' : 'ğŸ“¦ æ‰¹é‡æ·»åŠ ' }}
              </button>
            </div>
          </div>
        </div>
        <!-- è´¦å·ç®¡ç†æ ‡ç­¾é¡µç»“æŸ -->

      </div>
      <!-- ==================== Zeabur ç›‘æ§éƒ¨åˆ†ç»“æŸ ==================== -->

      <!-- ==================== DNS ç®¡ç†éƒ¨åˆ† ==================== -->
      <div v-if="mainActiveTab === 'dns'">
        <!-- Toast -->
        <div v-if="dnsToast.show" class="toast" :class="dnsToast.type">{{ dnsToast.message }}</div>

        <!-- DNS å­æ ‡ç­¾é¡µ -->
        <div class="dns-tabs">
          <button class="dns-tab-btn" :class="{ active: dnsCurrentTab === 'dns' }" @click="dnsCurrentTab = 'dns'">
            <i class="fas fa-globe"></i> DNS è®°å½•
          </button>
          <button class="dns-tab-btn" :class="{ active: dnsCurrentTab === 'accounts' }"
            @click="dnsCurrentTab = 'accounts'">
            <i class="fas fa-users"></i> è´¦å·ç®¡ç†
          </button>
          <!-- <button class="dns-tab-btn" :class="{ active: dnsCurrentTab === 'templates' }"
            @click="dnsCurrentTab = 'templates'">
            <i class="fas fa-copy"></i> æ¨¡æ¿
          </button> -->
        </div>

        <!-- DNS è®°å½•æ ‡ç­¾é¡µ -->
        <div v-if="dnsCurrentTab === 'dns'">
          <!-- è´¦å·é€‰æ‹© - å¡ç‰‡å¼ -->
          <div style="margin-bottom: 16px;">
            <label style="font-weight: 500; margin-bottom: 12px; display: block;">é€‰æ‹©è´¦å·ï¼š</label>
            <div class="zones-grid">
              <div v-for="acc in dnsAccounts" :key="acc.id" class="zone-card"
                :class="{ active: dnsSelectedAccountId === acc.id }" @click="selectDnsAccount(acc)">
                <div style="flex: 1;">
                  <div class="zone-name">
                    <i class="fas fa-user-circle" style="margin-right: 6px; color: var(--cf-color);"></i>
                    {{ acc.name }}
                  </div>
                  <div class="zone-status" style="font-size: 11px;">{{ acc.email || 'è´¦å·' }}</div>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <i v-if="dnsSelectedAccountId === acc.id" class="fas fa-check-circle" style="color: var(--cf-color);"></i>
                  <button v-if="dnsSelectedAccountId === acc.id" class="btn btn-secondary"
                    style="padding: 4px 8px; font-size: 12px;"
                    @click.stop="loadDnsZones" :disabled="dnsLoadingZones">
                    <i class="fas fa-sync-alt" :class="{ 'fa-spin': dnsLoadingZones }"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div v-if="dnsLoadingZones" class="loading">
            <div class="spinner"></div>
            <div style="margin-top: 12px;">åŠ è½½åŸŸååˆ—è¡¨...</div>
          </div>

          <!-- åŸŸåç½‘æ ¼ -->
          <div v-if="dnsSelectedAccountId && dnsZones.length > 0 && !dnsLoadingZones" class="zones-grid">
            <div v-for="zone in dnsZones" :key="zone.id" class="zone-card"
              :class="{ active: dnsSelectedZoneId === zone.id }" @click="selectDnsZone(zone)">
              <div>
                <div class="zone-name">{{ zone.name }}</div>
                <div class="zone-status" :class="zone.status">{{ zone.status }}</div>
              </div>
              <i class="fas fa-chevron-right" style="color: var(--text-tertiary);"></i>
            </div>
          </div>

          <div v-if="dnsSelectedAccountId && dnsZones.length === 0 && !dnsLoadingZones" class="empty-state">
            <i class="fas fa-globe" style="font-size: 48px; margin-bottom: 16px;"></i>
            <div>è¯¥è´¦å·ä¸‹æ²¡æœ‰åŸŸå</div>
          </div>

          <!-- å¿«é€Ÿåˆ‡æ¢ -->
          <div v-if="dnsSelectedZoneId" class="quick-switch">
            <i class="fas fa-bolt" style="color: var(--cf-color);"></i>
            <span style="font-weight: 500; white-space: nowrap;">å¿«é€Ÿåˆ‡æ¢ï¼š</span>
            <select v-model="dnsQuickSwitchType"
              style="color: #f38020; padding: 6px 10px; border-radius: 4px; border: 1px solid var(--input-border); background: var(--input-bg); min-width: 80px;">
              <option value="A">A</option>
              <option value="AAAA">AAAA</option>
              <option value="CNAME">CNAME</option>
            </select>
            <input v-model="dnsQuickSwitchName" placeholder="è®°å½•åç§° (å¦‚ @, www, *)" />
            <input v-model="dnsQuickSwitchContent" placeholder="æ–°çš„å†…å®¹ (IP æˆ–åŸŸå)" />
            <button class="btn btn-cf" style="padding: 6px 12px;" @click="dnsQuickSwitch" :disabled="dnsSwitching">
              {{ dnsSwitching ? 'åˆ‡æ¢ä¸­...' : 'åˆ‡æ¢' }}
            </button>
          </div>

          <!-- DNS è®°å½•è¡¨æ ¼ -->
          <div v-if="dnsSelectedZoneId" class="panel">
            <div class="panel-header">
              <div class="panel-title">DNSè®°å½•</div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddDnsRecordModal">
                  <i class="fas fa-plus"></i> æ·»åŠ 
                </button>
                <button v-if="dnsSelectedRecords.length > 0" class="btn btn-danger" style="padding: 6px 12px;"
                  @click="batchDeleteDnsRecords">
                  <i class="fas fa-trash-alt"></i> åˆ é™¤ ({{ dnsSelectedRecords.length }})
                </button>
                <button class="btn btn-secondary" style="padding: 6px 10px;" @click="loadDnsRecords"
                  :disabled="dnsLoadingRecords">
                  <i class="fas fa-sync-alt" :class="{ 'fa-spin': dnsLoadingRecords }"></i>
                </button>
              </div>
            </div>

            <div v-if="dnsLoadingRecords" class="loading">
              <div class="spinner"></div>
              <div style="margin-top: 12px;">åŠ è½½ä¸­...</div>
            </div>

            <div v-else class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th style="width: 5%;">
                      <input type="checkbox" @change="toggleSelectAllDnsRecords"
                        :checked="dnsSelectedRecords.length === dnsRecords.length && dnsRecords.length > 0"
                        style="width: 16px; height: 16px; cursor: pointer;">
                    </th>
                    <th style="width: 12%;">ç±»å‹</th>
                    <th style="width: 18%;">åç§°</th>
                    <th style="width: 28%;">å†…å®¹</th>
                    <th style="width: 8%;">ä»£ç†</th>
                    <th style="width: 8%;">TTL</th>
                    <th style="width: 10%;">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="record in dnsRecords" :key="record.id">
                    <td>
                      <input type="checkbox" :value="record.id" v-model="dnsSelectedRecords"
                        style="width: 16px; height: 16px; cursor: pointer;">
                    </td>
                    <td><span class="record-type" :class="record.type">{{ record.type }}</span></td>
                    <td>
                      <div v-if="!record.isEditingName" class="editable-cell"
                        :title="formatDnsRecordName(record.name) + ' (åŒå‡»ç¼–è¾‘)'" @dblclick="startEditDnsName(record)">
                        {{ formatDnsRecordName(record.name) }}
                      </div>
                      <div v-else class="inline-edit-container" @click.stop>
                        <input v-model="record.editingName" class="inline-edit-input" @keyup.enter="saveDnsName(record)"
                          @keyup.esc="cancelEditDnsName(record)" @blur="saveDnsName(record)" ref="dnsNameInput" />
                        <button @click.stop="cancelEditDnsName(record)" class="inline-edit-cancel" title="å–æ¶ˆ">
                          âœ–ï¸
                        </button>
                      </div>
                    </td>
                    <td>
                      <div v-if="!record.isEditingContent" class="content-truncate editable-cell"
                        :title="record.content + ' (åŒå‡»ç¼–è¾‘)'" @dblclick="startEditDnsContent(record)">
                        {{ record.content }}
                      </div>
                      <div v-else class="inline-edit-container" @click.stop>
                        <input v-model="record.editingContent" class="inline-edit-input"
                          @keyup.enter="saveDnsContent(record)" @keyup.esc="cancelEditDnsContent(record)"
                          @blur="saveDnsContent(record)" ref="dnsContentInput" />
                        <button @click.stop="cancelEditDnsContent(record)" class="inline-edit-cancel" title="å–æ¶ˆ">
                          âœ–ï¸
                        </button>
                      </div>
                    </td>
                    <td>
                      <span class="proxied-badge" :class="record.proxied ? 'proxied-on' : 'proxied-off'">
                        {{ record.proxied ? 'å¼€å¯' : 'å…³é—­' }}
                      </span>
                    </td>
                    <td>{{ record.ttl === 1 ? 'Auto' : record.ttl }}</td>
                    <td class="actions">
                      <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                        @click="editDnsRecord(record)" title="ç¼–è¾‘">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="deleteDnsRecord(record)" title="åˆ é™¤">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="dnsRecords.length === 0" class="empty-state">æš‚æ—  DNS è®°å½•</div>
            </div>
          </div>
        </div>

        <!-- CF è´¦å·ç®¡ç†æ ‡ç­¾é¡µ -->
        <div v-if="dnsCurrentTab === 'accounts'">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Cloudflare è´¦å·</div>
              <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddDnsAccountModal">
                <i class="fas fa-plus"></i> æ·»åŠ è´¦å·
              </button>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>åç§°</th>
                    <th>é‚®ç®±</th>
                    <th>æ·»åŠ æ—¶é—´</th>
                    <th>æœ€åä½¿ç”¨</th>
                    <th style="width: 150px;">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="acc in dnsAccounts" :key="acc.id">
                    <td>{{ acc.name }}</td>
                    <td>{{ acc.email || '-' }}</td>
                    <td>{{ formatDnsDate(acc.createdAt) }}</td>
                    <td>{{ acc.lastUsed ? formatDnsDate(acc.lastUsed) : '-' }}</td>
                    <td class="actions">
                      <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                        @click="verifyDnsAccount(acc)" title="éªŒè¯Token">
                        <i class="fas fa-check"></i>
                      </button>
                      <button class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;"
                        @click="editDnsAccount(acc)" title="ç¼–è¾‘">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="deleteDnsAccount(acc)" title="åˆ é™¤">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="dnsAccounts.length === 0" class="empty-state">
                <i class="fas fa-key" style="font-size: 48px; margin-bottom: 16px;"></i>
                <div>æš‚æ— è´¦å·ï¼Œè¯·æ·»åŠ  Cloudflare API Token</div>
              </div>
            </div>
          </div>
        </div>

        <!-- æ¨¡æ¿æ ‡ç­¾é¡µ -->
        <div v-if="dnsCurrentTab === 'templates'">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">DNS æ¨¡æ¿</div>
              <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddDnsTemplateModal">
                <i class="fas fa-plus"></i> æ·»åŠ æ¨¡æ¿
              </button>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>åç§°</th>
                    <th style="width: 60px;">ç±»å‹</th>
                    <th>å†…å®¹</th>
                    <th style="width: 70px;">ä»£ç†</th>
                    <th>æè¿°</th>
                    <th style="width: 120px;">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="tpl in dnsTemplates" :key="tpl.id">
                    <td>{{ tpl.name }}</td>
                    <td><span class="record-type" :class="tpl.type">{{ tpl.type }}</span></td>
                    <td>
                      <div class="content-truncate" :title="tpl.content">{{ tpl.content }}</div>
                    </td>
                    <td>
                      <span class="proxied-badge" :class="tpl.proxied ? 'proxied-on' : 'proxied-off'">
                        {{ tpl.proxied ? 'å¼€å¯' : 'å…³é—­' }}
                      </span>
                    </td>
                    <td>{{ tpl.description || '-' }}</td>
                    <td class="actions">
                      <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                        @click="editDnsTemplate(tpl)" title="ç¼–è¾‘">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;"
                        @click="deleteDnsTemplate(tpl)" title="åˆ é™¤">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div v-if="dnsTemplates.length === 0" class="empty-state">
                <i class="fas fa-copy" style="font-size: 48px; margin-bottom: 16px;"></i>
                <div>æš‚æ— æ¨¡æ¿ï¼Œæ·»åŠ å¸¸ç”¨ DNS é…ç½®æ¨¡æ¿ä»¥å¿«é€Ÿåº”ç”¨</div>
              </div>
            </div>
          </div>
        </div>

        <!-- æ·»åŠ  CF è´¦å·æ¨¡æ€æ¡† -->
        <div v-if="showAddDnsAccountModal" class="modal-overlay" @click.self="showAddDnsAccountModal = false">
          <div class="modal">
            <div class="modal-header">
              <div class="modal-title">æ·»åŠ  Cloudflare è´¦å·</div>
              <button class="modal-close" @click="showAddDnsAccountModal = false">&times;</button>
            </div>

            <div class="form-group">
              <label class="form-label">è´¦å·åç§° *</label>
              <input v-model="dnsAccountForm.name" class="form-input" placeholder="ä¾‹å¦‚: ä¸»è´¦å·" />
            </div>

            <div class="form-group">
              <label class="form-label">API Token *</label>
              <input v-model="dnsAccountForm.apiToken" type="password" class="form-input"
                placeholder="Cloudflare API Token" />
              <div class="form-help">åœ¨ Cloudflare æ§åˆ¶å° â†’ My Profile â†’ API Tokens åˆ›å»º</div>
            </div>

            <div class="form-group">
              <label class="form-label">é‚®ç®±ï¼ˆå¯é€‰ï¼‰</label>
              <input v-model="dnsAccountForm.email" class="form-input" placeholder="ç”¨äºæ ‡è¯†è´¦å·" />
            </div>

            <div v-if="dnsAccountFormError" class="form-error">{{ dnsAccountFormError }}</div>
            <div v-if="dnsAccountFormSuccess" class="form-success">{{ dnsAccountFormSuccess }}</div>

            <div style="display: flex; gap: 12px; margin-top: 20px;">
              <button class="btn btn-primary" @click="addDnsAccount" :disabled="dnsSavingAccount" style="flex: 1;">
                {{ dnsSavingAccount ? 'éªŒè¯ä¸­...' : 'æ·»åŠ è´¦å·' }}
              </button>
              <button class="btn btn-secondary" @click="showAddDnsAccountModal = false" style="flex: 1;">å–æ¶ˆ</button>
            </div>
          </div>
        </div>

        <!-- ç¼–è¾‘ CF è´¦å·æ¨¡æ€æ¡† -->
        <div v-if="showEditDnsAccountModal" class="modal-overlay" @click.self="showEditDnsAccountModal = false">
          <div class="modal">
            <div class="modal-header">
              <div class="modal-title">ç¼–è¾‘ Cloudflare è´¦å·</div>
              <button class="modal-close" @click="showEditDnsAccountModal = false">&times;</button>
            </div>

            <div class="form-group">
              <label class="form-label">è´¦å·åç§° *</label>
              <input v-model="dnsEditAccountForm.name" class="form-input" placeholder="ä¾‹å¦‚: ä¸»è´¦å·" />
            </div>

            <div class="form-group">
              <label class="form-label">API Token *</label>
              <input v-model="dnsEditAccountForm.apiToken" type="password" class="form-input"
                placeholder="Cloudflare API Token" />
              <div class="form-help">ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹ Token</div>
            </div>

            <div class="form-group">
              <label class="form-label">é‚®ç®±ï¼ˆå¯é€‰ï¼‰</label>
              <input v-model="dnsEditAccountForm.email" class="form-input" placeholder="ç”¨äºæ ‡è¯†è´¦å·" />
            </div>

            <div v-if="dnsEditAccountFormError" class="form-error">{{ dnsEditAccountFormError }}</div>
            <div v-if="dnsEditAccountFormSuccess" class="form-success">{{ dnsEditAccountFormSuccess }}</div>

            <div style="display: flex; gap: 12px; margin-top: 20px;">
              <button class="btn btn-primary" @click="updateDnsAccount" :disabled="dnsSavingAccount" style="flex: 1;">
                {{ dnsSavingAccount ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ä¿®æ”¹' }}
              </button>
              <button class="btn btn-secondary" @click="showEditDnsAccountModal = false" style="flex: 1;">å–æ¶ˆ</button>
            </div>
          </div>
        </div>

        <!-- æ·»åŠ /ç¼–è¾‘ DNS è®°å½•æ¨¡æ€æ¡† -->
        <div v-if="showDnsRecordModal" class="modal-overlay" @click.self="showDnsRecordModal = false">
          <div class="modal">
            <div class="modal-header">
              <div class="modal-title">{{ dnsEditingRecord ? 'ç¼–è¾‘ DNS è®°å½•' : 'æ·»åŠ  DNS è®°å½•' }}</div>
              <button class="modal-close" @click="showDnsRecordModal = false">&times;</button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div class="form-group">
                <label class="form-label">ç±»å‹ *</label>
                <select v-model="dnsRecordForm.type" class="form-input" :disabled="!!dnsEditingRecord">
                  <option v-for="t in dnsRecordTypes" :key="t" :value="t">{{ t }}</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">åç§° *</label>
                <input v-model="dnsRecordForm.name" class="form-input" placeholder="@ æˆ– www" />
                <div class="form-help">@ è¡¨ç¤ºæ ¹åŸŸå</div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">å†…å®¹ *</label>
              <input v-model="dnsRecordForm.content" class="form-input" placeholder="IP åœ°å€æˆ–ç›®æ ‡åŸŸå" />
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div class="form-group">
                <label class="form-label">TTL</label>
                <select v-model="dnsRecordForm.ttl" class="form-input">
                  <option :value="1">Auto</option>
                  <option :value="60">1 åˆ†é’Ÿ</option>
                  <option :value="300">5 åˆ†é’Ÿ</option>
                  <option :value="600">10 åˆ†é’Ÿ</option>
                  <option :value="3600">1 å°æ—¶</option>
                  <option :value="86400">1 å¤©</option>
                </select>
              </div>
              <div class="form-group" v-if="dnsRecordForm.type === 'MX'">
                <label class="form-label">ä¼˜å…ˆçº§</label>
                <input v-model.number="dnsRecordForm.priority" type="number" class="form-input" placeholder="10" />
              </div>
            </div>

            <div class="form-group" v-if="canDnsBeProxied(dnsRecordForm.type)">
              <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
                <input type="checkbox" v-model="dnsRecordForm.proxied" style="width: 16px; height: 16px;" />
                å¯ç”¨ Cloudflare ä»£ç† (æ©™äº‘)
              </label>
              <div class="form-help">å¯ç”¨åæµé‡å°†é€šè¿‡ Cloudflare CDN</div>
            </div>

            <div v-if="dnsRecordFormError" class="form-error">{{ dnsRecordFormError }}</div>

            <div style="display: flex; gap: 12px; margin-top: 20px;">
              <button class="btn btn-primary" @click="saveDnsRecord" :disabled="dnsSavingRecord" style="flex: 1;">
                {{ dnsSavingRecord ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}
              </button>
              <button class="btn btn-secondary" @click="showDnsRecordModal = false" style="flex: 1;">å–æ¶ˆ</button>
            </div>
          </div>
        </div>

        <!-- æ·»åŠ /ç¼–è¾‘æ¨¡æ¿æ¨¡æ€æ¡† -->
        <div v-if="showDnsTemplateModal" class="modal-overlay" @click.self="showDnsTemplateModal = false">
          <div class="modal">
            <div class="modal-header">
              <div class="modal-title">{{ dnsEditingTemplate ? 'ç¼–è¾‘æ¨¡æ¿' : 'æ·»åŠ æ¨¡æ¿' }}</div>
              <button class="modal-close" @click="showDnsTemplateModal = false">&times;</button>
            </div>

            <div class="form-group">
              <label class="form-label">æ¨¡æ¿åç§° *</label>
              <input v-model="dnsTemplateForm.name" class="form-input" placeholder="ä¾‹å¦‚: CDN è®°å½•" />
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div class="form-group">
                <label class="form-label">è®°å½•ç±»å‹ *</label>
                <select v-model="dnsTemplateForm.type" class="form-input">
                  <option v-for="t in dnsRecordTypes" :key="t" :value="t">{{ t }}</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">TTL</label>
                <select v-model="dnsTemplateForm.ttl" class="form-input">
                  <option :value="1">Auto</option>
                  <option :value="300">5 åˆ†é’Ÿ</option>
                  <option :value="3600">1 å°æ—¶</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">å†…å®¹ *</label>
              <input v-model="dnsTemplateForm.content" class="form-input" placeholder="IP åœ°å€æˆ–ç›®æ ‡åŸŸå" />
            </div>

            <div class="form-group">
              <label class="form-label">æè¿°ï¼ˆå¯é€‰ï¼‰</label>
              <input v-model="dnsTemplateForm.description" class="form-input" placeholder="æ¨¡æ¿ç”¨é€”è¯´æ˜" />
            </div>

            <div class="form-group" v-if="canDnsBeProxied(dnsTemplateForm.type)">
              <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
                <input type="checkbox" v-model="dnsTemplateForm.proxied" style="width: 16px; height: 16px;" />
                å¯ç”¨ Cloudflare ä»£ç†
              </label>
            </div>

            <div v-if="dnsTemplateFormError" class="form-error">{{ dnsTemplateFormError }}</div>

            <div style="display: flex; gap: 12px; margin-top: 20px;">
              <button class="btn btn-primary" @click="saveDnsTemplate" :disabled="dnsSavingTemplate" style="flex: 1;">
                {{ dnsSavingTemplate ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}
              </button>
              <button class="btn btn-secondary" @click="showDnsTemplateModal = false" style="flex: 1;">å–æ¶ˆ</button>
            </div>
          </div>
        </div>

      </div>
      <!-- ==================== DNS ç®¡ç†éƒ¨åˆ†ç»“æŸ ==================== -->

      <!-- ==================== OpenAI API ç®¡ç†éƒ¨åˆ† ==================== -->
      <div v-if="mainActiveTab === 'openai'">
        <!-- Toast -->
        <div v-if="openaiToast.show" class="toast" :class="openaiToast.type">{{ openaiToast.message }}</div>

        <!-- OpenAI å­æ ‡ç­¾é¡µ -->
        <div class="dns-tabs">
          <button class="dns-tab-btn" :class="{ active: openaiCurrentTab === 'endpoints' }"
            @click="openaiCurrentTab = 'endpoints'" style="background: var(--primary-color) !important;"
            v-if="openaiCurrentTab === 'endpoints'">
            <i class="fas fa-server"></i> API ç«¯ç‚¹
          </button>
          <button class="dns-tab-btn" :class="{ active: openaiCurrentTab === 'endpoints' }"
            @click="openaiCurrentTab = 'endpoints'" v-else>
            <i class="fas fa-server"></i> API ç«¯ç‚¹
          </button>
          <button class="dns-tab-btn" :class="{ active: openaiCurrentTab === 'import' }"
            @click="openaiCurrentTab = 'import'" style="background: var(--primary-color) !important;"
            v-if="openaiCurrentTab === 'import'">
            <i class="fas fa-file-import"></i> å¯¼å…¥å¯¼å‡º
          </button>
          <button class="dns-tab-btn" :class="{ active: openaiCurrentTab === 'import' }"
            @click="openaiCurrentTab = 'import'" v-else>
            <i class="fas fa-file-import"></i> å¯¼å…¥å¯¼å‡º
          </button>
        </div>

        <!-- API ç«¯ç‚¹æ ‡ç­¾é¡µ -->
        <div v-if="openaiCurrentTab === 'endpoints'">
          <!-- <div class="panel"> -->
          <div class="panel-header">
            <div class="panel-title">OpenAI å…¼å®¹ API ç«¯ç‚¹</div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-success" style="padding: 6px 12px;" @click="openAddOpenaiEndpointModal">
                <i class="fas fa-plus"></i> æ·»åŠ ç«¯ç‚¹
              </button>
              <button class="btn btn-secondary" style="padding: 6px 10px;" @click="refreshAllOpenaiEndpoints"
                :disabled="openaiRefreshing">
                <i class="fas fa-sync-alt" :class="{ 'fa-spin': openaiRefreshing }"></i> åˆ·æ–°å…¨éƒ¨
              </button>
            </div>
          </div>

          <div v-if="openaiLoading" class="loading">
            <div class="spinner"></div>
            <div style="margin-top: 12px;">åŠ è½½ä¸­...</div>
          </div>

          <!-- ç«¯ç‚¹å¡ç‰‡åˆ—è¡¨ -->
          <div v-else>
            <div v-for="endpoint in openaiEndpoints" :key="endpoint.id" class="account-card"
              style="margin-bottom: 12px;">
              <!-- ç«¯ç‚¹å¤´éƒ¨ - å¯ç‚¹å‡»å±•å¼€æ¨¡å‹åˆ—è¡¨ -->
              <div class="account-header" @click="toggleOpenaiModels(endpoint.id)" style="cursor: pointer;">
                <div class="account-info" style="flex: 1;">
                  <span style="font-size: 20px; transition: transform 0.3s; display: inline-flex; align-items: center;">
                    <i class="fas fa-chevron-right toggle-icon" :style="{
                        transition: 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                        transform: isOpenaiEndpointExpanded(endpoint.id) ? 'rotate(90deg)' : 'rotate(0deg)'
                      }"></i>
                  </span>
                  <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                      <strong style="font-size: 15px;">{{ endpoint.name || 'æœªå‘½å' }}</strong>
                      <span class="proxied-badge"
                        :class="endpoint.status === 'valid' ? 'proxied-on' : (endpoint.status === 'invalid' ? 'proxied-off' : '')">
                        {{ endpoint.status === 'valid' ? 'æœ‰æ•ˆ' : (endpoint.status === 'invalid' ? 'æ— æ•ˆ' : 'æœªéªŒè¯') }}
                      </span>
                      <span v-if="endpoint.models && endpoint.models.length > 0"
                        style="font-size: 12px; color: var(--text-tertiary);">
                        {{ endpoint.models.length }} ä¸ªæ¨¡å‹
                      </span>
                    </div>
                    <div
                      style="font-size: 12px; color: var(--text-secondary); margin-top: 4px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                      <span style="display: flex; align-items: center; gap: 4px;">
                        <i class="fas fa-link" style="font-size: 10px;"></i>
                        <span style="font-family: monospace;">{{ endpoint.baseUrl }}</span>
                        <button class="copy-btn" @click.stop="copyToClipboard(endpoint.baseUrl)" title="å¤åˆ¶åœ°å€"
                          style="padding: 2px 4px;">
                          <i class="fas fa-copy"></i>
                        </button>
                        <!-- æ–°å¢ï¼šè¿›è¡Œâ€œåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€â€çš„æŒ‰é’® -->
                        <a :href="endpoint.baseUrl" target="_blank" rel="noopener noreferrer" title="åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€"
                          class="copy-btn" style="padding: 2px 4px;">
                          <i class="fas fa-external-link-alt"></i>
                        </a>
                      </span>

                      <span style="display: flex; align-items: center; gap: 4px;">
                        <i class="fas fa-key" style="font-size: 10px;"></i>
                        <span style="font-family: monospace;">{{ endpoint.showKey ? endpoint.apiKey :
                          maskApiKey(endpoint.apiKey) }}</span>
                        <button class="copy-btn" @click.stop="endpoint.showKey = !endpoint.showKey"
                          :title="endpoint.showKey ? 'éšè—' : 'æ˜¾ç¤º'" style="padding: 2px 4px;">
                          <i class="fas" :class="endpoint.showKey ? 'fa-eye-slash' : 'fa-eye'"></i>
                        </button>
                        <button class="copy-btn" @click.stop="copyToClipboard(endpoint.apiKey)" title="å¤åˆ¶ Key"
                          style="padding: 2px 4px;">
                          <i class="fas fa-copy"></i>
                        </button>
                      </span>
                    </div>
                    <div v-if="endpoint.notes" style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">
                      {{ endpoint.notes }}
                    </div>
                  </div>
                </div>
                <div style="display: flex; gap: 6px;" @click.stop>
                  <button class="openai-action-btn refresh" @click="verifyOpenaiEndpoint(endpoint)" title="åˆ·æ–°æ¨¡å‹åˆ—è¡¨">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                  <button class="openai-action-btn edit" @click="editOpenaiEndpoint(endpoint)" title="ç¼–è¾‘">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="openai-action-btn delete" @click="deleteOpenaiEndpoint(endpoint)" title="åˆ é™¤">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>

              <!-- æ¨¡å‹åˆ—è¡¨ - å¯å±•å¼€/æ”¶èµ· -->
              <div class="openai-models-container" :class="{ 'collapsed': !isOpenaiEndpointExpanded(endpoint.id) }">
                <div v-if="endpoint.models && endpoint.models.length > 0" class="models-grid">
                  <div v-for="model in endpoint.models" :key="getModelName(model)" class="model-tag-item"
                    @click="copyToClipboard(getModelName(model))" :title="'ç‚¹å‡»å¤åˆ¶: ' + getModelName(model)">
                    {{ getModelName(model) }}
                  </div>
                </div>
                <div v-else style="padding: 20px; text-align: center; color: var(--text-tertiary);">
                  <i class="fas fa-cube" style="font-size: 20px; margin-bottom: 8px; display: block;"></i>
                  æš‚æ— æ¨¡å‹æ•°æ®ï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–
                </div>
              </div>
            </div>

            <div v-if="openaiEndpoints.length === 0" class="empty-state" style="padding: 40px;">
              <i class="fas fa-robot" style="font-size: 48px; margin-bottom: 16px;"></i>
              <div>æš‚æ—  API ç«¯ç‚¹ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ </div>
            </div>
          </div>
          <!-- </div> -->
        </div>

        <!-- å¯¼å…¥å¯¼å‡ºæ ‡ç­¾é¡µ -->
        <div v-if="openaiCurrentTab === 'import'">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">å¯¼å…¥å¯¼å‡º</div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <!-- å¯¼å‡ºéƒ¨åˆ† -->
              <div style="padding: 16px; border: 1px solid var(--border-color); border-radius: 8px;">
                <h3 style="margin-bottom: 12px; font-size: 16px;"><i class="fas fa-download"></i> å¯¼å‡ºç«¯ç‚¹</h3>
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                  å¯¼å‡ºæ‰€æœ‰ API ç«¯ç‚¹é…ç½®ä¸º JSON æ–‡ä»¶ï¼ˆæ˜æ–‡ï¼‰ã€‚
                </p>
                <button class="btn btn-primary" @click="exportOpenaiEndpoints" style="width: 100%;">
                  <i class="fas fa-download"></i> å¯¼å‡ºå…¨éƒ¨ç«¯ç‚¹
                </button>
              </div>

              <!-- å¯¼å…¥éƒ¨åˆ† -->
              <div style="padding: 16px; border: 1px solid var(--border-color); border-radius: 8px;">
                <h3 style="margin-bottom: 12px; font-size: 16px;"><i class="fas fa-upload"></i> å¯¼å…¥ç«¯ç‚¹</h3>
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                  ä» JSON æ–‡ä»¶å¯¼å…¥ API ç«¯ç‚¹é…ç½®ã€‚
                </p>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary" @click="importOpenaiEndpointsFromFile" style="flex: 1;">
                    <i class="fas fa-upload"></i> é€‰æ‹©æ–‡ä»¶å¯¼å…¥
                  </button>
                </div>
              </div>
            </div>

            <!-- æ‰¹é‡æ·»åŠ  -->
            <div style="margin-top: 20px; padding: 16px; border: 1px solid var(--border-color); border-radius: 8px;">
              <h3 style="margin-bottom: 12px; font-size: 16px;"><i class="fas fa-list"></i> æ‰¹é‡æ·»åŠ </h3>
              <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                æ¯è¡Œä¸€ä¸ªç«¯ç‚¹ï¼Œæ ¼å¼ï¼š<code>åç§°:APIåœ°å€:API_Key</code> æˆ– JSON æ ¼å¼
              </p>
              <textarea v-model="openaiBatchText" class="form-textarea" placeholder='æ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼: åç§°:https://api.example.com:sk-xxx
æˆ– JSON æ ¼å¼:
[{"name": "ç¤ºä¾‹", "baseUrl": "https://api.example.com", "apiKey": "sk-xxx"}]'
                style="min-height: 150px; font-family: monospace; font-size: 12px;"></textarea>
              <div v-if="openaiBatchError" class="form-error" style="margin-top: 8px;">{{ openaiBatchError }}</div>
              <div v-if="openaiBatchSuccess" class="form-success" style="margin-top: 8px;">{{ openaiBatchSuccess }}
              </div>
              <button class="btn btn-primary" @click="batchAddOpenaiEndpoints" :disabled="openaiAdding"
                style="width: 100%; margin-top: 12px;">
                {{ openaiAdding ? 'æ·»åŠ ä¸­...' : 'æ‰¹é‡æ·»åŠ ' }}
              </button>
            </div>
          </div>
        </div>

        <!-- æ·»åŠ /ç¼–è¾‘ç«¯ç‚¹æ¨¡æ€æ¡† -->
        <div v-if="showOpenaiEndpointModal" class="modal-overlay" @click.self="showOpenaiEndpointModal = false">
          <div class="modal">
            <div class="modal-header">
              <div class="modal-title">{{ openaiEditingEndpoint ? 'ç¼–è¾‘ API ç«¯ç‚¹' : 'æ·»åŠ  API ç«¯ç‚¹' }}</div>
              <button class="modal-close" @click="showOpenaiEndpointModal = false">&times;</button>
            </div>

            <div class="form-group">
              <label class="form-label">åç§°</label>
              <input v-model="openaiEndpointForm.name" class="form-input" placeholder="ä¾‹å¦‚: OpenAI å®˜æ–¹" />
            </div>

            <div class="form-group">
              <label class="form-label">API åœ°å€ *</label>
              <input v-model="openaiEndpointForm.baseUrl" class="form-input" placeholder="https://api.openai.com" />
              <div class="form-help">OpenAI å…¼å®¹çš„ API åŸºç¡€åœ°å€ï¼ˆä¸éœ€è¦ /v1ï¼‰</div>
            </div>

            <div class="form-group">
              <label class="form-label">API Key *</label>
              <input v-model="openaiEndpointForm.apiKey" type="text" class="form-input" placeholder="sk-xxxxxxxx"
                style="font-family: monospace;" />
            </div>

            <div class="form-group">
              <label class="form-label">å¤‡æ³¨</label>
              <textarea v-model="openaiEndpointForm.notes" class="form-textarea" placeholder="å¯é€‰å¤‡æ³¨ä¿¡æ¯"
                style="min-height: 60px;"></textarea>
            </div>

            <div v-if="openaiEndpointFormError" class="form-error">{{ openaiEndpointFormError }}</div>

            <div style="display: flex; gap: 12px; margin-top: 20px;">
              <button class="btn btn-primary" @click="saveOpenaiEndpoint" :disabled="openaiSaving" style="flex: 1;">
                {{ openaiSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}
              </button>
              <button class="btn btn-secondary" @click="showOpenaiEndpointModal = false" style="flex: 1;">å–æ¶ˆ</button>
            </div>
          </div>
        </div>

      </div>
      <!-- ==================== OpenAI API ç®¡ç†éƒ¨åˆ†ç»“æŸ ==================== -->

    </div>

    <!-- è®¾ç½®ä¾§è¾¹æ  -->
    <div v-if="showSettingsModal">
      <div class="settings-sidebar-overlay" @click="showSettingsModal = false"></div>
      <div class="settings-sidebar">
        <!-- ä¾§è¾¹æ å¤´éƒ¨ -->
        <div class="settings-sidebar-header">
          <div class="settings-sidebar-title">
            <i class="fas fa-cog"></i>
            <span>ç³»ç»Ÿè®¾ç½®</span>
          </div>
          <button class="settings-sidebar-close" @click="showSettingsModal = false">&times;</button>
        </div>

        <!-- ä¾§è¾¹æ å†…å®¹ -->
        <div class="settings-sidebar-content">
          <!-- æ¨¡å—ç®¡ç† -->
          <div class="settings-section">
            <div class="settings-section-title">æ¨¡å—ç®¡ç†</div>
            <div>
              <div
                v-for="(module, index) in moduleOrder"
                :key="module"
                class="draggable-module-item"
                draggable="true"
                @dragstart="handleDragStart($event, index)"
                @dragend="handleDragEnd"
                @dragover.prevent="handleDragOver($event, index)"
                @drop="handleDrop($event, index)">
                <i class="fas fa-grip-vertical drag-handle"></i>
                <i class="draggable-module-icon fas" :class="getModuleIcon(module)"></i>
                <span class="draggable-module-name">{{ getModuleName(module) }}</span>
                <!-- æ˜¾ç¤º/éšè—åˆ‡æ¢æŒ‰é’® -->
                <button
                  class="btn btn-sm"
                  :class="moduleVisibility[module] ? 'btn-success' : 'btn-secondary'"
                  @click.stop="toggleModuleVisibility(module)"
                  style="padding: 4px 8px; font-size: 12px;">
                  <i class="fas" :class="moduleVisibility[module] ? 'fa-eye' : 'fa-eye-slash'"></i>
                </button>
              </div>
            </div>
            <div class="form-help" style="margin-top: 8px;">æ‹–æ‹½è°ƒæ•´é¡ºåºï¼Œç‚¹å‡»çœ¼ç›å›¾æ ‡åˆ‡æ¢æ˜¾ç¤º/éšè—</div>
          </div>

          <!-- ä¿®æ”¹å¯†ç  -->
          <div class="settings-section">
            <div class="settings-section-title">ä¿®æ”¹ç™»å½•å¯†ç </div>
            <div class="form-group">
              <input v-model="newPassword" type="password" class="form-input" placeholder="è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" />
            </div>
            <div class="form-group">
              <input v-model="confirmPassword" type="password" class="form-input" placeholder="ç¡®è®¤æ–°å¯†ç " />
            </div>
            <div v-if="passwordError" class="form-error">{{ passwordError }}</div>
            <div v-if="passwordSuccess" class="form-success">{{ passwordSuccess }}</div>
            <button class="btn btn-primary" @click="changePassword" style="width: 100%;">
              <i class="fas fa-key"></i> ä¿®æ”¹å¯†ç 
            </button>
          </div>

          <!-- æ•°æ®å¯¼å…¥å¯¼å‡º -->
          <div class="settings-section">
            <div class="settings-section-title">æ•°æ®å¤‡ä»½ä¸æ¢å¤</div>
            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
              <button class="btn btn-success" @click="exportAllData" style="flex: 1;">
                <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
              </button>
              <button class="btn btn-warning" @click="importAllData" style="flex: 1;">
                <i class="fas fa-upload"></i> å¯¼å…¥æ•°æ®
              </button>
            </div>
            <div class="form-help">å¯¼å‡ºåŒ…å«æ‰€æœ‰æ¨¡å—çš„é…ç½®å’Œæ•°æ®</div>
          </div>

          <!-- ä¿å­˜æŒ‰é’® -->
          <div style="position: sticky; bottom: 0; background: var(--card-bg); padding-top: 16px; border-top: 1px solid var(--border-color); margin-top: 20px;">
            <button class="btn btn-primary" @click="saveSettings" style="width: 100%;">
              <i class="fas fa-save"></i> ä¿å­˜è®¾ç½®
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast æç¤ºå®¹å™¨ -->
    <div v-if="globalToast.show" class="custom-toast" :class="globalToast.type">
      <i class="fas" :class="{
        'fa-check-circle': globalToast.type === 'success',
        'fa-exclamation-circle': globalToast.type === 'error',
        'fa-exclamation-triangle': globalToast.type === 'warning',
        'fa-info-circle': globalToast.type === 'info'
      }"></i>
      <span>{{ globalToast.message }}</span>
    </div>

    <!-- è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† -->
    <div v-if="customDialog.show" class="custom-dialog-overlay">
      <div class="custom-dialog">
        <div class="custom-dialog-title">
          <i class="fas" :class="customDialog.icon || 'fa-question-circle'"></i>
          {{ customDialog.title || 'ç¡®è®¤' }}
        </div>
        <div class="custom-dialog-message">{{ customDialog.message }}</div>
        <div class="custom-dialog-buttons">
          <button v-if="customDialog.cancelText" class="btn btn-secondary" @click="customDialog.onCancel ? customDialog.onCancel() : (customDialog.show = false)">
            {{ customDialog.cancelText }}
          </button>
          <button class="btn" :class="customDialog.confirmClass || 'btn-primary'" @click="customDialog.onConfirm">
            {{ customDialog.confirmText || 'ç¡®å®š' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          accounts: [],
          loading: false,
          lastUpdate: '--:--:--',
          managedAccounts: [],
          projectCosts: {},
          newAccount: {
            name: '',
            token: '',
            balance: ''
          },
          addingAccount: false,
          addAccountError: '',
          addAccountSuccess: '',
          opacity: 39,
          expandedAccounts: {},
          refreshInterval: null,
          refreshing: false,
          lastFetchAt: 0,
          minFetchInterval: 2000,
          // å¯†ç éªŒè¯
          isAuthenticated: false,
          showLoginModal: false,
          showSetPasswordModal: false,
          loginPassword: '',
          loginError: '',
          setPassword: '',
          setPasswordConfirm: '',
          setPasswordError: '',
          // æ‰¹é‡æ·»åŠ 
          batchAccounts: '',
          maskedBatchAccounts: '',
          batchAddError: '',
          batchAddSuccess: '',
          // æ—¥å¿—æ¨¡æ€æ¡†
          showLogsModal: false,
          logsModalTitle: '',
          logsModalInfo: {},
          logsContent: '',
          logsLoading: false,
          logsAutoScroll: true,
          logsFullscreen: false,
          logsScrollTimer: null,
          logsRealTime: true,
          logsRealTimeTimer: null,
          logsCurrentAccount: null,
          logsCurrentProject: null,
          logsCurrentService: null,
          // åˆ·æ–°å€’è®¡æ—¶
          refreshCountdown: 30,
          refreshProgress: 100,
          countdownInterval: null,
          refreshInterval: null,
          dataRefreshPaused: false,
          // ==================== DNS ç®¡ç†ç›¸å…³æ•°æ® ====================
          mainActiveTab: 'zeabur',
          // Zeabur å­æ ‡ç­¾é¡µ
          zeaburCurrentTab: 'monitor',
          // DNS Toast
          dnsToast: { show: false, message: '', type: 'success' },
          // DNS å½“å‰æ ‡ç­¾é¡µ
          dnsCurrentTab: 'dns',
          // CF è´¦å·ç›¸å…³
          dnsAccounts: [],
          dnsSelectedAccountId: '',
          showAddDnsAccountModal: false,
          dnsAccountForm: { name: '', apiToken: '', email: '' },
          dnsAccountFormError: '',
          dnsAccountFormSuccess: '',
          dnsSavingAccount: false,
          // ç¼–è¾‘ CF è´¦å·
          showEditDnsAccountModal: false,
          dnsEditingAccount: null,
          dnsEditAccountForm: { name: '', apiToken: '', email: '' },
          dnsEditAccountFormError: '',
          dnsEditAccountFormSuccess: '',
          // åŸŸåç›¸å…³
          dnsZones: [],
          dnsSelectedZoneId: '',
          dnsSelectedZoneName: '',
          dnsLoadingZones: false,
          // DNS è®°å½•ç›¸å…³
          dnsRecords: [],
          dnsLoadingRecords: false,
          showDnsRecordModal: false,
          dnsEditingRecord: null,
          dnsRecordForm: { type: 'A', name: '', content: '', ttl: 1, proxied: false, priority: 10 },
          dnsRecordFormError: '',
          dnsSavingRecord: false,
          dnsRecordTypes: ['A', 'AAAA', 'CNAME', 'TXT', 'MX', 'NS', 'SRV', 'CAA'],
          // DNS è®°å½•æ‰¹é‡é€‰æ‹©
          dnsSelectedRecords: [],
          // å¿«é€Ÿåˆ‡æ¢
          dnsQuickSwitchType: 'A',
          dnsQuickSwitchName: '',
          dnsQuickSwitchContent: '',
          dnsSwitching: false,
          // æ¨¡æ¿ç›¸å…³
          dnsTemplates: [],
          showDnsTemplateModal: false,
          dnsEditingTemplate: null,
          dnsTemplateForm: { name: '', type: 'A', content: '', ttl: 1, proxied: false, description: '' },
          dnsTemplateFormError: '',
          dnsSavingTemplate: false,
          // ==================== OpenAI API ç®¡ç†ç›¸å…³æ•°æ® ====================
          openaiEndpoints: [],
          openaiLoading: false,
          openaiRefreshing: false,
          openaiCurrentTab: 'endpoints',
          openaiToast: { show: false, message: '', type: 'success' },
          // æ·»åŠ /ç¼–è¾‘ç«¯ç‚¹
          showOpenaiEndpointModal: false,
          openaiEditingEndpoint: null,
          openaiEndpointForm: { name: '', baseUrl: '', apiKey: '', notes: '' },
          openaiEndpointFormError: '',
          openaiSaving: false,
          // ç«¯ç‚¹å±•å¼€çŠ¶æ€ï¼ˆæ¨¡å‹åˆ—è¡¨å¯å±•å¼€/æ”¶èµ·ï¼‰
          openaiExpandedEndpoints: {},
          // æ‰¹é‡æ·»åŠ 
          openaiBatchText: '',
          openaiBatchError: '',
          openaiBatchSuccess: '',
          openaiAdding: false,
          // ==================== æ–°å¢åŠŸèƒ½ç›¸å…³æ•°æ® ====================
          // æ¨¡å—å¯è§æ€§æ§åˆ¶
          moduleVisibility: {
            zeabur: true,
            dns: true,
            openai: true
          },
          // æ¨¡å—æ˜¾ç¤ºé¡ºåº
          moduleOrder: ['zeabur', 'dns', 'openai'],
          // æ‹–æ‹½ç›¸å…³
          draggedIndex: null,
          // è®¾ç½®æ¨¡æ€æ¡†
          showSettingsModal: false,
          newPassword: '',
          confirmPassword: '',
          passwordError: '',
          passwordSuccess: '',
          // å…¨å±€Toast
          globalToast: { show: false, message: '', type: 'success' },
          // è‡ªå®šä¹‰å¯¹è¯æ¡†
          customDialog: {
            show: false,
            title: '',
            message: '',
            icon: '',
            confirmText: '',
            cancelText: '',
            confirmClass: '',
            onConfirm: null,
            onCancel: null
          }
        };
      },
      async mounted() {
        // åŠ è½½æ¨¡å—å¯è§æ€§å’Œé¡ºåºè®¾ç½®
        this.loadModuleSettings();

        // æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²è®¾ç½®å¯†ç 
        const hasPasswordResponse = await fetch('/api/check-password');
        const { hasPassword } = await hasPasswordResponse.json();

        if (!hasPassword) {
          // é¦–æ¬¡ä½¿ç”¨ï¼Œæ˜¾ç¤ºè®¾ç½®å¯†ç ç•Œé¢
          this.showSetPasswordModal = true;
          return;
        }

        // æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ä¿å­˜çš„å¯†ç å’Œæ—¶é—´æˆ³
        const savedPassword = localStorage.getItem('admin_password');
        const savedTime = localStorage.getItem('password_time');

        if (savedPassword && savedTime) {
          const now = Date.now();
          const elapsed = now - parseInt(savedTime);
          const fourDays = 4 * 24 * 60 * 60 * 1000; // 4å¤©çš„æ¯«ç§’æ•°

          if (elapsed < fourDays) {
            // 4å¤©å†…ï¼Œè‡ªåŠ¨ç™»å½•
            this.loginPassword = savedPassword;
            await this.verifyPassword();
            return;
          }
        }

        // éœ€è¦è¾“å…¥å¯†ç 
        this.showLoginModal = true;
      },
      watch: {
        opacity(newVal) {
          localStorage.setItem('card_opacity', newVal);
          this.updateOpacity();
        },
        showSettingsModal(newVal) {
          // æ§åˆ¶bodyæ»šåŠ¨
          if (newVal) {
            document.body.classList.add('modal-open');
          } else {
            document.body.classList.remove('modal-open');
          }
        },
        showLogsModal(newVal) {
          if (newVal) {
            this.$nextTick(() => {
              this.setupAutoScroll();
              this.setupHorizontalScrollbar();
              if (this.logsRealTime) {
                this.startRealTimeRefresh();
              }
              // è®¾ç½®ç„¦ç‚¹åˆ°æ¨¡æ€æ¡†ï¼Œç¡®ä¿ESCé”®å¯ä»¥å·¥ä½œ
              const modalOverlay = document.querySelector('.modal-overlay.logs-fullscreen-overlay, .modal-overlay');
              if (modalOverlay) {
                modalOverlay.focus();
              }
              // ç¦ç”¨ä¸»ç•Œé¢æ»šåŠ¨
              document.body.style.overflow = 'hidden';
            });
          } else {
            if (this.logsScrollTimer) {
              clearInterval(this.logsScrollTimer);
              this.logsScrollTimer = null;
            }
            this.stopRealTimeRefresh();
            this.logsRealTime = false;
            // æ¢å¤ä¸»ç•Œé¢æ»šåŠ¨
            document.body.style.overflow = '';
          }
        },
        logsAutoScroll(newVal) {
          this.setupAutoScroll();
        },
        logsRealTime(newVal) {
          if (newVal) {
            this.startRealTimeRefresh();
          } else {
            this.stopRealTimeRefresh();
          }
        }
      },
      beforeUnmount() {
        // æ¸…ç†å®šæ—¶å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
        if (this.refreshInterval) {
          clearInterval(this.refreshInterval);
        }
        if (this.countdownInterval) {
          clearInterval(this.countdownInterval);
        }
        if (this.logsScrollTimer) {
          clearInterval(this.logsScrollTimer);
        }
        if (this.logsRealTimeTimer) {
          clearInterval(this.logsRealTimeTimer);
        }
      },
      computed: {
        totalProjects() {
          let total = 0;
          for (const acc of this.accounts) {
            if (acc.projects) total += acc.projects.length;
          }
          return total;
        },
        totalServices() {
          let total = 0;
          for (const acc of this.accounts) {
            if (acc.projects) {
              for (const p of acc.projects) {
                if (p.services) total += p.services.length;
              }
            }
          }
          return total;
        },
        runningServices() {
          let total = 0;
          for (const acc of this.accounts) {
            if (acc.projects) {
              for (const p of acc.projects) {
                if (p.services) {
                  for (const s of p.services) {
                    if (s.status === 'RUNNING') total++;
                  }
                }
              }
            }
          }
          return total;
        },
        totalCost() {
          let total = 0;
          for (const acc of this.accounts) {
            // ä¼˜å…ˆä½¿ç”¨è´¦å·çš„ totalCostï¼ˆæ¥è‡ªå®˜æ–¹ serviceCostsThisMonthï¼‰
            if (acc.data && acc.data.totalCost !== undefined) {
              total += acc.data.totalCost || 0;
            } else if (acc.projects) {
              // å¤‡ç”¨ï¼šç´¯åŠ é¡¹ç›®è´¹ç”¨ï¼ˆå½“è´¦å·æ²¡æœ‰ totalCost æ—¶ï¼‰
              for (const p of acc.projects) {
                total += p.cost || 0;
              }
            }
          }
          return total;
        }
      },
      methods: {
        // è®¾ç½®å¯†ç ï¼ˆé¦–æ¬¡ï¼‰
        async setAdminPassword() {
          this.setPasswordError = '';

          if (!this.setPassword || this.setPassword.length < 6) {
            this.setPasswordError = 'å¯†ç é•¿åº¦è‡³å°‘6ä½';
            return;
          }

          if (this.setPassword !== this.setPasswordConfirm) {
            this.setPasswordError = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
            return;
          }

          try {
            const response = await fetch('/api/set-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ password: this.setPassword })
            });

            const result = await response.json();
            if (result.success) {
              // è®¾ç½®æˆåŠŸï¼Œè‡ªåŠ¨ç™»å½•
              this.loginPassword = this.setPassword;
              localStorage.setItem('admin_password', this.setPassword);
              localStorage.setItem('password_time', Date.now().toString());

              this.showSetPasswordModal = false;
              this.isAuthenticated = true;

              await this.loadManagedAccounts();
              this.loadProjectCosts();
              this.fetchData();

              // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°ï¼ˆä½¿ç”¨ç»Ÿä¸€æ–¹æ³•ï¼Œé¿å…é‡å¤åˆ›å»º intervalï¼‰
              this.startAutoRefresh();

              // åŠ è½½é€æ˜åº¦è®¾ç½®
              const savedOpacity = localStorage.getItem('card_opacity');
              if (savedOpacity) {
                this.opacity = parseInt(savedOpacity);
                this.updateOpacity();
              }
            } else {
              this.setPasswordError = result.error || 'è®¾ç½®å¤±è´¥';
            }
          } catch (error) {
            this.setPasswordError = 'è®¾ç½®å¤±è´¥: ' + error.message;
          }
        },
        // éªŒè¯å¯†ç 
        async verifyPassword() {
          this.loginError = '';
          try {
            const response = await fetch('/api/verify-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ password: this.loginPassword })
            });

            const result = await response.json();
            if (result.success) {
              this.isAuthenticated = true;
              this.showLoginModal = false;

              // ä¿å­˜å¯†ç å’Œæ—¶é—´æˆ³
              localStorage.setItem('admin_password', this.loginPassword);
              localStorage.setItem('password_time', Date.now().toString());

              await this.loadManagedAccounts();
              this.loadProjectCosts();
              this.fetchData();

              // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°ï¼ˆä½¿ç”¨ç»Ÿä¸€æ–¹æ³•ï¼Œé¿å…é‡å¤åˆ›å»º intervalï¼‰
              this.startAutoRefresh();

              // åŠ è½½é€æ˜åº¦è®¾ç½®
              const savedOpacity = localStorage.getItem('card_opacity');
              if (savedOpacity) {
                this.opacity = parseInt(savedOpacity);
                this.updateOpacity();
              }
            } else {
              this.loginError = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
            }
          } catch (error) {
            this.loginError = 'éªŒè¯å¤±è´¥: ' + error.message;
          }
        },
        // é‚®ç®±æ‰“ç 
        maskEmail(email) {
          if (!email || !email.includes('@')) return email;
          const [local, domain] = email.split('@');
          if (local.length <= 14) return email;
          const masked = local.substring(0, 2) + '*'.repeat(local.length - 4) + local.substring(local.length - 2);
          return masked + '@' + domain;
        },
        // è·å–è¯·æ±‚å¤´ï¼ˆåŒ…å«å¯†ç ï¼‰
        getAuthHeaders() {
          return {
            'Content-Type': 'application/json',
            'x-admin-password': this.loginPassword
          };
        },
        async loadManagedAccounts() {
          try {
            // ä»æœåŠ¡å™¨åŠ è½½è´¦å·
            const response = await fetch('/api/server-accounts', {
              headers: this.getAuthHeaders()
            });
            const accounts = await response.json();
            if (accounts && accounts.length > 0) {
              this.managedAccounts = accounts;
              console.log(`ğŸ“‹ ä»æœåŠ¡å™¨åŠ è½½ ${accounts.length} ä¸ªè´¦å·`);
            }
          } catch (error) {
            console.log('âš ï¸ ä»æœåŠ¡å™¨åŠ è½½è´¦å·å¤±è´¥:', error.message);
          }
        },
        async saveManagedAccounts() {
          try {
            // ä¿å­˜åˆ°æœåŠ¡å™¨
            const response = await fetch('/api/server-accounts', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({ accounts: this.managedAccounts })
            });
            const result = await response.json();
            if (result.success) {
              console.log('âœ… è´¦å·å·²ä¿å­˜åˆ°æœåŠ¡å™¨');
            }
          } catch (error) {
            console.error('âŒ ä¿å­˜è´¦å·åˆ°æœåŠ¡å™¨å¤±è´¥:', error.message);
          }
        },
        loadProjectCosts() {
          const saved = localStorage.getItem('zeabur_project_costs');
          if (saved) {
            this.projectCosts = JSON.parse(saved);
          }
        },

        startAutoRefresh() {
          try {
            if (this.refreshInterval) {
              clearInterval(this.refreshInterval);
            }
            if (this.countdownInterval) {
              clearInterval(this.countdownInterval);
            }

            // é‡ç½®å€’è®¡æ—¶
            this.refreshCountdown = 30;
            this.refreshProgress = 100;

            // 30sè‡ªåŠ¨åˆ·æ–°
            this.refreshInterval = setInterval(() => {
              console.log('è‡ªåŠ¨åˆ·æ–°è§¦å‘');
              this.fetchData();
            }, 30000);

            // 1så€’è®¡æ—¶æ›´æ–°ï¼Œåˆ°0æ—¶ç«‹å³é‡ç½®
            this.countdownInterval = setInterval(() => {
              this.refreshCountdown--;

              if (this.refreshCountdown <= 0) {
                // åˆ°0æ—¶ç«‹å³é‡ç½®ï¼Œæ— åŠ¨ç”»
                this.refreshCountdown = 30;
                this.refreshProgress = 100;
              } else {
                // æ­£å¸¸é€’å‡
                this.refreshProgress = (this.refreshCountdown / 30) * 100;
              }
            }, 1000);
          } catch (e) {
            console.error('startAutoRefresh error', e);
          }
        },

        stopAutoRefresh() {
          if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshInterval = null;
          }
          if (this.countdownInterval) {
            clearInterval(this.countdownInterval);
            this.countdownInterval = null;
          }
        },

        async fetchData() {
          // èŠ‚æµï¼šå¦‚æœè·ç¦»ä¸Šæ¬¡è¯·æ±‚å¤ªçŸ­ï¼Œè·³è¿‡
          const now = Date.now();
          if (now - this.lastFetchAt < this.minFetchInterval) return;
          if (this.refreshing) return; // é˜²æ­¢å¹¶å‘è¯·æ±‚

          this.lastFetchAt = now;
          this.refreshing = true;
          this.loading = true;

          console.log('fetchData è¢«è°ƒç”¨');

          // æ‰‹åŠ¨åˆ·æ–°æ—¶é‡ç½®å€’è®¡æ—¶
          this.refreshCountdown = 30;
          this.refreshProgress = 100;

          try {
            // å¦‚æœæœ‰è´¦å·ï¼Œä½¿ç”¨è´¦å·
            if (this.managedAccounts.length > 0) {
              // æ¸…é™¤è´¦å·ä¸­çš„æ‰‹åŠ¨ä½™é¢ï¼Œè®©æœåŠ¡å™¨ä½¿ç”¨ API çœŸå®æ•°æ®
              const accountsWithoutManualBalance = this.managedAccounts.map(acc => ({
                ...acc,
                balance: null // ä¸å‘é€æ‰‹åŠ¨ä½™é¢
              }));

              const [accountsRes, projectsRes] = await Promise.all([
                fetch('/api/temp-accounts', {
                  method: 'POST',
                  headers: this.getAuthHeaders(),
                  body: JSON.stringify({ accounts: accountsWithoutManualBalance })
                }).then(r => r.json()),
                fetch('/api/temp-projects', {
                  method: 'POST',
                  headers: this.getAuthHeaders(),
                  body: JSON.stringify({
                    accounts: accountsWithoutManualBalance,
                    projectCosts: {} // ä¸å‘é€æ‰‹åŠ¨è´¹ç”¨ï¼Œè®©æœåŠ¡å™¨å°è¯•ä» API è·å–
                  })
                }).then(r => r.json())
              ]);

              console.log('API è¿”å›çš„è´¦å·æ•°æ®:', accountsRes);
              console.log('API è¿”å›çš„é¡¹ç›®æ•°æ®:', projectsRes);

              // ä½¿ç”¨Vue.setæˆ–ç›´æ¥é‡æ–°èµ‹å€¼ç¡®ä¿å“åº”å¼æ›´æ–°
              this.accounts = [];
              this.$nextTick(() => {
                this.accounts = accountsRes.map((account, index) => {
                  const projectData = projectsRes[index];
                  console.log(`è´¦å· ${account.name} ä½™é¢: ${account.data?.credit} (${account.data?.credit / 100} USD)`);
                  return {
                    ...account,
                    projects: projectData.projects || []
                  };
                });
              });
            } else {
              // å¦åˆ™ä½¿ç”¨æœåŠ¡å™¨é…ç½®çš„è´¦å·
              const [accountsRes, projectsRes] = await Promise.all([
                fetch('/api/accounts').then(r => r.json()),
                fetch('/api/projects').then(r => r.json())
              ]);

              // ä½¿ç”¨Vue.setæˆ–ç›´æ¥é‡æ–°èµ‹å€¼ç¡®ä¿å“åº”å¼æ›´æ–°
              this.accounts = [];
              this.$nextTick(() => {
                this.accounts = accountsRes.map((account, index) => {
                  const projectData = projectsRes[index];
                  return {
                    ...account,
                    projects: projectData.projects || []
                  };
                });
              });
            }
          } catch (error) {
            console.error('è·å–æ•°æ®å¤±è´¥:', error);
            this.showGlobalToast('è·å–æ•°æ®å¤±è´¥: ' + error.message, 'error');
          } finally {
            this.loading = false;
            this.refreshing = false;
            // å¼ºåˆ¶é‡æ–°æ¸²æŸ“ç»„ä»¶
            this.$forceUpdate();
            console.log('æ•°æ®æ›´æ–°å®Œæˆï¼Œå¼ºåˆ¶é‡æ–°æ¸²æŸ“');
          }
        },
        getBalanceClass(credit) {
          const balance = credit / 100;
          if (balance < 10) return 'critical';
          if (balance < 50) return 'low';
          return '';
        },
        async batchAddAccounts() {
          this.batchAddError = '';
          this.batchAddSuccess = '';

          if (!this.batchAccounts.trim()) {
            this.batchAddError = 'è¯·è¾“å…¥è´¦å·ä¿¡æ¯';
            return;
          }

          const lines = this.batchAccounts.trim().split('\n');
          const accounts = [];

          // è§£ææ¯ä¸€è¡Œ
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;

            let name = '';
            let token = '';

            // å°è¯•åŒ¹é…æ‹¬å·æ ¼å¼ï¼šåç§°(token) æˆ– åç§°ï¼ˆtokenï¼‰
            const bracketMatch = line.match(/^(.+?)[ï¼ˆ(](.+?)[ï¼‰)]$/);
            if (bracketMatch) {
              name = bracketMatch[1].trim();
              token = bracketMatch[2].trim();
            } else if (line.includes(':')) {
              // å†’å·æ ¼å¼ï¼šåç§°:token
              const parts = line.split(':');
              name = parts[0].trim();
              token = parts.slice(1).join(':').trim();
            } else if (line.includes('ï¼š')) {
              // ä¸­æ–‡å†’å·æ ¼å¼ï¼šåç§°ï¼štoken
              const parts = line.split('ï¼š');
              name = parts[0].trim();
              token = parts.slice(1).join('ï¼š').trim();
            } else {
              this.batchAddError = `ç¬¬ ${i + 1} è¡Œæ ¼å¼é”™è¯¯ï¼Œæ”¯æŒçš„æ ¼å¼ï¼šåç§°:Token æˆ– åç§°ï¼šToken æˆ– åç§°(Token) æˆ– åç§°ï¼ˆTokenï¼‰`;
              return;
            }

            if (!name || !token) {
              this.batchAddError = `ç¬¬ ${i + 1} è¡Œï¼šè´¦å·åç§°æˆ– Token ä¸èƒ½ä¸ºç©º`;
              return;
            }

            accounts.push({ name, token });
          }

          if (accounts.length === 0) {
            this.batchAddError = 'æ²¡æœ‰æœ‰æ•ˆçš„è´¦å·ä¿¡æ¯';
            return;
          }

          this.addingAccount = true;
          let successCount = 0;
          let failedAccounts = [];

          // é€ä¸ªéªŒè¯å¹¶æ·»åŠ 
          for (const account of accounts) {
            try {
              const response = await fetch('/api/validate-account', {
                method: 'POST',
                headers: this.getAuthHeaders(),
                body: JSON.stringify({
                  accountName: account.name,
                  apiToken: account.token
                })
              });

              const data = await response.json();

              if (response.ok) {
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const exists = this.managedAccounts.some(acc => acc.name === account.name);
                if (!exists) {
                  this.managedAccounts.push({
                    name: account.name,
                    token: account.token,
                    email: data.userData.email,
                    username: data.userData.username
                  });
                  successCount++;
                } else {
                  failedAccounts.push(`${account.name}ï¼ˆå·²å­˜åœ¨ï¼‰`);
                }
              } else {
                failedAccounts.push(`${account.name}ï¼ˆ${data.error || 'éªŒè¯å¤±è´¥'}ï¼‰`);
              }
            } catch (error) {
              failedAccounts.push(`${account.name}ï¼ˆç½‘ç»œé”™è¯¯ï¼‰`);
            }
          }

          this.addingAccount = false;

          if (successCount > 0) {
            await this.saveManagedAccounts();
            this.fetchData();
          }

          // æ˜¾ç¤ºç»“æœ
          if (successCount > 0 && failedAccounts.length === 0) {
            this.batchAddSuccess = `âœ… æˆåŠŸæ·»åŠ  ${successCount} ä¸ªè´¦å·`;
            this.batchAccounts = '';
            this.maskedBatchAccounts = '';
          } else if (successCount > 0) {
            this.batchAddSuccess = `âœ… æˆåŠŸæ·»åŠ  ${successCount} ä¸ªè´¦å·`;
            this.batchAddError = `âŒ å¤±è´¥: ${failedAccounts.join(', ')}`;
          } else {
            this.batchAddError = `âŒ å…¨éƒ¨å¤±è´¥: ${failedAccounts.join(', ')}`;
          }

          // 3ç§’åæ¸…é™¤æç¤º
          setTimeout(() => {
            this.batchAddSuccess = '';
            if (successCount > 0 && failedAccounts.length === 0) {
              this.batchAddError = '';
            }
          }, 3000);
        },
        async addAccountToList() {
          if (!this.newAccount.name || !this.newAccount.token) {
            this.addAccountError = 'è¯·å¡«å†™è´¦å·åç§°å’Œ API Token';
            return;
          }

          this.addingAccount = true;
          this.addAccountError = '';
          this.addAccountSuccess = '';

          try {
            const response = await fetch('/api/validate-account', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                accountName: this.newAccount.name,
                apiToken: this.newAccount.token
              })
            });

            const data = await response.json();

            if (response.ok) {
              // æ·»åŠ åˆ°æœ¬åœ°åˆ—è¡¨
              this.managedAccounts.push({
                name: this.newAccount.name,
                token: this.newAccount.token,
                balance: this.newAccount.balance ? parseFloat(this.newAccount.balance) : null,
                email: data.userData.email,
                username: data.userData.username
              });

              this.saveManagedAccounts();
              this.addAccountSuccess = `âœ… è´¦å·æ·»åŠ æˆåŠŸï¼ç”¨æˆ·: ${data.userData.username}`;

              // æ¸…ç©ºè¡¨å•
              this.newAccount = { name: '', token: '', balance: '' };

              // åˆ·æ–°æ•°æ®
              setTimeout(() => {
                this.fetchData();
                this.addAccountSuccess = '';
              }, 1500);
            } else {
              this.addAccountError = data.error || 'æ·»åŠ å¤±è´¥';
            }
          } catch (error) {
            this.addAccountError = 'ç½‘ç»œé”™è¯¯: ' + error.message;
          } finally {
            this.addingAccount = false;
          }
        },
        async removeAccount(index) {
          const accountName = this.managedAccounts[index].name;
          const password = prompt(`åˆ é™¤è´¦å·"${accountName}"éœ€è¦éªŒè¯ç®¡ç†å‘˜å¯†ç ï¼š`);

          if (!password) return;

          // éªŒè¯å¯†ç 
          try {
            const response = await fetch('/api/verify-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ password })
            });

            const result = await response.json();
            if (result.success) {
              this.managedAccounts.splice(index, 1);
              await this.saveManagedAccounts();
              this.fetchData();
              alert('è´¦å·å·²åˆ é™¤');
            } else {
              alert('å¯†ç é”™è¯¯ï¼Œåˆ é™¤å¤±è´¥');
            }
          } catch (error) {
            alert('éªŒè¯å¤±è´¥: ' + error.message);
          }
        },
        updateOpacity() {
          const opacity = this.opacity / 100;
          const root = document.documentElement;
          if (!root) return; // é˜²æ­¢ DOM æœªåŠ è½½

          // è®¾ç½®æ‰€æœ‰ç›¸å…³çš„CSSå˜é‡
          root.style.setProperty('--card-opacity', opacity);
          root.style.setProperty('--service-opacity', Math.min(opacity + 0.05, 1));
          root.style.setProperty('--blur-amount', `${20 * opacity}px`);
          root.style.setProperty('--blur-amount-small', `${15 * opacity}px`);
          root.style.setProperty('--blur-amount-tiny', `${10 * opacity}px`);
          root.style.setProperty('--saturate-amount', `${100 + 80 * opacity}%`);
          root.style.setProperty('--shadow-opacity', 0.1 * opacity);
          root.style.setProperty('--shadow-opacity-light', 0.05 * opacity);
          root.style.setProperty('--border-opacity', 0.3 * opacity);
          root.style.setProperty('--border-opacity-light', 0.4 * opacity);
          root.style.setProperty('--border-opacity-strong', 0.5 * opacity);
        },
        async clearCache() {
          const confirmed = await this.showConfirm({
            title: 'æ¸…é™¤ç¼“å­˜',
            message: 'ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰æœ¬åœ°ä¿å­˜çš„è´¦å·ã€ä½™é¢å’Œè´¹ç”¨æ•°æ®ã€‚',
            icon: 'fa-exclamation-triangle',
            confirmText: 'ç¡®å®šæ¸…é™¤',
            confirmClass: 'btn-danger'
          });

          if (confirmed) {
            // æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®
            this.managedAccounts = [];
            this.projectCosts = {};
            localStorage.removeItem('zeabur_accounts');
            localStorage.removeItem('zeabur_project_costs');

            this.showGlobalToast('ç¼“å­˜å·²æ¸…é™¤ï¼æ­£åœ¨é‡æ–°è·å–æ•°æ®...', 'success');
            this.fetchData();
          }
        },
        toggleAccount(accountName) {
          // ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶ï¼Œç¡®ä¿çŠ¶æ€è¢«æ­£ç¡®åˆå§‹åŒ–
          if (!(accountName in this.expandedAccounts)) {
            this.expandedAccounts[accountName] = false;
          } else {
            this.expandedAccounts[accountName] = !this.expandedAccounts[accountName];
          }
        },
        isAccountExpanded(accountName) {
          // å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡ï¼Œé»˜è®¤ä¸ºå±•å¼€çŠ¶æ€
          if (!(accountName in this.expandedAccounts)) {
            return true;
          }
          return this.expandedAccounts[accountName];
        },
        // æš‚åœæœåŠ¡
        async pauseService(account, project, service) {
          const confirmed = await this.showConfirm({
            title: 'æš‚åœæœåŠ¡',
            message: `ç¡®å®šè¦æš‚åœæœåŠ¡"${service.name}"å—ï¼Ÿ`,
            icon: 'fa-pause-circle',
            confirmText: 'ç¡®å®šæš‚åœ',
            confirmClass: 'btn-warning'
          });

          if (!confirmed) return;

          try {
            // è·å–ç¯å¢ƒ ID
            const environmentId = project.environments && project.environments[0] ? project.environments[0]._id : null;
            if (!environmentId) {
              this.showGlobalToast('æ— æ³•è·å–ç¯å¢ƒ IDï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•', 'error');
              return;
            }

            // è·å–è´¦å· token
            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) {
              this.showGlobalToast('æ— æ³•è·å–è´¦å· tokenï¼Œè¯·é‡æ–°æ·»åŠ è´¦å·', 'error');
              return;
            }

            const response = await fetch('/api/service/pause', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                serviceId: service._id,
                environmentId: environmentId
              })
            });

            const result = await response.json();
            if (result.success) {
              this.showGlobalToast('æœåŠ¡å·²æš‚åœ', 'success');
              this.fetchData();
            } else {
              this.showGlobalToast('æš‚åœå¤±è´¥: ' + (result.error || JSON.stringify(result)), 'error');
            }
          } catch (error) {
            this.showGlobalToast('æ“ä½œå¤±è´¥: ' + error.message, 'error');
          }
        },
        // é‡å¯æœåŠ¡
        async restartService(account, project, service) {
          const action = service.status === 'SUSPENDED' ? 'å¯åŠ¨' : 'é‡å¯';
          const confirmed = await this.showConfirm({
            title: `${action}æœåŠ¡`,
            message: `ç¡®å®šè¦${action}æœåŠ¡"${service.name}"å—ï¼Ÿ`,
            icon: 'fa-redo',
            confirmText: `ç¡®å®š${action}`,
            confirmClass: 'btn-primary'
          });

          if (!confirmed) return;

          try {
            // è·å–ç¯å¢ƒ ID
            const environmentId = project.environments && project.environments[0] ? project.environments[0]._id : null;
            if (!environmentId) {
              this.showGlobalToast('æ— æ³•è·å–ç¯å¢ƒ IDï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•', 'error');
              return;
            }

            // è·å–è´¦å· token
            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) {
              this.showGlobalToast('æ— æ³•è·å–è´¦å· tokenï¼Œè¯·é‡æ–°æ·»åŠ è´¦å·', 'error');
              return;
            }

            const response = await fetch('/api/service/restart', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                serviceId: service._id,
                environmentId: environmentId
              })
            });

            const result = await response.json();
            if (result.success) {
              this.showGlobalToast(`æœåŠ¡å·²${action}`, 'success');
              this.fetchData();
            } else {
              this.showGlobalToast(`${action}å¤±è´¥: ` + (result.error || JSON.stringify(result)), 'error');
            }
          } catch (error) {
            this.showGlobalToast('æ“ä½œå¤±è´¥: ' + error.message, 'error');
          }
        },
        // æŸ¥çœ‹æœåŠ¡æ—¥å¿—
        async showServiceLogs(account, project, service) {
          this.logsModalTitle = 'æœåŠ¡æ—¥å¿— - ' + service.name;
          this.logsModalInfo = { project: project.name, account: account.name, count: 0, time: new Date().toLocaleString('zh-CN') };
          this.logsContent = '';
          this.logsLoading = true;
          this.logsAutoScroll = true;
          this.logsFullscreen = false;
          this.logsRealTime = true;
          this.logsCurrentAccount = account;
          this.logsCurrentProject = project;
          this.logsCurrentService = service;
          this.showLogsModal = true;

          try {
            const environmentId = project.environments && project.environments[0] ? project.environments[0]._id : null;
            if (!environmentId) { this.logsContent = 'âŒ æ— æ³•è·å–ç¯å¢ƒ ID'; this.logsLoading = false; return; }

            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) { this.logsContent = 'âŒ æ— æ³•è·å–è´¦å· token'; this.logsLoading = false; return; }

            const response = await fetch('/api/service/logs', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({ token: accountData.token, serviceId: service._id, environmentId: environmentId, projectId: project._id, limit: 200 })
            });

            const result = await response.json();
            if (result.success && result.logs) {
              this.logsContent = result.logs.map(log => '[' + new Date(log.timestamp).toLocaleString('zh-CN') + '] ' + log.message).join('\n');
              this.logsModalInfo.count = result.count;

              // ç­‰å¾…DOMæ›´æ–°åæ»šåŠ¨åˆ°åº•éƒ¨å¹¶è®¾ç½®æ»šåŠ¨æ¡
              this.$nextTick(() => {
                this.scrollToBottom();
                this.setupHorizontalScrollbar();
              });
            } else {
              this.logsContent = 'âŒ è·å–æ—¥å¿—å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯');
            }
          } catch (error) {
            this.logsContent = 'âŒ è·å–æ—¥å¿—å¤±è´¥: ' + error.message;
          } finally {
            this.logsLoading = false;
          }
        },
        toggleAutoScroll() {
          this.logsAutoScroll = !this.logsAutoScroll;
          if (this.logsAutoScroll) {
            this.scrollToBottom();
          }
        },
        toggleFullscreen() {
          this.logsFullscreen = !this.logsFullscreen;
          this.$nextTick(() => {
            if (this.logsAutoScroll) {
              this.scrollToBottom();
            }
          });
        },
        scrollToBottom() {
          if (this.$refs.logsText) {
            this.$refs.logsText.scrollTop = this.$refs.logsText.scrollHeight;
          }
        },
        setupAutoScroll() {
          if (this.logsScrollTimer) {
            clearInterval(this.logsScrollTimer);
          }

          if (this.logsAutoScroll && this.showLogsModal) {
            this.logsScrollTimer = setInterval(() => {
              this.scrollToBottom();
              this.updateHorizontalScrollbar();
            }, 1000);
          }
        },
        updateHorizontalScrollbar() {
          this.$nextTick(() => {
            const logsText = this.$refs.logsText;
            const scrollbar = this.$refs.logsScrollbar;
            const thumb = this.$refs.logsScrollbarThumb;

            if (!logsText || !scrollbar || !thumb) return;

            const contentWidth = logsText.scrollWidth;
            const viewportWidth = logsText.clientWidth;

            if (contentWidth <= viewportWidth) {
              scrollbar.style.display = 'none';
              return;
            }

            scrollbar.style.display = 'block';

            const maxScroll = contentWidth - viewportWidth;
            const currentScroll = logsText.scrollLeft;
            const scrollRatio = maxScroll > 0 ? currentScroll / maxScroll : 0;

            const thumbWidth = Math.max((viewportWidth / contentWidth) * 100, 5);
            const maxThumbLeft = 100 - thumbWidth;
            const thumbLeft = scrollRatio * maxThumbLeft;

            thumb.style.width = thumbWidth + '%';
            thumb.style.left = thumbLeft + '%';
          });
        },
        setupHorizontalScrollbar() {
          this.$nextTick(() => {
            const logsTextContainer = this.$refs.logsTextContainer;
            const logsText = this.$refs.logsText;
            const scrollbar = this.$refs.logsScrollbar;
            const thumb = this.$refs.logsScrollbarThumb;

            if (!logsText || !scrollbar || !thumb || !logsTextContainer) return;

            let isDragging = false;
            let dragStartX = 0;
            let dragStartThumbLeft = 0;

            // æ›´æ–°æ»šåŠ¨æ¡çŠ¶æ€
            const updateScrollbar = () => {
              const contentWidth = logsText.scrollWidth;
              const viewportWidth = logsText.clientWidth;

              if (contentWidth <= viewportWidth) {
                scrollbar.style.display = 'none';
                return;
              }

              scrollbar.style.display = 'block';

              const maxScroll = contentWidth - viewportWidth;
              const currentScroll = logsText.scrollLeft;
              const scrollRatio = maxScroll > 0 ? currentScroll / maxScroll : 0;

              const thumbWidth = Math.max((viewportWidth / contentWidth) * 100, 5);
              const maxThumbLeft = 100 - thumbWidth;
              const thumbLeft = scrollRatio * maxThumbLeft;

              thumb.style.width = thumbWidth + '%';
              thumb.style.left = thumbLeft + '%';
            };

            // æ»šåŠ¨æ¡ä½ç½®è½¬æ¢ä¸ºå†…å®¹æ»šåŠ¨ä½ç½®
            const thumbPositionToScroll = (thumbLeftPercent) => {
              const contentWidth = logsText.scrollWidth;
              const viewportWidth = logsText.clientWidth;
              const maxScroll = contentWidth - viewportWidth;
              const thumbWidth = parseFloat(thumb.style.width) || 0;
              const maxThumbLeft = 100 - thumbWidth;

              if (maxThumbLeft <= 0) return 0;

              const scrollRatio = thumbLeftPercent / maxThumbLeft;
              return scrollRatio * maxScroll;
            };

            // ç›‘å¬å†…å®¹æ»šåŠ¨
            logsText.addEventListener('scroll', updateScrollbar);

            // æ»‘å—æ‹–æ‹½å¼€å§‹
            thumb.addEventListener('mousedown', (e) => {
              isDragging = true;
              dragStartX = e.clientX;
              dragStartThumbLeft = parseFloat(thumb.style.left) || 0;
              thumb.style.cursor = 'grabbing';
              e.preventDefault();
              e.stopPropagation();
            });

            // æ‹–æ‹½ä¸­
            document.addEventListener('mousemove', (e) => {
              if (!isDragging) return;

              const scrollbarRect = scrollbar.getBoundingClientRect();
              const scrollbarWidth = scrollbarRect.width;
              const thumbWidth = thumb.clientWidth;
              const maxThumbLeftPx = scrollbarWidth - thumbWidth;

              if (maxThumbLeftPx <= 0) return;

              // è®¡ç®—é¼ æ ‡ç§»åŠ¨è·ç¦»å¯¹åº”çš„æ»‘å—ç§»åŠ¨è·ç¦»
              const deltaX = e.clientX - dragStartX;
              const deltaThumbPercent = (deltaX / scrollbarWidth) * 100;
              const newThumbLeft = Math.max(0, Math.min(dragStartThumbLeft + deltaThumbPercent, 100 - (thumbWidth / scrollbarWidth * 100)));

              // è®¾ç½®æ»‘å—ä½ç½®å¹¶æ»šåŠ¨å†…å®¹
              thumb.style.left = newThumbLeft + '%';
              const targetScroll = thumbPositionToScroll(newThumbLeft);
              logsText.scrollLeft = targetScroll;
            });

            // æ‹–æ‹½ç»“æŸ
            document.addEventListener('mouseup', () => {
              if (isDragging) {
                isDragging = false;
                thumb.style.cursor = 'grab';
              }
            });

            // ç‚¹å‡»æ»šåŠ¨æ¡åŒºåŸŸè·³è½¬
            scrollbar.addEventListener('click', (e) => {
              if (e.target === thumb) return;

              const scrollbarRect = scrollbar.getBoundingClientRect();
              const clickX = e.clientX - scrollbarRect.left;
              const scrollbarWidth = scrollbarRect.width;
              const thumbWidth = thumb.clientWidth;

              // è®¡ç®—ç›®æ ‡æ»‘å—ä½ç½®ï¼ˆè®©æ»‘å—ä¸­å¿ƒå¯¹é½åˆ°ç‚¹å‡»ä½ç½®ï¼‰
              const targetThumbLeftPx = Math.max(0, Math.min(clickX - thumbWidth / 2, scrollbarWidth - thumbWidth));
              const targetThumbLeftPercent = (targetThumbLeftPx / scrollbarWidth) * 100;

              // è®¾ç½®æ»‘å—ä½ç½®å¹¶æ»šåŠ¨å†…å®¹
              thumb.style.left = targetThumbLeftPercent + '%';
              const targetScroll = thumbPositionToScroll(targetThumbLeftPercent);
              logsText.scrollLeft = targetScroll;
            });

            // åˆå§‹åŒ–æ»šåŠ¨æ¡
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            const resizeObserver = new ResizeObserver(() => {
              updateScrollbar();
            });
            resizeObserver.observe(logsText);

            // åˆå§‹åŒ–
            updateScrollbar();
          });
        },
        toggleRealTimeRefresh() {
          this.logsRealTime = !this.logsRealTime;
          if (this.logsRealTime) {
            this.startRealTimeRefresh();
          } else {
            this.stopRealTimeRefresh();
          }
        },
        toggleDataRefresh() {
          this.dataRefreshPaused = !this.dataRefreshPaused;
          if (this.dataRefreshPaused) {
            // æš‚åœè‡ªåŠ¨åˆ·æ–°
            if (this.countdownInterval) {
              clearInterval(this.countdownInterval);
              this.countdownInterval = null;
            }
            if (this.refreshInterval) {
              clearInterval(this.refreshInterval);
              this.refreshInterval = null;
            }
          } else {
            // æ¢å¤è‡ªåŠ¨åˆ·æ–°
            this.startCountdown();
            this.refreshInterval = setInterval(() => {
              this.fetchData();
            }, 30000);
          }
        },
        // å®æ—¶åˆ·æ–°æ—¥å¿—
        startRealTimeRefresh() {
          if (this.logsRealTimeTimer) {
            clearInterval(this.logsRealTimeTimer);
          }

          if (this.logsRealTime && this.showLogsModal && this.logsCurrentAccount && this.logsCurrentProject && this.logsCurrentService) {
            this.logsRealTimeTimer = setInterval(async () => {
              await this.refreshLogs();
            }, 5000); // æ¯5ç§’åˆ·æ–°ä¸€æ¬¡
          }
        },

        // åœæ­¢å®æ—¶åˆ·æ–°
        stopRealTimeRefresh() {
          if (this.logsRealTimeTimer) {
            clearInterval(this.logsRealTimeTimer);
            this.logsRealTimeTimer = null;
          }
        },

        // åˆ·æ–°æ—¥å¿—
        async refreshLogs() {
          if (!this.logsCurrentAccount || !this.logsCurrentProject || !this.logsCurrentService) return;

          try {
            const environmentId = this.logsCurrentProject.environments && this.logsCurrentProject.environments[0] ? this.logsCurrentProject.environments[0]._id : null;
            if (!environmentId) return;

            const accountData = this.managedAccounts.find(acc => acc.name === this.logsCurrentAccount.name);
            if (!accountData || !accountData.token) return;

            const response = await fetch('/api/service/logs', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                serviceId: this.logsCurrentService._id,
                environmentId: environmentId,
                projectId: this.logsCurrentProject._id,
                limit: 200
              })
            });

            const result = await response.json();
            if (result.success && result.logs) {
              const newLogs = result.logs.map(log => '[' + new Date(log.timestamp).toLocaleString('zh-CN') + '] ' + log.message).join('\n');

              // å¦‚æœæ˜¯è‡ªåŠ¨æ»šåŠ¨çŠ¶æ€ï¼Œä¿æŒåœ¨åº•éƒ¨
              const wasAtBottom = this.$refs.logsText && (this.$refs.logsText.scrollHeight - this.$refs.logsText.scrollTop <= this.$refs.logsText.clientHeight + 10);

              this.logsContent = newLogs;
              this.logsModalInfo.count = result.count;
              this.logsModalInfo.time = new Date().toLocaleString('zh-CN');

              this.$nextTick(() => {
                if (wasAtBottom && this.logsAutoScroll) {
                  this.scrollToBottom();
                }
                this.updateHorizontalScrollbar();
              });
            }
          } catch (error) {
            console.error('åˆ·æ–°æ—¥å¿—å¤±è´¥:', error);
          }
        },
        // åˆ·æ–°æ—¥å¿—
        async refreshLogs() {
          if (!this.logsCurrentAccount || !this.logsCurrentProject || !this.logsCurrentService) return;

          try {
            const environmentId = this.logsCurrentProject.environments && this.logsCurrentProject.environments[0] ? this.logsCurrentProject.environments[0]._id : null;
            if (!environmentId) return;

            const accountData = this.managedAccounts.find(acc => acc.name === this.logsCurrentAccount.name);
            if (!accountData || !accountData.token) return;

            const response = await fetch('/api/service/logs', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                serviceId: this.logsCurrentService._id,
                environmentId: environmentId,
                projectId: this.logsCurrentProject._id,
                limit: 200
              })
            });

            const result = await response.json();
            if (result.success && result.logs) {
              const newLogs = result.logs.map(log => '[' + new Date(log.timestamp).toLocaleString('zh-CN') + '] ' + log.message).join('\n');

              // åªåœ¨æœ‰æ–°æ—¥å¿—æ—¶æ›´æ–°
              if (newLogs !== this.logsContent) {
                this.logsContent = newLogs;
                this.logsModalInfo.count = result.count;
                this.logsModalInfo.time = new Date().toLocaleString('zh-CN');

                // å¦‚æœå¯ç”¨è‡ªåŠ¨æ»šåŠ¨ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨
                if (this.logsAutoScroll) {
                  this.$nextTick(() => {
                    this.scrollToBottom();
                    this.updateHorizontalScrollbar();
                  });
                }
              }
            }
          } catch (error) {
            console.error('åˆ·æ–°æ—¥å¿—å¤±è´¥:', error);
          }
        },
        // æ ¼å¼åŒ–è´¹ç”¨æ˜¾ç¤ºï¼ˆå°äº $0.01 æ˜¾ç¤ºä¸º $0.01ï¼‰
        formatCost(cost) {
          if (cost > 0 && cost < 0.01) {
            return '0.01';
          }
          return cost.toFixed(2);
        },
        // æ›´æ–°æ‰¹é‡æ·»åŠ çš„æ‰“ç æ˜¾ç¤º
        updateBatchDisplay() {
          if (!this.batchAccounts) {
            this.maskedBatchAccounts = '';
            return;
          }
          const lines = this.batchAccounts.split('\n');
          this.maskedBatchAccounts = lines.map(line => {
            // å°è¯•åŒ¹é…æ‹¬å·æ ¼å¼ï¼šåç§°(token) æˆ– åç§°ï¼ˆtokenï¼‰
            const bracketMatch = line.match(/^(.+?)[ï¼ˆ(](.+?)[ï¼‰)]$/);
            if (bracketMatch) {
              const name = bracketMatch[1];
              const bracket = line.includes('ï¼ˆ') ? 'ï¼ˆ' : '(';
              const closeBracket = line.includes('ï¼‰') ? 'ï¼‰' : ')';
              const maskedToken = bracketMatch[2].replace(/./g, 'â—');
              return name + bracket + maskedToken + closeBracket;
            }

            // å†’å·æ ¼å¼
            let separatorIndex = -1;
            let separator = '';

            if (line.includes(':')) {
              separatorIndex = line.indexOf(':');
              separator = ':';
            } else if (line.includes('ï¼š')) {
              separatorIndex = line.indexOf('ï¼š');
              separator = 'ï¼š';
            }

            if (separatorIndex === -1) return line;

            const name = line.substring(0, separatorIndex);
            const token = line.substring(separatorIndex + 1);
            return name + separator + token.replace(/./g, 'â—');
          }).join('\n');
        },
        // è·å–é¡¹ç›®çš„æ‰€æœ‰åŸŸå
        getProjectDomains(project) {
          const domains = [];
          if (project.services) {
            project.services.forEach(service => {
              if (service.domains && service.domains.length > 0) {
                service.domains.forEach(d => {
                  if (d.domain) {
                    domains.push({
                      domain: d.domain,
                      isGenerated: d.isGenerated || false
                    });
                  }
                });
              }
            });
          }
          return domains;
        },
        // å¼€å§‹ç¼–è¾‘é¡¹ç›®åç§°
        startEditProjectName(project) {
          project.isEditing = true;
          project.editingName = project.name;
          setTimeout(() => {
            try {
              // åªåœ¨å½“å‰é¡¹ç›®èŒƒå›´å†…æŸ¥æ‰¾è¾“å…¥ï¼Œé¿å…å…¨å±€ querySelectorAll
              const el = document.getElementById('proj-' + project._id);
              if (el) {
                const input = el.querySelector('.edit-input');
                if (input) input.focus();
              }
            } catch (e) { console.error(e); }
          }, 50);
        },
        // å–æ¶ˆç¼–è¾‘é¡¹ç›®åç§°
        cancelEditProjectName(project) {
          project.isEditing = false;
          project.editingName = '';
        },
        // ä¿å­˜é¡¹ç›®åç§°
        async saveProjectName(account, project) {
          // å¦‚æœä¸åœ¨ç¼–è¾‘çŠ¶æ€ï¼Œç›´æ¥è¿”å›ï¼ˆé¿å… blur äº‹ä»¶é‡å¤è§¦å‘ï¼‰
          if (!project.isEditing) {
            return;
          }

          if (!project.editingName || project.editingName.trim() === '') {
            alert('âŒ é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º');
            return;
          }

          if (project.editingName === project.name) {
            this.cancelEditProjectName(project);
            return;
          }

          try {
            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) {
              alert('âŒ æ— æ³•è·å–è´¦å· tokenï¼Œè¯·é‡æ–°æ·»åŠ è´¦å·');
              return;
            }

            const response = await fetch('/api/project/rename', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                projectId: project._id,
                newName: project.editingName.trim()
              })
            });

            const result = await response.json();
            if (result.success) {
              project.name = project.editingName.trim();
              this.cancelEditProjectName(project);
              alert('âœ… é¡¹ç›®åç§°å·²æ›´æ–°');
            } else {
              alert('âŒ æ›´æ–°å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
            }
          } catch (error) {
            alert('âŒ æ“ä½œå¤±è´¥: ' + error.message);
          }
        },
        // å¼€å§‹ç¼–è¾‘è´¦å·åç§°
        startEditAccountName(account) {
          account.isEditingName = true;
          account.editingName = account.name;
          setTimeout(() => {
            try {
              const inputs = document.querySelectorAll('.account-name-edit .edit-input');
              if (inputs.length > 0) {
                inputs[inputs.length - 1].focus();
              }
            } catch (e) { console.error(e); }
          }, 50);
        },
        // å–æ¶ˆç¼–è¾‘è´¦å·åç§°
        cancelEditAccountName(account) {
          account.isEditingName = false;
          account.editingName = '';
        },
        // ä¿å­˜è´¦å·åç§°
        async saveAccountName(account) {
          // å¦‚æœä¸åœ¨ç¼–è¾‘çŠ¶æ€ï¼Œç›´æ¥è¿”å›
          if (!account.isEditingName) {
            return;
          }

          if (!account.editingName || account.editingName.trim() === '') {
            alert('âŒ è´¦å·åç§°ä¸èƒ½ä¸ºç©º');
            return;
          }

          if (account.editingName === account.name) {
            this.cancelEditAccountName(account);
            return;
          }

          const newName = account.editingName.trim();
          const oldName = account.name;

          try {
            // æ›´æ–° managedAccounts ä¸­çš„è´¦å·åç§°
            const managedAccount = this.managedAccounts.find(acc => acc.name === oldName);
            if (managedAccount) {
              managedAccount.name = newName;
              account.name = newName;

              // ä¿å­˜åˆ°æœåŠ¡å™¨
              await this.saveManagedAccounts();

              this.cancelEditAccountName(account);
              console.log(`âœ… è´¦å·åç§°å·²ä» "${oldName}" æ›´æ–°ä¸º "${newName}"`);
            } else {
              alert('âŒ æ— æ³•æ‰¾åˆ°å¯¹åº”çš„è´¦å·é…ç½®');
            }
          } catch (error) {
            alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
          }
        },
        // å¯¼å‡ºæ‰€æœ‰è´¦å·ä¸ºJSONæ–‡ä»¶
        exportAllAccounts() {
          if (!this.managedAccounts || this.managedAccounts.length === 0) {
            alert('âŒ æ²¡æœ‰è´¦å·æ•°æ®å¯å¯¼å‡º');
            return;
          }

          // åˆ›å»ºå¯¼å‡ºæ•°æ®çš„å‰¯æœ¬ï¼Œé¿å…åŒ…å«ä¸å¿…è¦çš„Vueå“åº”å¼å±æ€§
          const exportData = this.managedAccounts.map(account => ({
            name: account.name,
            token: account.token,
            status: account.status,
            projects: account.projects || [],
            cost: account.cost || 0,
            lastUpdated: account.lastUpdated || null
          }));

          const dataStr = JSON.stringify(exportData, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });

          // åˆ›å»ºä¸‹è½½é“¾æ¥
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `zeabur-accounts-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);

          alert(`âœ… å·²å¯¼å‡º ${exportData.length} ä¸ªè´¦å·`);
        },
        // ä»JSONæ–‡ä»¶å¯¼å…¥æ‰€æœ‰è´¦å·
        importAllAccounts() {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';
          input.onchange = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const importedData = JSON.parse(e.target.result);
                if (!Array.isArray(importedData)) {
                  alert('âŒ æ— æ•ˆçš„JSONæ ¼å¼ï¼šæ•°æ®åº”ä¸ºæ•°ç»„');
                  return;
                }

                // éªŒè¯å¯¼å…¥çš„æ•°æ®æ ¼å¼
                const isValid = importedData.every(account =>
                  account.hasOwnProperty('name') && account.hasOwnProperty('token')
                );

                if (!isValid) {
                  alert('âŒ JSONæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼šæ¯ä¸ªè´¦å·åº”åŒ…å«nameå’Œtokenå­—æ®µ');
                  return;
                }

                // æ›´æ–°managedAccountsæ•°æ®
                this.managedAccounts = importedData.map(account => ({
                  name: account.name,
                  token: account.token,
                  status: account.status || 'unknown',
                  projects: account.projects || [],
                  cost: account.cost || 0,
                  lastUpdated: account.lastUpdated || null
                }));

                // ä¿å­˜åˆ°æœåŠ¡å™¨
                this.saveManagedAccounts();

                alert(`âœ… å·²å¯¼å…¥ ${importedData.length} ä¸ªè´¦å·`);
              } catch (error) {
                alert('âŒ å¯¼å…¥å¤±è´¥: ' + error.message);
              }
            };
            reader.readAsText(file);
          };
          input.click();
        },

        // ==================== DNS ç®¡ç†ç›¸å…³æ–¹æ³• ====================

        // åˆ‡æ¢åˆ° DNS æ ‡ç­¾é¡µ
        switchToDns() {
          this.mainActiveTab = 'dns';
          if (this.dnsAccounts.length === 0) {
            this.loadDnsAccounts();
          }
          this.loadDnsTemplates();
        },

        // æ˜¾ç¤º Toast
        showDnsToast(message, type = 'success') {
          this.dnsToast = { show: true, message, type };
          setTimeout(() => {
            this.dnsToast.show = false;
          }, 3000);
        },

        // åŠ è½½ CF è´¦å·åˆ—è¡¨
        async loadDnsAccounts() {
          try {
            const response = await fetch('/api/cf-dns/accounts', {
              headers: this.getAuthHeaders()
            });
            const data = await response.json();
            // API ç›´æ¥è¿”å›è´¦å·æ•°ç»„
            if (Array.isArray(data)) {
              this.dnsAccounts = data;
            } else if (data.error) {
              console.error('åŠ è½½ CF è´¦å·å¤±è´¥:', data.error);
            }
          } catch (error) {
            console.error('åŠ è½½ CF è´¦å·å¤±è´¥:', error);
          }
        },

        // åŠ è½½æ¨¡æ¿åˆ—è¡¨
        async loadDnsTemplates() {
          try {
            const response = await fetch('/api/cf-dns/templates', {
              headers: this.getAuthHeaders()
            });
            const data = await response.json();
            // API ç›´æ¥è¿”å›æ¨¡æ¿æ•°ç»„
            if (Array.isArray(data)) {
              this.dnsTemplates = data;
            } else if (data.error) {
              console.error('åŠ è½½æ¨¡æ¿å¤±è´¥:', data.error);
            }
          } catch (error) {
            console.error('åŠ è½½æ¨¡æ¿å¤±è´¥:', error);
          }
        },

        // æ‰“å¼€æ·»åŠ  CF è´¦å·æ¨¡æ€æ¡†
        openAddDnsAccountModal() {
          this.dnsAccountForm = { name: '', apiToken: '', email: '' };
          this.dnsAccountFormError = '';
          this.dnsAccountFormSuccess = '';
          this.showAddDnsAccountModal = true;
        },

        // æ·»åŠ  CF è´¦å·
        async addDnsAccount() {
          if (!this.dnsAccountForm.name || !this.dnsAccountForm.apiToken) {
            this.dnsAccountFormError = 'è¯·å¡«å†™è´¦å·åç§°å’Œ API Token';
            return;
          }

          this.dnsSavingAccount = true;
          this.dnsAccountFormError = '';
          this.dnsAccountFormSuccess = '';

          try {
            const response = await fetch('/api/cf-dns/accounts', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify(this.dnsAccountForm)
            });

            const data = await response.json();
            // API è¿”å› { success: true, account: {...} } æˆ– { error: '...' }
            if (response.ok && (data.success || data.account)) {
              this.dnsAccountFormSuccess = 'è´¦å·æ·»åŠ æˆåŠŸï¼';
              await this.loadDnsAccounts();
              setTimeout(() => {
                this.showAddDnsAccountModal = false;
              }, 1000);
            } else {
              this.dnsAccountFormError = data.error || 'æ·»åŠ å¤±è´¥';
            }
          } catch (error) {
            this.dnsAccountFormError = 'ç½‘ç»œé”™è¯¯: ' + error.message;
          } finally {
            this.dnsSavingAccount = false;
          }
        },

        // éªŒè¯ CF è´¦å·
        async verifyDnsAccount(account) {
          try {
            const response = await fetch(`/api/cf-dns/accounts/${account.id}/verify`, {
              method: 'POST',
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            // API è¿”å› { valid: true/false, ... }
            if (data.valid) {
              this.showDnsToast('Token éªŒè¯æˆåŠŸï¼', 'success');
            } else {
              this.showDnsToast('Token éªŒè¯å¤±è´¥: ' + (data.error || 'æ— æ•ˆçš„ Token'), 'error');
            }
          } catch (error) {
            this.showDnsToast('éªŒè¯å¤±è´¥: ' + error.message, 'error');
          }
        },

        // åˆ é™¤ CF è´¦å·
        async deleteDnsAccount(account) {
          if (!confirm(`ç¡®å®šè¦åˆ é™¤è´¦å· "${account.name}" å—ï¼Ÿ`)) return;

          try {
            const response = await fetch(`/api/cf-dns/accounts/${account.id}`, {
              method: 'DELETE',
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            // API è¿”å› { success: true } æˆ– { error: '...' }
            if (response.ok && data.success) {
              this.showDnsToast('è´¦å·å·²åˆ é™¤', 'success');
              await this.loadDnsAccounts();
              if (this.dnsSelectedAccountId === account.id) {
                this.dnsSelectedAccountId = '';
                this.dnsZones = [];
                this.dnsRecords = [];
              }
            } else {
              this.showDnsToast('åˆ é™¤å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showDnsToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
          }
        },
        // ç¼–è¾‘ CF è´¦å·
        editDnsAccount(account) {
          this.dnsEditingAccount = account;
          this.dnsEditAccountForm = {
            name: account.name,
            apiToken: '', // ä¸æ˜¾ç¤ºåŸ Token
            email: account.email || ''
          };
          this.dnsEditAccountFormError = '';
          this.dnsEditAccountFormSuccess = '';
          this.showEditDnsAccountModal = true;
        },
        // æ›´æ–° CF è´¦å·
        async updateDnsAccount() {
          if (!this.dnsEditAccountForm.name) {
            this.dnsEditAccountFormError = 'è¯·å¡«å†™è´¦å·åç§°';
            return;
          }

          this.dnsSavingAccount = true;
          this.dnsEditAccountFormError = '';
          this.dnsEditAccountFormSuccess = '';

          try {
            const updateData = {
              name: this.dnsEditAccountForm.name,
              email: this.dnsEditAccountForm.email
            };

            // å¦‚æœå¡«å†™äº†æ–°çš„ Tokenï¼Œåˆ™åŒ…å«åœ¨æ›´æ–°æ•°æ®ä¸­
            if (this.dnsEditAccountForm.apiToken) {
              updateData.apiToken = this.dnsEditAccountForm.apiToken;
            }

            const response = await fetch(`/api/cf-dns/accounts/${this.dnsEditingAccount.id}`, {
              method: 'PUT',
              headers: this.getAuthHeaders(),
              body: JSON.stringify(updateData)
            });

            const data = await response.json();
            if (response.ok && data.success) {
              this.dnsEditAccountFormSuccess = 'è´¦å·æ›´æ–°æˆåŠŸï¼';
              setTimeout(() => {
                this.showEditDnsAccountModal = false;
                this.loadDnsAccounts();
              }, 1000);
            } else {
              this.dnsEditAccountFormError = data.error || 'æ›´æ–°å¤±è´¥';
            }
          } catch (error) {
            this.dnsEditAccountFormError = 'æ›´æ–°å¤±è´¥: ' + error.message;
          } finally {
            this.dnsSavingAccount = false;
          }
        },

        // åŠ è½½åŸŸååˆ—è¡¨
        async loadDnsZones() {
          if (!this.dnsSelectedAccountId) {
            this.dnsZones = [];
            return;
          }

          this.dnsLoadingZones = true;
          this.dnsZones = [];
          this.dnsRecords = [];
          this.dnsSelectedZoneId = '';
          this.dnsSelectedZoneName = '';

          try {
            const response = await fetch(`/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones`, {
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            // API è¿”å› { zones: [...], pagination: {...} } æˆ– { error: '...' }
            if (data.zones) {
              this.dnsZones = data.zones;
            } else if (data.error) {
              this.showDnsToast('åŠ è½½åŸŸåå¤±è´¥: ' + data.error, 'error');
            }
          } catch (error) {
            this.showDnsToast('åŠ è½½åŸŸåå¤±è´¥: ' + error.message, 'error');
          } finally {
            this.dnsLoadingZones = false;
          }
        },

        // é€‰æ‹©åŸŸå
        selectDnsZone(zone) {
          this.dnsSelectedZoneId = zone.id;
          this.dnsSelectedZoneName = zone.name;
          this.loadDnsRecords();
        },
        // é€‰æ‹©DNSè´¦å·
        selectDnsAccount(acc) {
          this.dnsSelectedAccountId = acc.id;
          this.loadDnsZones();
        },

        // åŠ è½½ DNS è®°å½•
        async loadDnsRecords() {
          if (!this.dnsSelectedAccountId || !this.dnsSelectedZoneId) return;

          this.dnsLoadingRecords = true;
          this.dnsRecords = [];

          try {
            const response = await fetch(
              `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/records`,
              { headers: this.getAuthHeaders() }
            );

            const data = await response.json();
            // API è¿”å› { records: [...], pagination: {...} } æˆ– { error: '...' }
            if (data.records) {
              this.dnsRecords = data.records;
            } else if (data.error) {
              this.showDnsToast('åŠ è½½è®°å½•å¤±è´¥: ' + data.error, 'error');
            }
          } catch (error) {
            this.showDnsToast('åŠ è½½è®°å½•å¤±è´¥: ' + error.message, 'error');
          } finally {
            this.dnsLoadingRecords = false;
          }
        },

        // æ‰“å¼€æ·»åŠ  DNS è®°å½•æ¨¡æ€æ¡†
        openAddDnsRecordModal() {
          this.dnsEditingRecord = null;
          this.dnsRecordForm = { type: 'A', name: '', content: '', ttl: 1, proxied: false, priority: 10 };
          this.dnsRecordFormError = '';
          this.showDnsRecordModal = true;
        },

        // ç¼–è¾‘ DNS è®°å½•
        editDnsRecord(record) {
          this.dnsEditingRecord = record;
          this.dnsRecordForm = {
            type: record.type,
            name: this.formatDnsRecordName(record.name),
            content: record.content,
            ttl: record.ttl,
            proxied: record.proxied || false,
            priority: record.priority || 10
          };
          this.dnsRecordFormError = '';
          this.showDnsRecordModal = true;
        },

        // ä¿å­˜ DNS è®°å½•
        async saveDnsRecord() {
          if (!this.dnsRecordForm.name || !this.dnsRecordForm.content) {
            this.dnsRecordFormError = 'è¯·å¡«å†™åç§°å’Œå†…å®¹';
            return;
          }

          this.dnsSavingRecord = true;
          this.dnsRecordFormError = '';

          try {
            const url = this.dnsEditingRecord
              ? `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/records/${this.dnsEditingRecord.id}`
              : `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/records`;

            const response = await fetch(url, {
              method: this.dnsEditingRecord ? 'PUT' : 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify(this.dnsRecordForm)
            });

            const data = await response.json();
            // API è¿”å› { success: true, record: {...} } æˆ– { error: '...' }
            if (response.ok && (data.success || data.record)) {
              this.showDnsToast(this.dnsEditingRecord ? 'è®°å½•å·²æ›´æ–°' : 'è®°å½•å·²æ·»åŠ ', 'success');
              this.showDnsRecordModal = false;
              await this.loadDnsRecords();
            } else {
              this.dnsRecordFormError = data.error || 'ä¿å­˜å¤±è´¥';
            }
          } catch (error) {
            this.dnsRecordFormError = 'ä¿å­˜å¤±è´¥: ' + error.message;
          } finally {
            this.dnsSavingRecord = false;
          }
        },

        // åˆ é™¤ DNS è®°å½•
        async deleteDnsRecord(record) {
          if (!confirm(`ç¡®å®šè¦åˆ é™¤è®°å½• "${record.name}" å—ï¼Ÿ`)) return;

          try {
            const response = await fetch(
              `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/records/${record.id}`,
              {
                method: 'DELETE',
                headers: this.getAuthHeaders()
              }
            );

            const data = await response.json();
            // API è¿”å› { success: true } æˆ– { error: '...' }
            if (response.ok && data.success) {
              this.showDnsToast('è®°å½•å·²åˆ é™¤', 'success');
              await this.loadDnsRecords();
            } else {
              this.showDnsToast('åˆ é™¤å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showDnsToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
          }
        },
        // åˆ‡æ¢å…¨é€‰ DNS è®°å½•
        toggleSelectAllDnsRecords(event) {
          if (event.target.checked) {
            this.dnsSelectedRecords = this.dnsRecords.map(r => r.id);
          } else {
            this.dnsSelectedRecords = [];
          }
        },
        // æ‰¹é‡åˆ é™¤ DNS è®°å½•
        async batchDeleteDnsRecords() {
          if (this.dnsSelectedRecords.length === 0) return;
          
          if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${this.dnsSelectedRecords.length} æ¡ DNS è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) return;

          const selectedCount = this.dnsSelectedRecords.length;
          let successCount = 0;
          let failedCount = 0;

          // æ˜¾ç¤ºåˆ é™¤è¿›åº¦
          this.showDnsToast(`æ­£åœ¨åˆ é™¤ ${selectedCount} æ¡è®°å½•...`, 'success');

          for (const recordId of this.dnsSelectedRecords) {
            try {
              const response = await fetch(
                `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/records/${recordId}`,
                {
                  method: 'DELETE',
                  headers: this.getAuthHeaders()
                }
              );

              const data = await response.json();
              if (response.ok && data.success) {
                successCount++;
              } else {
                failedCount++;
              }
            } catch (error) {
              failedCount++;
            }
          }

          // æ¸…ç©ºé€‰æ‹©
          this.dnsSelectedRecords = [];

          // åˆ·æ–°è®°å½•åˆ—è¡¨
          await this.loadDnsRecords();

          // æ˜¾ç¤ºç»“æœ
          if (failedCount === 0) {
            this.showDnsToast(`âœ… æˆåŠŸåˆ é™¤ ${successCount} æ¡è®°å½•`, 'success');
          } else {
            this.showDnsToast(`âš ï¸ åˆ é™¤å®Œæˆï¼šæˆåŠŸ ${successCount} æ¡ï¼Œå¤±è´¥ ${failedCount} æ¡`, 'error');
          }
        },

        // å¿«é€Ÿåˆ‡æ¢ DNS è®°å½•
        async dnsQuickSwitch() {
          if (!this.dnsQuickSwitchName || !this.dnsQuickSwitchContent) {
            this.showDnsToast('è¯·å¡«å†™è®°å½•åç§°å’Œæ–°å†…å®¹', 'error');
            return;
          }

          this.dnsSwitching = true;

          try {
            // ä½¿ç”¨æ­£ç¡®çš„ API ç«¯ç‚¹ /switch
            const response = await fetch(
              `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/switch`,
              {
                method: 'POST',
                headers: this.getAuthHeaders(),
                body: JSON.stringify({
                  type: this.dnsQuickSwitchType,
                  name: this.dnsQuickSwitchName,
                  newContent: this.dnsQuickSwitchContent
                })
              }
            );

            const data = await response.json();
            // API è¿”å› { success: true, updated: n, records: [...] } æˆ– { error: '...' }
            if (response.ok && data.success) {
              this.showDnsToast(`åˆ‡æ¢æˆåŠŸï¼æ›´æ–°äº† ${data.updated || 0} æ¡è®°å½•`, 'success');
              this.dnsQuickSwitchName = '';
              this.dnsQuickSwitchContent = '';
              await this.loadDnsRecords();
            } else {
              this.showDnsToast('åˆ‡æ¢å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showDnsToast('åˆ‡æ¢å¤±è´¥: ' + error.message, 'error');
          } finally {
            this.dnsSwitching = false;
          }
        },

        // æ‰“å¼€æ·»åŠ æ¨¡æ¿æ¨¡æ€æ¡†
        openAddDnsTemplateModal() {
          this.dnsEditingTemplate = null;
          this.dnsTemplateForm = { name: '', type: 'A', content: '', ttl: 1, proxied: false, description: '' };
          this.dnsTemplateFormError = '';
          this.showDnsTemplateModal = true;
        },

        // ç¼–è¾‘æ¨¡æ¿
        editDnsTemplate(template) {
          this.dnsEditingTemplate = template;
          this.dnsTemplateForm = { ...template };
          this.dnsTemplateFormError = '';
          this.showDnsTemplateModal = true;
        },

        // ä¿å­˜æ¨¡æ¿
        async saveDnsTemplate() {
          if (!this.dnsTemplateForm.name || !this.dnsTemplateForm.content) {
            this.dnsTemplateFormError = 'è¯·å¡«å†™æ¨¡æ¿åç§°å’Œå†…å®¹';
            return;
          }

          this.dnsSavingTemplate = true;
          this.dnsTemplateFormError = '';

          try {
            const url = this.dnsEditingTemplate
              ? `/api/cf-dns/templates/${this.dnsEditingTemplate.id}`
              : '/api/cf-dns/templates';

            const response = await fetch(url, {
              method: this.dnsEditingTemplate ? 'PUT' : 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify(this.dnsTemplateForm)
            });

            const data = await response.json();
            // API è¿”å› { success: true, template: {...} } æˆ– { error: '...' }
            if (response.ok && (data.success || data.template)) {
              this.showDnsToast(this.dnsEditingTemplate ? 'æ¨¡æ¿å·²æ›´æ–°' : 'æ¨¡æ¿å·²æ·»åŠ ', 'success');
              this.showDnsTemplateModal = false;
              await this.loadDnsTemplates();
            } else {
              this.dnsTemplateFormError = data.error || 'ä¿å­˜å¤±è´¥';
            }
          } catch (error) {
            this.dnsTemplateFormError = 'ä¿å­˜å¤±è´¥: ' + error.message;
          } finally {
            this.dnsSavingTemplate = false;
          }
        },

        // åˆ é™¤æ¨¡æ¿
        async deleteDnsTemplate(template) {
          if (!confirm(`ç¡®å®šè¦åˆ é™¤æ¨¡æ¿ "${template.name}" å—ï¼Ÿ`)) return;

          try {
            const response = await fetch(`/api/cf-dns/templates/${template.id}`, {
              method: 'DELETE',
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            // API è¿”å› { success: true } æˆ– { error: '...' }
            if (response.ok && data.success) {
              this.showDnsToast('æ¨¡æ¿å·²åˆ é™¤', 'success');
              await this.loadDnsTemplates();
            } else {
              this.showDnsToast('åˆ é™¤å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showDnsToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
          }
        },

        // æ ¼å¼åŒ– DNS è®°å½•åç§°
        formatDnsRecordName(name) {
          if (!name || !this.dnsSelectedZoneName) return name;
          const suffix = '.' + this.dnsSelectedZoneName;
          if (name === this.dnsSelectedZoneName) return '@';
          if (name.endsWith(suffix)) {
            return name.slice(0, -suffix.length);
          }
          return name;
        },

        // æ ¼å¼åŒ–æ—¥æœŸ
        formatDnsDate(dateStr) {
          if (!dateStr) return '-';
          const date = new Date(dateStr);
          return date.toLocaleDateString('zh-CN');
        },

        // åˆ¤æ–­è®°å½•ç±»å‹æ˜¯å¦å¯ä»¥å¼€å¯ä»£ç†
        canDnsBeProxied(type) {
          return ['A', 'AAAA', 'CNAME'].includes(type);
        },

        // å¼€å§‹åŒå‡»ç¼–è¾‘ DNS è®°å½•åç§°
        startEditDnsName(record) {
          // å–æ¶ˆå…¶ä»–æ­£åœ¨ç¼–è¾‘çš„è®°å½•
          this.dnsRecords.forEach(r => {
            if (r.isEditingName) {
              r.isEditingName = false;
            }
            if (r.isEditingContent) {
              r.isEditingContent = false;
            }
          });

          record.isEditingName = true;
          record.editingName = this.formatDnsRecordName(record.name);

          // ç­‰å¾… DOM æ›´æ–°åèšç„¦è¾“å…¥æ¡†
          this.$nextTick(() => {
            const inputs = document.querySelectorAll('.inline-edit-input');
            if (inputs.length > 0) {
              inputs[inputs.length - 1].focus();
              inputs[inputs.length - 1].select();
            }
          });
        },

        // å–æ¶ˆç¼–è¾‘ DNS è®°å½•åç§°
        cancelEditDnsName(record) {
          record.isEditingName = false;
          record.editingName = '';
        },

        // ä¿å­˜åŒå‡»ç¼–è¾‘çš„ DNS è®°å½•åç§°
        async saveDnsName(record) {
          // å¦‚æœä¸åœ¨ç¼–è¾‘çŠ¶æ€ï¼Œç›´æ¥è¿”å›
          if (!record.isEditingName) {
            return;
          }

          const originalName = this.formatDnsRecordName(record.name);

          // å¦‚æœåç§°æ²¡æœ‰å˜åŒ–ï¼Œå–æ¶ˆç¼–è¾‘
          if (record.editingName === originalName) {
            this.cancelEditDnsName(record);
            return;
          }

          // éªŒè¯åç§°ä¸ä¸ºç©º
          if (!record.editingName || record.editingName.trim() === '') {
            this.showDnsToast('åç§°ä¸èƒ½ä¸ºç©º', 'error');
            return;
          }

          try {
            const response = await fetch(
              `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/records/${record.id}`,
              {
                method: 'PUT',
                headers: this.getAuthHeaders(),
                body: JSON.stringify({
                  type: record.type,
                  name: record.editingName.trim(),
                  content: record.content,
                  ttl: record.ttl,
                  proxied: record.proxied || false
                })
              }
            );

            const data = await response.json();
            if (response.ok && (data.success || data.record)) {
              // é‡æ–°åŠ è½½è®°å½•ä»¥è·å–æ›´æ–°åçš„å®Œæ•´åç§°
              this.cancelEditDnsName(record);
              this.showDnsToast('è®°å½•åç§°å·²æ›´æ–°', 'success');
              await this.loadDnsRecords();
            } else {
              this.showDnsToast('ä¿å­˜å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showDnsToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
          }
        },

        // å¼€å§‹åŒå‡»ç¼–è¾‘ DNS è®°å½•å†…å®¹
        startEditDnsContent(record) {
          // å–æ¶ˆå…¶ä»–æ­£åœ¨ç¼–è¾‘çš„è®°å½•
          this.dnsRecords.forEach(r => {
            if (r.isEditingContent) {
              r.isEditingContent = false;
            }
          });

          record.isEditingContent = true;
          record.editingContent = record.content;

          // ç­‰å¾… DOM æ›´æ–°åèšç„¦è¾“å…¥æ¡†
          this.$nextTick(() => {
            const inputs = document.querySelectorAll('.inline-edit-input');
            if (inputs.length > 0) {
              inputs[inputs.length - 1].focus();
              inputs[inputs.length - 1].select();
            }
          });
        },

        // å–æ¶ˆç¼–è¾‘ DNS è®°å½•å†…å®¹
        cancelEditDnsContent(record) {
          record.isEditingContent = false;
          record.editingContent = '';
        },

        // ä¿å­˜åŒå‡»ç¼–è¾‘çš„ DNS è®°å½•å†…å®¹
        async saveDnsContent(record) {
          // å¦‚æœä¸åœ¨ç¼–è¾‘çŠ¶æ€ï¼Œç›´æ¥è¿”å›
          if (!record.isEditingContent) {
            return;
          }

          // å¦‚æœå†…å®¹æ²¡æœ‰å˜åŒ–ï¼Œå–æ¶ˆç¼–è¾‘
          if (record.editingContent === record.content) {
            this.cancelEditDnsContent(record);
            return;
          }

          // éªŒè¯å†…å®¹ä¸ä¸ºç©º
          if (!record.editingContent || record.editingContent.trim() === '') {
            this.showDnsToast('å†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
            return;
          }

          try {
            const response = await fetch(
              `/api/cf-dns/accounts/${this.dnsSelectedAccountId}/zones/${this.dnsSelectedZoneId}/records/${record.id}`,
              {
                method: 'PUT',
                headers: this.getAuthHeaders(),
                body: JSON.stringify({
                  type: record.type,
                  name: this.formatDnsRecordName(record.name),
                  content: record.editingContent.trim(),
                  ttl: record.ttl,
                  proxied: record.proxied || false
                })
              }
            );

            const data = await response.json();
            if (response.ok && (data.success || data.record)) {
              // æ›´æ–°æœ¬åœ°è®°å½•
              record.content = record.editingContent.trim();
              this.cancelEditDnsContent(record);
              this.showDnsToast('è®°å½•å·²æ›´æ–°', 'success');
            } else {
              this.showDnsToast('ä¿å­˜å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showDnsToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
          }
        },

        // ==================== OpenAI API ç®¡ç†ç›¸å…³æ–¹æ³• ====================

        // åˆ‡æ¢åˆ° OpenAI æ ‡ç­¾é¡µ
        switchToOpenai() {
          this.mainActiveTab = 'openai';
          if (this.openaiEndpoints.length === 0) {
            this.loadOpenaiEndpoints();
          }
        },

        // æ˜¾ç¤º OpenAI Toast
        showOpenaiToast(message, type = 'success') {
          this.openaiToast = { show: true, message, type };
          setTimeout(() => {
            this.openaiToast.show = false;
          }, 3000);
        },

        // åŠ è½½ OpenAI ç«¯ç‚¹åˆ—è¡¨
        async loadOpenaiEndpoints() {
          this.openaiLoading = true;
          try {
            const response = await fetch('/api/openai/endpoints', {
              headers: this.getAuthHeaders()
            });
            const data = await response.json();
            if (Array.isArray(data)) {
              // ä¸ºæ¯ä¸ªç«¯ç‚¹æ·»åŠ  showKey å±æ€§
              this.openaiEndpoints = data.map(ep => ({ ...ep, showKey: false }));
            } else if (data.error) {
              console.error('åŠ è½½ OpenAI ç«¯ç‚¹å¤±è´¥:', data.error);
            }
          } catch (error) {
            console.error('åŠ è½½ OpenAI ç«¯ç‚¹å¤±è´¥:', error);
          } finally {
            this.openaiLoading = false;
          }
        },

        // æ‰“å¼€æ·»åŠ ç«¯ç‚¹æ¨¡æ€æ¡†
        openAddOpenaiEndpointModal() {
          this.openaiEditingEndpoint = null;
          this.openaiEndpointForm = { name: '', baseUrl: '', apiKey: '', notes: '' };
          this.openaiEndpointFormError = '';
          this.showOpenaiEndpointModal = true;
        },

        // ç¼–è¾‘ç«¯ç‚¹
        editOpenaiEndpoint(endpoint) {
          this.openaiEditingEndpoint = endpoint;
          this.openaiEndpointForm = {
            name: endpoint.name || '',
            baseUrl: endpoint.baseUrl || '',
            apiKey: endpoint.apiKey || '',
            notes: endpoint.notes || ''
          };
          this.openaiEndpointFormError = '';
          this.showOpenaiEndpointModal = true;
        },

        // ä¿å­˜ç«¯ç‚¹
        async saveOpenaiEndpoint() {
          if (!this.openaiEndpointForm.baseUrl || !this.openaiEndpointForm.apiKey) {
            this.openaiEndpointFormError = 'è¯·å¡«å†™ API åœ°å€å’Œ API Key';
            return;
          }

          this.openaiSaving = true;
          this.openaiEndpointFormError = '';

          try {
            const url = this.openaiEditingEndpoint
              ? `/api/openai/endpoints/${this.openaiEditingEndpoint.id}`
              : '/api/openai/endpoints';

            const response = await fetch(url, {
              method: this.openaiEditingEndpoint ? 'PUT' : 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify(this.openaiEndpointForm)
            });

            const data = await response.json();
            if (response.ok && (data.success || data.endpoint || data.id)) {
              // æ ¹æ®éªŒè¯ç»“æœæ˜¾ç¤ºä¸åŒçš„æç¤º
              if (this.openaiEditingEndpoint) {
                this.showOpenaiToast('ç«¯ç‚¹å·²æ›´æ–°', 'success');
              } else if (data.verification && data.verification.valid) {
                const modelsCount = data.endpoint?.models?.length || 0;
                this.showOpenaiToast(`ç«¯ç‚¹å·²æ·»åŠ ï¼ŒéªŒè¯æˆåŠŸï¼æ‰¾åˆ° ${modelsCount} ä¸ªæ¨¡å‹`, 'success');
              } else if (data.verification && !data.verification.valid) {
                this.showOpenaiToast('ç«¯ç‚¹å·²æ·»åŠ ï¼Œä½† API éªŒè¯å¤±è´¥', 'error');
              } else {
                this.showOpenaiToast('ç«¯ç‚¹å·²æ·»åŠ ', 'success');
              }
              this.showOpenaiEndpointModal = false;
              await this.loadOpenaiEndpoints();
            } else {
              this.openaiEndpointFormError = data.error || 'ä¿å­˜å¤±è´¥';
            }
          } catch (error) {
            this.openaiEndpointFormError = 'ä¿å­˜å¤±è´¥: ' + error.message;
          } finally {
            this.openaiSaving = false;
          }
        },

        // åˆ é™¤ç«¯ç‚¹
        async deleteOpenaiEndpoint(endpoint) {
          if (!confirm(`ç¡®å®šè¦åˆ é™¤ç«¯ç‚¹ "${endpoint.name || endpoint.baseUrl}" å—ï¼Ÿ`)) return;

          try {
            const response = await fetch(`/api/openai/endpoints/${endpoint.id}`, {
              method: 'DELETE',
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            if (response.ok && data.success) {
              this.showOpenaiToast('ç«¯ç‚¹å·²åˆ é™¤', 'success');
              await this.loadOpenaiEndpoints();
            } else {
              this.showOpenaiToast('åˆ é™¤å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showOpenaiToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
          }
        },

        // éªŒè¯ç«¯ç‚¹
        async verifyOpenaiEndpoint(endpoint) {
          try {
            this.showOpenaiToast('æ­£åœ¨éªŒè¯...', 'success');
            const response = await fetch(`/api/openai/endpoints/${endpoint.id}/verify`, {
              method: 'POST',
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            if (data.valid) {
              this.showOpenaiToast(`éªŒè¯æˆåŠŸï¼æ‰¾åˆ° ${data.modelsCount || 0} ä¸ªæ¨¡å‹`, 'success');
              await this.loadOpenaiEndpoints();
            } else {
              this.showOpenaiToast('éªŒè¯å¤±è´¥: ' + (data.error || 'API Key æ— æ•ˆ'), 'error');
            }
          } catch (error) {
            this.showOpenaiToast('éªŒè¯å¤±è´¥: ' + error.message, 'error');
          }
        },

        // åˆ·æ–°æ‰€æœ‰ç«¯ç‚¹
        async refreshAllOpenaiEndpoints() {
          this.openaiRefreshing = true;
          try {
            const response = await fetch('/api/openai/endpoints/refresh', {
              method: 'POST',
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            if (data.success) {
              this.showOpenaiToast(`åˆ·æ–°å®Œæˆï¼æˆåŠŸ: ${data.results?.filter(r => r.success).length || 0}`, 'success');
              await this.loadOpenaiEndpoints();
            } else {
              this.showOpenaiToast('åˆ·æ–°å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showOpenaiToast('åˆ·æ–°å¤±è´¥: ' + error.message, 'error');
          } finally {
            this.openaiRefreshing = false;
          }
        },

        // åˆ‡æ¢ç«¯ç‚¹çš„æ¨¡å‹åˆ—è¡¨å±•å¼€/æ”¶èµ·çŠ¶æ€
        toggleOpenaiModels(endpointId) {
          this.openaiExpandedEndpoints[endpointId] = !this.openaiExpandedEndpoints[endpointId];
        },

        // æ£€æŸ¥ç«¯ç‚¹æ˜¯å¦å±•å¼€
        isOpenaiEndpointExpanded(endpointId) {
          return !!this.openaiExpandedEndpoints[endpointId];
        },
        // è·å–æ¨¡å‹åç§°ï¼ˆå…¼å®¹å­—ç¬¦ä¸²å’Œå¯¹è±¡æ ¼å¼ï¼‰
        getModelName(model) {
          if (typeof model === 'string') {
            return model;
          }
          if (model && typeof model === 'object') {
            return model.id || model.name || 'unknown';
          }
          return 'unknown';
        },

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        async copyToClipboard(text) {
          try {
            await navigator.clipboard.writeText(text);
            this.showOpenaiToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
          } catch (error) {
            // é™çº§æ–¹æ¡ˆ
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            this.showOpenaiToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
          }
        },

        // é®è”½ API Key
        maskApiKey(apiKey) {
          if (!apiKey) return '';
          if (apiKey.length <= 8) return '****';
          return apiKey.substring(0, 4) + '****' + apiKey.substring(apiKey.length - 4);
        },

        // å¯¼å‡ºç«¯ç‚¹
        async exportOpenaiEndpoints() {
          try {
            const response = await fetch('/api/openai/export', {
              headers: this.getAuthHeaders()
            });

            const data = await response.json();
            if (data.endpoints) {
              const dataStr = JSON.stringify(data.endpoints, null, 2);
              const dataBlob = new Blob([dataStr], { type: 'application/json' });
              const url = URL.createObjectURL(dataBlob);
              const link = document.createElement('a');
              link.href = url;
              link.download = `openai-endpoints-${new Date().toISOString().slice(0, 10)}.json`;
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              URL.revokeObjectURL(url);
              this.showOpenaiToast(`å·²å¯¼å‡º ${data.endpoints.length} ä¸ªç«¯ç‚¹`, 'success');
            } else {
              this.showOpenaiToast('å¯¼å‡ºå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
          } catch (error) {
            this.showOpenaiToast('å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
          }
        },

        // ä»æ–‡ä»¶å¯¼å…¥ç«¯ç‚¹
        importOpenaiEndpointsFromFile() {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';
          input.onchange = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
              try {
                const importedData = JSON.parse(e.target.result);
                let endpoints = [];

                if (Array.isArray(importedData)) {
                  endpoints = importedData;
                } else if (importedData.endpoints && Array.isArray(importedData.endpoints)) {
                  endpoints = importedData.endpoints;
                } else {
                  this.showOpenaiToast('æ— æ•ˆçš„ JSON æ ¼å¼', 'error');
                  return;
                }

                const response = await fetch('/api/openai/import', {
                  method: 'POST',
                  headers: this.getAuthHeaders(),
                  body: JSON.stringify({ endpoints })
                });

                const data = await response.json();
                if (data.success) {
                  this.showOpenaiToast(`æˆåŠŸå¯¼å…¥`, 'success');
                  await this.loadOpenaiEndpoints();
                } else {
                  this.showOpenaiToast('å¯¼å…¥å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
              } catch (error) {
                this.showOpenaiToast('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
              }
            };
            reader.readAsText(file);
          };
          input.click();
        },

        // æ‰¹é‡æ·»åŠ ç«¯ç‚¹
        async batchAddOpenaiEndpoints() {
          this.openaiBatchError = '';
          this.openaiBatchSuccess = '';

          if (!this.openaiBatchText.trim()) {
            this.openaiBatchError = 'è¯·è¾“å…¥ç«¯ç‚¹ä¿¡æ¯';
            return;
          }

          this.openaiAdding = true;

          try {
            const response = await fetch('/api/openai/import', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({ text: this.openaiBatchText })
            });

            const data = await response.json();
            if (data.success) {
              this.openaiBatchSuccess = `æˆåŠŸæ·»åŠ  ${data.imported || 0} ä¸ªç«¯ç‚¹`;
              this.openaiBatchText = '';
              await this.loadOpenaiEndpoints();
              setTimeout(() => {
                this.openaiBatchSuccess = '';
              }, 3000);
            } else {
              this.openaiBatchError = data.error || 'æ·»åŠ å¤±è´¥';
            }
          } catch (error) {
            this.openaiBatchError = 'æ·»åŠ å¤±è´¥: ' + error.message;
          } finally {
            this.openaiAdding = false;
          }
        },

        // ==================== æ–°å¢åŠŸèƒ½æ–¹æ³• ====================

        // æ˜¾ç¤ºå…¨å±€Toast
        showGlobalToast(message, type = 'success') {
          this.globalToast = { show: true, message, type };
          setTimeout(() => {
            this.globalToast.show = false;
          }, 3000);
        },

        // æ˜¾ç¤ºè‡ªå®šä¹‰Alertå¯¹è¯æ¡†
        showAlert(message, title = 'æç¤º', icon = 'fa-info-circle') {
          return new Promise((resolve) => {
            this.customDialog = {
              show: true,
              title: title,
              message: message,
              icon: icon,
              confirmText: 'ç¡®å®š',
              cancelText: '',
              confirmClass: 'btn-primary',
              onConfirm: () => {
                this.customDialog.show = false;
                resolve(true);
              },
              onCancel: null
            };
          });
        },

        // æ˜¾ç¤ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
        showConfirm(options) {
          return new Promise((resolve) => {
            this.customDialog = {
              show: true,
              title: options.title || 'ç¡®è®¤',
              message: options.message || '',
              icon: options.icon || 'fa-question-circle',
              confirmText: options.confirmText || 'ç¡®å®š',
              cancelText: options.cancelText || 'å–æ¶ˆ',
              confirmClass: options.confirmClass || 'btn-primary',
              onConfirm: () => {
                this.customDialog.show = false;
                resolve(true);
              },
              onCancel: () => {
                this.customDialog.show = false;
                resolve(false);
              }
            };
          });
        },

        // åŠ è½½æ¨¡å—è®¾ç½®
        loadModuleSettings() {
          const savedVisibility = localStorage.getItem('module_visibility');
          const savedOrder = localStorage.getItem('module_order');

          // å®šä¹‰æ‰€æœ‰å¯ç”¨æ¨¡å—ï¼ˆä»é¡µé¢ä¸­è‡ªåŠ¨æ£€æµ‹ï¼‰
          const availableModules = ['zeabur', 'dns', 'openai'];

          if (savedVisibility) {
            const saved = JSON.parse(savedVisibility);
            // åˆå¹¶å·²ä¿å­˜çš„è®¾ç½®å’Œæ–°æ¨¡å—
            availableModules.forEach(module => {
              if (!(module in saved)) {
                // æ–°æ¨¡å—é»˜è®¤æ˜¾ç¤º
                saved[module] = true;
              }
            });
            this.moduleVisibility = saved;
          } else {
            // é¦–æ¬¡åŠ è½½ï¼Œæ‰€æœ‰æ¨¡å—é»˜è®¤æ˜¾ç¤º
            availableModules.forEach(module => {
              this.moduleVisibility[module] = true;
            });
          }

          if (savedOrder) {
            const saved = JSON.parse(savedOrder);
            // æ·»åŠ æ–°æ¨¡å—åˆ°é¡ºåºåˆ—è¡¨æœ«å°¾
            availableModules.forEach(module => {
              if (!saved.includes(module)) {
                saved.push(module);
              }
            });
            // ç§»é™¤ä¸å­˜åœ¨çš„æ¨¡å—
            this.moduleOrder = saved.filter(m => availableModules.includes(m));
          } else {
            // é¦–æ¬¡åŠ è½½ï¼Œä½¿ç”¨é»˜è®¤é¡ºåº
            this.moduleOrder = [...availableModules];
          }

          // ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªæ¨¡å—å¯è§ï¼Œå¹¶åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯è§æ¨¡å—
          const hasVisibleModule = Object.values(this.moduleVisibility).some(v => v);
          if (!hasVisibleModule) {
            this.moduleVisibility[this.moduleOrder[0]] = true;
          }

          // åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯è§çš„æ¨¡å—
          const firstVisibleModule = this.moduleOrder.find(m => this.moduleVisibility[m]);
          if (firstVisibleModule) {
            this.mainActiveTab = firstVisibleModule;
          }

          // ä¿å­˜æ›´æ–°åçš„è®¾ç½®
          this.saveModuleSettings();
        },

        // ä¿å­˜æ¨¡å—è®¾ç½®
        saveModuleSettings() {
          localStorage.setItem('module_visibility', JSON.stringify(this.moduleVisibility));
          localStorage.setItem('module_order', JSON.stringify(this.moduleOrder));
        },

        // åˆ‡æ¢æ¨¡å—å¯è§æ€§
        toggleModuleVisibility(module) {
          this.moduleVisibility[module] = !this.moduleVisibility[module];

          // ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªæ¨¡å—å¯è§
          const hasVisibleModule = Object.values(this.moduleVisibility).some(v => v);
          if (!hasVisibleModule) {
            this.moduleVisibility[module] = true;
            this.showGlobalToast('è‡³å°‘éœ€è¦æ˜¾ç¤ºä¸€ä¸ªæ¨¡å—', 'warning');
            return;
          }

          // å¦‚æœéšè—çš„æ˜¯å½“å‰æ¨¡å—ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯è§æ¨¡å—
          if (!this.moduleVisibility[module] && this.mainActiveTab === module) {
            const firstVisibleModule = this.moduleOrder.find(m => this.moduleVisibility[m]);
            if (firstVisibleModule) {
              this.mainActiveTab = firstVisibleModule;
            }
          }

          this.saveModuleSettings();
          this.showGlobalToast(`${this.getModuleName(module)} æ¨¡å—å·²${this.moduleVisibility[module] ? 'æ˜¾ç¤º' : 'éšè—'}`, 'success');
        },

        // è·å–æ¨¡å—åç§°
        getModuleName(module) {
          const names = {
            zeabur: 'Zeabur ç›‘æ§',
            dns: 'CF DNS ç®¡ç†',
            openai: 'OpenAI API'
          };
          return names[module] || module;
        },

        // è·å–æ¨¡å—å›¾æ ‡
        getModuleIcon(module) {
          const icons = {
            zeabur: 'fa-rocket',
            dns: 'fa-cloud',
            openai: 'fa-robot'
          };
          return icons[module] || 'fa-cube';
        },

        // æ‹–æ‹½å¼€å§‹
        handleDragStart(event, index) {
          this.draggedIndex = index;
          event.target.classList.add('dragging');
          // é˜²æ­¢é€‰ä¸­æ–‡æœ¬
          event.dataTransfer.effectAllowed = 'move';
          event.dataTransfer.setData('text/html', event.target.innerHTML);
        },

        // æ‹–æ‹½ç»“æŸ
        handleDragEnd(event) {
          event.target.classList.remove('dragging');
          // ç§»é™¤æ‰€æœ‰æ‹–æ‹½overæ ·å¼
          document.querySelectorAll('.draggable-module-item').forEach(item => {
            item.classList.remove('drag-over');
          });
        },

        // æ‹–æ‹½ç»è¿‡
        handleDragOver(event, index) {
          if (this.draggedIndex === null || this.draggedIndex === index) return;

          // ç§»é™¤æ‰€æœ‰æ‹–æ‹½overæ ·å¼
          document.querySelectorAll('.draggable-module-item').forEach(item => {
            item.classList.remove('drag-over');
          });

          // æ·»åŠ å½“å‰é¡¹çš„æ‹–æ‹½overæ ·å¼
          event.currentTarget.classList.add('drag-over');
        },

        // æ‹–æ‹½æ”¾ä¸‹
        handleDrop(event, dropIndex) {
          event.preventDefault();

          if (this.draggedIndex === null || this.draggedIndex === dropIndex) return;

          // é‡æ–°æ’åˆ—æ•°ç»„
          const draggedItem = this.moduleOrder[this.draggedIndex];
          const newOrder = [...this.moduleOrder];

          // ç§»é™¤æ‹–æ‹½çš„é¡¹
          newOrder.splice(this.draggedIndex, 1);

          // æ’å…¥åˆ°æ–°ä½ç½®
          newOrder.splice(dropIndex, 0, draggedItem);

          this.moduleOrder = newOrder;
          this.draggedIndex = null;

          // ç§»é™¤æ‹–æ‹½overæ ·å¼
          event.currentTarget.classList.remove('drag-over');
        },

        // ä¿å­˜è®¾ç½®
        saveSettings() {
          this.saveModuleSettings();
          this.showGlobalToast('è®¾ç½®å·²ä¿å­˜', 'success');
          this.showSettingsModal = false;
        },

        // ä¿®æ”¹å¯†ç 
        async changePassword() {
          this.passwordError = '';
          this.passwordSuccess = '';

          if (!this.newPassword || this.newPassword.length < 6) {
            this.passwordError = 'å¯†ç é•¿åº¦è‡³å°‘6ä½';
            return;
          }

          if (this.newPassword !== this.confirmPassword) {
            this.passwordError = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
            return;
          }

          try {
            const response = await fetch('/api/change-password', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                oldPassword: this.loginPassword,
                newPassword: this.newPassword
              })
            });

            const result = await response.json();
            if (result.success) {
              this.passwordSuccess = 'å¯†ç ä¿®æ”¹æˆåŠŸï¼';
              this.loginPassword = this.newPassword;
              localStorage.setItem('admin_password', this.newPassword);
              localStorage.setItem('password_time', Date.now().toString());

              this.newPassword = '';
              this.confirmPassword = '';

              setTimeout(() => {
                this.passwordSuccess = '';
              }, 3000);
            } else {
              this.passwordError = result.error || 'ä¿®æ”¹å¤±è´¥';
            }
          } catch (error) {
            this.passwordError = 'ä¿®æ”¹å¤±è´¥: ' + error.message;
          }
        },

        // å¯¼å‡ºå…¨éƒ¨æ•°æ®
        async exportAllData() {
          try {
            const exportData = {
              version: '1.0',
              exportTime: new Date().toISOString(),
              zeabur: {
                accounts: this.managedAccounts,
                projectCosts: this.projectCosts
              },
              dns: {
                accounts: this.dnsAccounts,
                templates: this.dnsTemplates
              },
              openai: {
                endpoints: this.openaiEndpoints
              },
              settings: {
                moduleVisibility: this.moduleVisibility,
                moduleOrder: this.moduleOrder
              }
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `api-monitor-backup-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            this.showGlobalToast('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
          } catch (error) {
            this.showGlobalToast('å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
          }
        },

        // å¯¼å…¥å…¨éƒ¨æ•°æ®
        async importAllData() {
          const confirmed = await this.showConfirm({
            title: 'ç¡®è®¤å¯¼å…¥',
            message: 'å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰é…ç½®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ',
            icon: 'fa-exclamation-triangle',
            confirmText: 'ç¡®å®šå¯¼å…¥',
            confirmClass: 'btn-warning'
          });

          if (!confirmed) return;

          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';
          input.onchange = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
              try {
                const importedData = JSON.parse(e.target.result);

                // éªŒè¯æ•°æ®æ ¼å¼
                if (!importedData.version) {
                  this.showGlobalToast('æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼', 'error');
                  return;
                }

                // å¯¼å…¥ Zeabur æ•°æ®
                if (importedData.zeabur) {
                  if (importedData.zeabur.accounts) {
                    this.managedAccounts = importedData.zeabur.accounts;
                    await this.saveManagedAccounts();
                  }
                  if (importedData.zeabur.projectCosts) {
                    this.projectCosts = importedData.zeabur.projectCosts;
                    localStorage.setItem('zeabur_project_costs', JSON.stringify(this.projectCosts));
                  }
                }

                // å¯¼å…¥ DNS æ•°æ®
                if (importedData.dns) {
                  if (importedData.dns.accounts) {
                    // é€šè¿‡APIå¯¼å…¥DNSè´¦å·
                    for (const account of importedData.dns.accounts) {
                      await fetch('/api/cf-dns/accounts', {
                        method: 'POST',
                        headers: this.getAuthHeaders(),
                        body: JSON.stringify(account)
                      });
                    }
                    await this.loadDnsAccounts();
                  }
                  if (importedData.dns.templates) {
                    // é€šè¿‡APIå¯¼å…¥DNSæ¨¡æ¿
                    for (const template of importedData.dns.templates) {
                      await fetch('/api/cf-dns/templates', {
                        method: 'POST',
                        headers: this.getAuthHeaders(),
                        body: JSON.stringify(template)
                      });
                    }
                    await this.loadDnsTemplates();
                  }
                }

                // å¯¼å…¥ OpenAI æ•°æ®
                if (importedData.openai && importedData.openai.endpoints) {
                  await fetch('/api/openai/import', {
                    method: 'POST',
                    headers: this.getAuthHeaders(),
                    body: JSON.stringify({ endpoints: importedData.openai.endpoints })
                  });
                  await this.loadOpenaiEndpoints();
                }

                // å¯¼å…¥è®¾ç½®
                if (importedData.settings) {
                  if (importedData.settings.moduleVisibility) {
                    this.moduleVisibility = importedData.settings.moduleVisibility;
                  }
                  if (importedData.settings.moduleOrder) {
                    this.moduleOrder = importedData.settings.moduleOrder;
                  }
                  this.saveModuleSettings();
                }

                this.showGlobalToast('æ•°æ®å¯¼å…¥æˆåŠŸ', 'success');
                await this.fetchData();
              } catch (error) {
                this.showGlobalToast('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
              }
            };
            reader.readAsText(file);
          };
          input.click();
        }
      }
    }).mount('#app');
  </script>

</body>

</body>

</html>