<!-- ==================== Uptime 监测部分 ==================== -->
<div class="tab-content uptime-tab-content theme-uptime" :class="[getTabAnimationClass('uptime')]">
  <!-- Uptime 子标签页 -->
  <div class="sec-tabs uptime-sec-tabs">
    <div class="uptime-tabs-scroll-wrapper">
      <button class="tab-btn" :class="{ active: uptimeCurrentTab === 'list' }" @click="uptimeCurrentTab = 'list'">
        <i class="fas fa-heartbeat"></i> 监测列表
      </button>
      <button class="tab-btn" :class="{ active: uptimeCurrentTab === 'add' }"
        @click="uptimeCurrentTab = 'add'; initUptimeForm()">
        <i class="fas fa-plus-circle"></i> 添加监测
      </button>
      <button class="tab-btn" :class="{ active: uptimeCurrentTab === 'stats' }" @click="uptimeCurrentTab = 'stats'">
        <i class="fas fa-chart-pie"></i> 统计概览
      </button>
    </div>
  </div>

  <!-- ========== 监测列表标签页 ========== -->
  <div v-show="uptimeCurrentTab === 'list'" class="sub-tab-content quick-fade-in">
    <!-- 统计条 -->
    <div class="uptime-stats-bar">
      <!-- 统计药丸 -->
      <div class="uptime-stat-pill" :class="{ active: uptimeStatusFilter === null }" @click="uptimeStatusFilter = null">
        <span class="stat-value">{{ uptimeMonitors.length }}</span>
        <span>全部</span>
      </div>
      <div class="uptime-stat-pill up" :class="{ active: uptimeStatusFilter === 'up' }"
        @click="uptimeStatusFilter = 'up'">
        <span class="stat-dot up"></span>
        <span class="stat-value">{{ uptimeStats.up }}</span>
        <span>正常</span>
      </div>
      <div class="uptime-stat-pill down" :class="{ active: uptimeStatusFilter === 'down' }"
        @click="uptimeStatusFilter = 'down'">
        <span class="stat-dot down"></span>
        <span class="stat-value">{{ uptimeStats.down }}</span>
        <span>故障</span>
      </div>
      <div class="uptime-stat-pill pending" :class="{ active: uptimeStatusFilter === 'pending' }"
        @click="uptimeStatusFilter = 'pending'">
        <span class="stat-dot pending"></span>
        <span class="stat-value">{{ uptimeStats.pending }}</span>
        <span>等待</span>
      </div>

      <!-- 搜索框 -->
      <div class="search-box" style="flex: 1; min-width: 150px; max-width: 300px; margin-left: auto;">
        <i class="fas fa-search"></i>
        <input v-model="uptimeSearchText" placeholder="搜索监测..." class="form-input"
          style="padding-left: 36px; height: 38px; border-radius: 19px;" />
      </div>

      <!-- 刷新按钮 -->
      <button class="btn btn-secondary btn-sm" @click="loadUptimeMonitors" :disabled="uptimeLoading"
        style="border-radius: 50%; width: 38px; height: 38px; padding: 0;">
        <i class="fas fa-sync-alt" :class="{ 'fa-spin': uptimeLoading }"></i>
      </button>
    </div>

    <!-- 加载状态 -->
    <div v-if="uptimeLoading && uptimeMonitors.length === 0" class="loading-overlay-elegant">
      <div class="ag-logo-pulse">
        <img src="./logo.svg" alt="Loading" />
      </div>
      <p class="loading-text-elegant">Loading Monitors</p>
    </div>

    <!-- 空状态 -->
    <div v-else-if="uptimeMonitors.length === 0" class="uptime-empty-state">
      <i class="fas fa-heartbeat"></i>
      <h3>暂无监测目标</h3>
      <p>添加您的第一个监测目标，实时掌握服务运行状态</p>
      <button class="btn btn-primary" @click="uptimeCurrentTab = 'add'">
        <i class="fas fa-plus"></i> 添加监测
      </button>
    </div>

    <!-- 监测列表 -->
    <div v-else class="uptime-monitor-list">
      <div v-for="monitor in getFilteredUptimeMonitors()" :key="monitor.id" class="uptime-monitor-card"
        :class="{ paused: !monitor.active }">

        <!-- Monitor Header -->
        <div class="uptime-monitor-header" @click="selectUptimeMonitor(monitor)">
          <!-- Status Indicator -->
          <div class="uptime-status-indicator" :class="getUptimeStatus(monitor)"></div>

          <!-- Monitor Info -->
          <div class="uptime-monitor-info">
            <div class="uptime-monitor-name">
              {{ monitor.name }}
              <span v-if="!monitor.active" style="font-size: 10px; color: var(--text-tertiary); margin-left: 6px;">
                <i class="fas fa-pause-circle"></i> 已暂停
              </span>
            </div>
            <div class="uptime-monitor-url">
              <i :class="getUptimeTypeIcon(monitor.type)" style="margin-right: 4px; opacity: 0.6;"></i>
              {{ getUptimeDisplayUrl(monitor) }}
            </div>
          </div>

          <!-- Monitor Stats -->
          <div class="uptime-monitor-stats">
            <!-- Ping Badge -->
            <div v-if="getLastHeartbeat(monitor.id)" class="uptime-badge ping"
              :class="getPingClass(getLastHeartbeat(monitor.id).ping)">
              {{ getLastHeartbeat(monitor.id).ping || '--' }}ms
            </div>

            <!-- Uptime Badge -->
            <div class="uptime-badge uptime" :class="getUptimeClass(calculateUptime(monitor.id, 1))">
              {{ calculateUptime(monitor.id, 1) }}%
            </div>

            <!-- HeartbeatBar -->
            <div class="uptime-monitor-heartbeat">
              <div class="heartbeat-bar small">
                <div v-for="(beat, idx) in getHeartbeatBars(monitor.id, 30)" :key="idx" class="heartbeat-beat"
                  :class="beat.status" :title="beat.time ? formatDateTime(beat.time) + ' - ' + beat.ping + 'ms' : ''">
                </div>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="uptime-monitor-actions" @click.stop>
            <button class="btn-icon-refined" @click="toggleUptimeMonitor(monitor)"
              :title="monitor.active ? '暂停' : '恢复'">
              <i :class="monitor.active ? 'fas fa-pause' : 'fas fa-play'"></i>
            </button>
            <button class="btn-icon-refined" @click="editUptimeMonitor(monitor)" title="编辑">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon-refined" @click="deleteUptimeMonitor(monitor.id)" title="删除"
              style="color: var(--danger-color);">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>

        <!-- Expanded Details (可选) -->
        <div v-if="selectedUptimeMonitor && selectedUptimeMonitor.id === monitor.id" class="uptime-monitor-details"
          style="padding: 16px 20px; border-top: 1px solid var(--border-color); background: var(--bg-secondary);">
          <!-- HeartbeatBar 大图 -->
          <div class="heartbeat-bar-wrapper">
            <div class="heartbeat-bar">
              <div v-for="(beat, idx) in getHeartbeatBars(monitor.id, 60)" :key="idx" class="heartbeat-beat"
                :class="beat.status" @mouseenter="showUptimeTooltip($event, beat)" @mouseleave="hideUptimeTooltip">
              </div>
            </div>
            <div class="heartbeat-time-labels">
              <span>{{ getHeartbeatTimeLabel(monitor.id, 'start') }}</span>
              <span>现在</span>
            </div>
          </div>

          <!-- 统计信息 -->
          <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-top: 16px;">
            <div class="uptime-form-section" style="padding: 12px; text-align: center;">
              <div style="font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; margin-bottom: 4px;">
                24h 可用率</div>
              <div style="font-size: 20px; font-weight: 800; color: var(--uptime-primary);">{{
                calculateUptime(monitor.id, 1) }}%</div>
            </div>
            <div class="uptime-form-section" style="padding: 12px; text-align: center;">
              <div style="font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; margin-bottom: 4px;">
                7d 可用率</div>
              <div style="font-size: 20px; font-weight: 800; color: var(--text-secondary);">{{
                calculateUptime(monitor.id, 7) }}%</div>
            </div>
            <div class="uptime-form-section" style="padding: 12px; text-align: center;">
              <div style="font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; margin-bottom: 4px;">
                平均响应</div>
              <div style="font-size: 20px; font-weight: 800; color: var(--text-secondary);">{{
                calculateAvgPing(monitor.id) }}ms</div>
            </div>
            <div class="uptime-form-section" style="padding: 12px; text-align: center;">
              <div style="font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; margin-bottom: 4px;">
                检测间隔</div>
              <div style="font-size: 20px; font-weight: 800; color: var(--text-secondary);">{{ monitor.interval }}s
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 添加/编辑监测标签页 ========== -->
  <div v-show="uptimeCurrentTab === 'add'" class="sub-tab-content quick-fade-in">
    <div style="max-width: 800px; margin: 0 auto;">
      <!-- 标题 -->
      <div style="margin-bottom: 24px;">
        <h3 style="font-size: 20px; font-weight: 700; margin: 0 0 4px 0;">
          {{ uptimeForm.id ? '编辑监测' : '添加监测' }}
        </h3>
        <p style="font-size: 13px; color: var(--text-tertiary); margin: 0;">
          配置监测目标参数，系统将定期检测目标状态
        </p>
      </div>

      <!-- 监测类型选择 -->
      <div class="uptime-form-section">
        <h4><i class="fas fa-layer-group"></i> 监测类型</h4>
        <div class="uptime-type-selector">
          <div class="uptime-type-btn" :class="{ active: uptimeForm.type === 'http' }"
            @click="uptimeForm.type = 'http'">
            <i class="fas fa-globe"></i>
            <span>HTTP(s)</span>
          </div>
          <div class="uptime-type-btn" :class="{ active: uptimeForm.type === 'tcp' }" @click="uptimeForm.type = 'tcp'">
            <i class="fas fa-ethernet"></i>
            <span>TCP</span>
          </div>
          <div class="uptime-type-btn" :class="{ active: uptimeForm.type === 'ping' }"
            @click="uptimeForm.type = 'ping'">
            <i class="fas fa-signal"></i>
            <span>Ping</span>
          </div>
          <div class="uptime-type-btn" :class="{ active: uptimeForm.type === 'dns' }" @click="uptimeForm.type = 'dns'">
            <i class="fas fa-server"></i>
            <span>DNS</span>
          </div>
          <div class="uptime-type-btn" :class="{ active: uptimeForm.type === 'keyword' }"
            @click="uptimeForm.type = 'keyword'">
            <i class="fas fa-search"></i>
            <span>关键词</span>
          </div>
          <div class="uptime-type-btn" :class="{ active: uptimeForm.type === 'push' }"
            @click="uptimeForm.type = 'push'">
            <i class="fas fa-satellite-dish"></i>
            <span>Push</span>
          </div>
        </div>
      </div>

      <!-- 基本设置 -->
      <div class="uptime-form-section">
        <h4><i class="fas fa-cog"></i> 基本设置</h4>
        <div class="uptime-form-row">
          <div class="form-group">
            <label class="form-label">显示名称 <span class="required">*</span></label>
            <input v-model="uptimeForm.name" type="text" class="form-input" placeholder="例如: 官网首页" />
          </div>
          <div class="form-group" v-if="uptimeForm.type === 'http' || uptimeForm.type === 'keyword'">
            <label class="form-label">URL <span class="required">*</span></label>
            <input v-model="uptimeForm.url" type="text" class="form-input" placeholder="https://example.com" />
          </div>
          <div class="form-group"
            v-if="uptimeForm.type === 'tcp' || uptimeForm.type === 'ping' || uptimeForm.type === 'dns'">
            <label class="form-label">主机名 <span class="required">*</span></label>
            <input v-model="uptimeForm.hostname" type="text" class="form-input" placeholder="example.com 或 IP" />
          </div>
          <div class="form-group" v-if="uptimeForm.type === 'tcp'">
            <label class="form-label">端口 <span class="required">*</span></label>
            <input v-model.number="uptimeForm.port" type="number" class="form-input" placeholder="443" />
          </div>
        </div>
      </div>

      <!-- 检测设置 -->
      <div class="uptime-form-section">
        <h4><i class="fas fa-clock"></i> 检测设置</h4>
        <div class="uptime-form-row">
          <div class="form-group">
            <label class="form-label">检测间隔 (秒)</label>
            <input v-model.number="uptimeForm.interval" type="number" class="form-input" min="20" max="86400" />
            <small class="form-hint">建议 60 秒以上</small>
          </div>
          <div class="form-group">
            <label class="form-label">超时时间 (秒)</label>
            <input v-model.number="uptimeForm.timeout" type="number" class="form-input" min="1" max="300" />
          </div>
          <div class="form-group">
            <label class="form-label">重试次数</label>
            <input v-model.number="uptimeForm.retries" type="number" class="form-input" min="0" max="10" />
            <small class="form-hint">失败后重试次数</small>
          </div>
        </div>
      </div>

      <!-- HTTP 特有设置 -->
      <div v-if="uptimeForm.type === 'http' || uptimeForm.type === 'keyword'" class="uptime-form-section">
        <h4><i class="fas fa-cogs"></i> HTTP 设置</h4>
        <div class="uptime-form-row">
          <div class="form-group">
            <label class="form-label">请求方法</label>
            <select v-model="uptimeForm.method" class="form-select">
              <option value="GET">GET</option>
              <option value="POST">POST</option>
              <option value="PUT">PUT</option>
              <option value="DELETE">DELETE</option>
              <option value="HEAD">HEAD</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">有效状态码</label>
            <input v-model="uptimeForm.accepted_status_codes" type="text" class="form-input" placeholder="200-299" />
            <small class="form-hint">例如: 200-299, 301, 302</small>
          </div>
        </div>
        <div class="form-group" v-if="uptimeForm.type === 'keyword'">
          <label class="form-label">关键词</label>
          <input v-model="uptimeForm.keyword" type="text" class="form-input" placeholder="页面必须包含的关键词" />
        </div>
      </div>

      <!-- DNS 特有设置 -->
      <div v-if="uptimeForm.type === 'dns'" class="uptime-form-section">
        <h4><i class="fas fa-globe-americas"></i> DNS 设置</h4>
        <div class="uptime-form-row">
          <div class="form-group">
            <label class="form-label">记录类型</label>
            <select v-model="uptimeForm.dns_resolve_type" class="form-select">
              <option value="A">A</option>
              <option value="AAAA">AAAA</option>
              <option value="CNAME">CNAME</option>
              <option value="MX">MX</option>
              <option value="TXT">TXT</option>
              <option value="NS">NS</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">DNS 服务器 (可选)</label>
            <input v-model="uptimeForm.dns_resolve_server" type="text" class="form-input" placeholder="8.8.8.8" />
          </div>
        </div>
      </div>

      <!-- 操作按钮 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
        <button class="btn btn-secondary" @click="uptimeCurrentTab = 'list'; resetUptimeForm()">
          取消
        </button>
        <button class="btn btn-primary" @click="saveUptimeMonitor" :disabled="uptimeSaving">
          <i class="fas" :class="uptimeSaving ? 'fa-spinner fa-spin' : 'fa-save'"></i>
          {{ uptimeForm.id ? '保存更改' : '创建监测' }}
        </button>
      </div>
    </div>
  </div>

  <!-- ========== 统计概览标签页 ========== -->
  <div v-show="uptimeCurrentTab === 'stats'" class="sub-tab-content quick-fade-in">
    <div style="max-width: 1200px; margin: 0 auto;">
      <!-- 总体统计卡片 -->
      <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
        <div class="uptime-form-section"
          style="padding: 20px; text-align: center; background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.02));">
          <div style="font-size: 36px; font-weight: 800; color: var(--uptime-primary);">{{ uptimeStats.up }}</div>
          <div style="font-size: 12px; color: var(--text-tertiary); text-transform: uppercase; margin-top: 4px;">正常运行
          </div>
        </div>
        <div class="uptime-form-section"
          style="padding: 20px; text-align: center; background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.02));">
          <div style="font-size: 36px; font-weight: 800; color: var(--uptime-down);">{{ uptimeStats.down }}</div>
          <div style="font-size: 12px; color: var(--text-tertiary); text-transform: uppercase; margin-top: 4px;">故障中
          </div>
        </div>
        <div class="uptime-form-section"
          style="padding: 20px; text-align: center; background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.02));">
          <div style="font-size: 36px; font-weight: 800; color: var(--uptime-pending);">{{ uptimeStats.pending }}</div>
          <div style="font-size: 12px; color: var(--text-tertiary); text-transform: uppercase; margin-top: 4px;">等待中
          </div>
        </div>
        <div class="uptime-form-section" style="padding: 20px; text-align: center;">
          <div style="font-size: 36px; font-weight: 800; color: var(--uptime-unknown);">{{ uptimeStats.unknown }}</div>
          <div style="font-size: 12px; color: var(--text-tertiary); text-transform: uppercase; margin-top: 4px;">未知/暂停
          </div>
        </div>
      </div>

      <!-- 总体可用率 -->
      <div class="uptime-form-section">
        <h4><i class="fas fa-chart-line"></i> 总体可用率</h4>
        <div
          style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 16px;">
          <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 800; color: var(--uptime-primary);">{{ calculateOverallUptime(1)
              }}%</div>
            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">过去 24 小时</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 800; color: var(--text-secondary);">{{ calculateOverallUptime(7)
              }}%</div>
            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">过去 7 天</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 800; color: var(--text-secondary);">{{ calculateOverallUptime(30)
              }}%</div>
            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">过去 30 天</div>
          </div>
        </div>
      </div>

      <!-- 最近事件 -->
      <div class="uptime-form-section">
        <h4><i class="fas fa-history"></i> 最近事件</h4>
        <div v-if="uptimeRecentEvents.length === 0"
          style="text-align: center; padding: 40px; color: var(--text-tertiary);">
          <i class="fas fa-check-circle"
            style="font-size: 32px; opacity: 0.3; margin-bottom: 12px; display: block;"></i>
          暂无重要事件
        </div>
        <div v-else class="uptime-events-list">
          <div v-for="event in uptimeRecentEvents" :key="event.id"
            style="display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
            <div class="uptime-status-indicator" :class="event.status === 1 ? 'up' : 'down'"
              style="width: 10px; height: 10px;"></div>
            <div style="flex: 1; min-width: 0;">
              <div style="font-weight: 600; color: var(--text-primary);">{{ event.monitorName }}</div>
              <div style="font-size: 12px; color: var(--text-tertiary);">{{ event.msg || (event.status === 1 ? '恢复正常' :
                '检测失败') }}</div>
            </div>
            <div style="font-size: 11px; color: var(--text-tertiary); font-family: var(--font-mono);">
              {{ formatTimeAgo(event.time) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Uptime Tooltip -->
<div id="uptime-tooltip" class="uptime-tooltip">
  <div class="uptime-tooltip-time"></div>
  <div class="uptime-tooltip-status">
    <span class="dot"></span>
    <span class="status-text"></span>
  </div>
  <div class="uptime-tooltip-ping"></div>
</div>