<!-- ==================== Antigravity 管理部分 ==================== -->
<div v-if="mainActiveTab === 'antigravity'" class="tab-content antigravity-tab-content"
  :class="getTabAnimationClass('antigravity')">

  <!-- Antigravity 子标签栏 -->
  <div class="sec-tabs">
    <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'quotas' }"
      @click="switchAntigravityTab('quotas')">
      <i class="fas fa-chart-pie"></i> 额度使用
    </button>
    <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'accounts' }"
      @click="switchAntigravityTab('accounts')">
      <i class="fas fa-list"></i> 账号管理
    </button>
    <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'logs' }" @click="switchAntigravityTab('logs')">
      <i class="fas fa-history"></i> 调用日志
    </button>
    <button class="tab-btn" :class="{ active: antigravityCurrentTab === 'settings' }"
      @click="switchAntigravityTab('settings')">
      <i class="fas fa-cog"></i> 模块配置
    </button>
  </div>

  <!-- 账号管理列表 -->
  <!-- 凭证列表 (Accounts) -->
  <div v-show="antigravityCurrentTab === 'accounts'" class="sub-tab-content quick-fade-in">
    <div class="panel">
      <div class="panel-header">
        <div style="display: flex; gap: 8px;">
          <button class="btn btn-primary" @click="showOAuthExpand = !showOAuthExpand"
            style="background: linear-gradient(135deg, #4285F4, #34A853);">
            <i class="fab fa-google"></i> OAuth 授权
          </button>
          <button class="btn btn-success" @click="openAddAntigravityManualModal">
            <i class="fas fa-plus"></i> 手动添加
          </button>
          <button class="btn btn-secondary" @click="refreshAllAgAccounts" title="刷新全部凭证">
            <i class="fas fa-sync-alt" :class="{ 'fa-spin': agRefreshingAll }"></i>
          </button>
        </div>
      </div>

      <!-- Expandable OAuth Panel -->
      <div class="ag-expandable-panel" :class="{ expanded: showOAuthExpand }">
        <div class="panel-header" style="border-bottom: none; padding-bottom: 0;">
          <div class="panel-title" style="width: 100%; text-align: center; padding-top: 10px;"><i class="fab fa-google"
              style="margin-right: 8px; color: var(--ag-primary);"></i>连接 Google 账号
          </div>
        </div>

        <div class="oauth-modern-body">
          <!-- Step 1 -->
          <div class="oauth-step-item">
            <div class="step-badge">1</div>
            <div class="step-content">
              <div class="step-text">登录 Google 以获取授权码</div>
              <button class="btn btn-ag btn-block" @click="openGoogleAuthUrl">
                <i class="fab fa-google"></i> 获取授权链接
              </button>
            </div>
          </div>

          <!-- Divider -->
          <div class="oauth-step-line"></div>

          <!-- Step 2 -->
          <div class="oauth-step-item">
            <div class="step-badge">2</div>
            <div class="step-content">
              <div class="step-text">在下方粘贴重定向后的 URL</div>
              <textarea v-model="agOauthUrl" class="form-textarea oauth-textarea" placeholder="粘贴以 http:// 开头的完整 URL..."
                spellcheck="false"></textarea>
            </div>
          </div>

          <!-- Options -->
          <div class="oauth-options">
            <div class="oauth-option-row">
              <input type="text" v-model="agCustomProjectId" class="form-input input-sm" placeholder="自定义项目 ID (可选)">
              <div style="display: flex; align-items: center; gap: 8px;">
                <label class="switch">
                  <input type="checkbox" v-model="agAllowRandomProjectId">
                  <span class="slider round"></span>
                </label>
                <span style="font-size: 12px; color: var(--text-secondary);">允许随机 ID</span>
              </div>
            </div>
          </div>

          <!-- Action -->
          <button class="btn btn-success btn-block btn-lg mt-3" @click="parseAgOauthUrl"
            :disabled="!agOauthUrl || antigravityLoading">
            <i class="fas" :class="antigravityLoading ? 'fa-spinner fa-spin' : 'fa-link'"></i>
            {{ antigravityLoading ? '验证中...' : '验证并连接' }}
          </button>
        </div>
      </div>

      <!-- 统计信息栏 -->
      <div v-if="antigravityStats" class="stats-bar"
        style="display: none; gap: 20px; padding: 12px 16px; background: var(--bg-secondary); margin-bottom: 2px; border-radius: 8px; font-size: 13px;">
        <div class="stat-item">
          <span style="opacity: 0.7;">总 Token:</span>
          <strong style="margin-left: 4px;">{{ antigravityStats.total || 0 }}</strong>
        </div>
        <div class="stat-item">
          <span style="opacity: 0.7;">在线:</span>
          <strong style="margin-left: 4px; color: var(--success-color);">{{ antigravityStats.online || 0
            }}</strong>
        </div>
        <div class="stat-item">
          <span style="opacity: 0.7;">无效:</span>
          <strong style="margin-left: 4px; color: var(--danger-color);">{{ antigravityStats.disabled || 0
            }}</strong>
        </div>
      </div>


      <div v-if="antigravityLoading && antigravityAccounts.length === 0" class="loading">
        <div class="spinner"></div>
        <div style="margin-top: 12px;">加载中...</div>
      </div>

      <div v-else class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>备注名称</th>
              <th>项目 ID</th>
              <th>邮箱</th>
              <th class="text-center">调用统计</th>
              <th class="text-center">状态</th>
              <th class="text-center">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="account in antigravityAccounts" :key="account.id">
              <td><strong>{{ account.name || '未命名' }}</strong></td>
              <td><code class="code-sm">{{ account.projectId || '-' }}</code></td>
              <td><span style="font-size: 11px; opacity: 0.7;">{{ account.email || '-' }}</span></td>
              <td class="text-center">
                <div class="flex-cell">
                  <span style="color: var(--success-color); font-weight: 700; font-size: 13px;">{{
                    account.success_count || 0 }}</span>
                  <div style="width: 1px; height: 12px; background: var(--border-color); opacity: 0.5;">
                  </div>
                  <span style="color: var(--danger-color); font-weight: 700; font-size: 13px;">{{
                    account.error_count || 0 }}</span>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <span class="ag-status-badge"
                    :class="account.status === 'online' ? 'ag-status-online' : (account.status === 'error' ? 'ag-status-error' : 'ag-status-unknown')">
                    {{ account.status === 'online' ? '在线' : (account.status === 'error' ? '异常' : '未知') }}
                  </span>
                </div>
              </td>
              <td class="actions text-center">
                <div class="flex-cell">
                  <button class="btn btn-icon-refined"
                    :style="{ color: account.enable ? 'var(--success-color)' : 'var(--text-tertiary)' }"
                    @click="toggleAntigravityAccount(account)" :title="account.enable ? '停用账号' : '启用账号'">
                    <i class="fas" :class="account.enable ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
                  </button>
                  <button class="btn btn-icon-refined" @click="editAntigravityAccount(account)" title="编辑配置">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-icon-refined" @click="deleteAntigravityAccount(account)" title="删除授权"
                    style="color: var(--danger-color);">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div v-if="antigravityAccounts.length === 0" class="empty-state">
          <i class="fas fa-atom" style="font-size: 48px; margin-bottom: 16px;"></i>
          <div>暂无账号，点击上方按钮新增授权</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 凭证用量 (Usage/Quotas) -->
  <div v-show="antigravityCurrentTab === 'quotas'" class="sub-tab-content quick-fade-in">
    <div class="panel-header" style="justify-content: space-between; padding-bottom: 10px;">
      <div style="display: flex; gap: 16px; align-items: center;">
        <div class="panel-title"><i class="fas fa-chart-pie"
            style="margin-right: 8px; color: var(--ag-primary);"></i>额度状态</div>
        <select class="ag-account-selector select-sm-adaptive" v-model="antigravityQuotaSelectedAccountId"
          @change="loadAntigravityQuotas()" style="padding-left: 8px; width: 180px;">
          <option v-for="acc in antigravityAccounts.filter(a => a.enable !== false && a.enable !== 0)" :key="acc.id"
            :value="acc.id">
            {{ acc.name }} ({{ acc.status === 'online' ? '在线' : '离线' }})
          </option>
        </select>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-secondary btn-sm" @click="toggleAntigravityQuotaView()" title="切换视图">
          <i class="fas" :class="antigravityQuotaViewMode === 'list' ? 'fa-th-large' : 'fa-list'"></i>
          {{ antigravityQuotaViewMode === 'list' ? '分组视图' : '列表视图' }}
        </button>
        <button class="btn btn-secondary btn-sm" @click="loadAntigravityQuotas(false)"
          :disabled="antigravityQuotaLoading">
          <i class="fas fa-sync-alt" :class="{ 'fa-spin': antigravityQuotaLoading }"></i> 刷新额度
        </button>
      </div>
    </div>

    <div v-if="antigravityQuotaLoading && Object.keys(antigravityQuotas).length === 0" class="loading">
      <div class="spinner"></div>
      <div style="margin-top: 12px;">正在获取额度详情...</div>
    </div>

    <div v-else>
      <!-- 分组视图 (Cards) -->
      <div v-if="antigravityQuotaViewMode === 'grouped'" class="ag-quota-grid quick-fade-in">
        <div v-for="(group, groupId) in antigravityQuotas" :key="groupId" class="quota-card">
          <div class="panel-header"
            style="background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); padding: 8px 12px;">
            <div class="panel-title" style="font-size: 14px; gap: 8px;">
              <span style="font-size: 18px;">{{ group.icon }}</span>
              <span>{{ group.name }}</span>
            </div>
            <div v-if="group.remaining !== undefined" class="ag-status-badge"
              :style="{ color: getAgQuotaColor(group.remaining), borderColor: getAgQuotaColor(group.remaining) }">
              {{ group.remaining }}%
            </div>
          </div>
          <div style="padding: 12px;">
            <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 10px;">{{
              group.description
              }}</div>

            <!-- 主进度条 (如果是分组) -->
            <div v-if="group.remaining !== undefined" class="quota-progress-container" style="margin-bottom: 12px;">
              <div class="progress-bar-compact" style="height: 10px;">
                <div class="progress-bar-fill"
                  :style="{ width: group.remaining + '%', background: getAgQuotaColor(group.remaining) }">
                </div>
              </div>
            </div>

            <!-- 重置时间 -->
            <div v-if="group.resetTime"
              style="font-size: 11px; color: var(--text-secondary); margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
              <i class="far fa-clock"></i>
              <span>重置: {{ group.resetTime }} <span style="opacity: 0.8;">({{
                  formatResetCountdown(group.resetTime)
                  }})</span></span>
            </div>

            <!-- 细分模型列表 (可选展开，或直接紧凑列出) -->
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <div v-for="model in group.models" :key="model.id"
                style="display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; background: var(--bg-tertiary); border-radius: 6px; font-size: 12px;">
                <div style="display: flex; align-items: center; gap: 6px; flex: 1; min-width: 0;">
                  <span
                    style="font-family: var(--font-mono); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                    :title="model.id">{{ model.id }}</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                  <span :style="{ color: getAgQuotaColor(model.remaining) }" style="font-weight: 600;">{{
                    model.remaining }}%</span>
                  <label class="switch">
                    <input type="checkbox" :checked="model.enabled !== false"
                      @change="toggleModelStatus(model, $event)">
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 列表视图 (Table) -->
      <div v-else class="ag-quota-list-view quick-fade-in">
        <div class="panel">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th style="width: 250px;">模型 ID</th>
                  <th>分组</th>
                  <th>剩余额度</th>
                  <th style="width: 180px; text-align: center;">重置时间</th>
                  <th style="width: 80px; text-align: center;">开关</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="model in getAllAntigravityModels()" :key="model.id"
                  :style="{ opacity: model.enabled === false ? 0.5 : 1, filter: model.enabled === false ? 'grayscale(100%)' : 'none', background: model.enabled === false ? 'var(--bg-tertiary)' : 'inherit' }">
                  <td style="font-family: var(--font-mono); font-weight: 600;">{{ model.id }}</td>
                  <td>{{ model.groupIcon }} {{ model.groupName }}</td>
                  <td>
                    <div class="quota-progress-container" style="width: 100%;">
                      <div class="progress-bar-compact">
                        <div class="progress-bar-fill"
                          :style="{ width: model.remaining + '%', background: getAgQuotaColor(model.remaining) }">
                        </div>
                      </div>
                      <span class="quota-percent" style="margin-left: 10px; width: 40px; text-align: right;"
                        :style="{ color: getAgQuotaColor(model.remaining) }">{{ model.remaining }}%</span>
                    </div>
                  </td>
                  <td style="text-align: center; font-size: 12px;">
                    {{ model.resetTime }} <span style="opacity: 0.7; font-size: 0.9em;">({{
                      formatResetCountdown(model.resetTime) }})</span>
                  </td>
                  <td style="text-align: center;">
                    <label class="switch">
                      <input type="checkbox" :checked="model.enabled !== false"
                        @change="toggleModelStatus(model, $event)">
                      <span class="slider round"></span>
                    </label>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 调用日志 (Logs) -->
  <div v-show="antigravityCurrentTab === 'logs'" class="sub-tab-content quick-fade-in">
    <div class="panel">
      <div class="panel-header log-header-adaptive" style="border-bottom: 1px solid var(--border-color);">
        <div class="panel-title-group">
          <div class="panel-title"><i class="fas fa-history"
              style="margin-right: 8px; color: var(--ag-primary);"></i>调用日志</div>
        </div>
        <div class="panel-actions-group">
          <select v-model="antigravityLogFilterAccount" class="form-input select-sm-adaptive">
            <option value="">全部账号</option>
            <option v-for="acc in antigravityAccounts.filter(a => a.enable !== false && a.enable !== 0)" :key="acc.id"
              :value="acc.id">
              {{ acc.name || acc.id }}
            </option>
          </select>
          <select v-model="antigravityLogFilterModel" class="form-input select-sm-adaptive">
            <option value="">全部模型</option>
            <option v-for="model in getAntigravityLogModels()" :key="model" :value="model">{{ model }}</option>
          </select>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary btn-sm" @click="loadAntigravityLogs" :disabled="antigravityLoading"
              title="刷新">
              <i class="fas fa-sync-alt" :class="{ 'fa-spin': antigravityLoading }"></i>
            </button>
            <button class="btn btn-danger btn-sm" @click="clearAntigravityLogs" title="清空">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th style="width: 160px;" class="text-center">时间</th>
              <th>账号备注</th>
              <th class="text-center">模型</th>
              <th>路径</th>
              <th class="text-center">状态</th>
              <th class="text-center">耗时</th>
              <th class="text-center" style="width: 80px;">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="log in getFilteredAntigravityLogs()" :key="log.id">
              <td class="text-center">
                <div class="flex-cell">
                  <div class="log-time">
                    <i class="far fa-clock" style="margin-right: 4px; opacity: 0.5;"></i>
                    {{ formatDateTime(log.timestamp) }}
                  </div>
                </div>
              </td>
              <td>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <i class="fas fa-id-card" style="font-size: 12px; color: var(--ag-primary); opacity: 0.7;"></i>
                  <strong>{{ log.accountName || 'System' }}</strong>
                  <span v-if="log.isBalanced" class="badge-lb" style="margin-left: 4px;" title="经过全局负载均衡分发">LB</span>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <code class="code-sm">{{ log.model || '-' }}</code>
                </div>
              </td>
              <td>
                <div style="display: flex; align-items: center;">
                  <span class="method-badge" :class="'method-' + (log.method || 'POST').toLowerCase()">
                    {{ log.method || 'POST' }}
                  </span>
                  <span class="log-path" :title="log.path">{{ log.path }}</span>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <span :class="getGcliStatusClass(log.statusCode)" class="ag-status-badge">
                    {{ log.statusCode }}
                  </span>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <span class="log-duration">{{ log.durationMs }}ms</span>
                </div>
              </td>
              <td class="actions text-center">
                <div class="flex-cell">
                  <button class="btn btn-icon-refined" @click="viewAntigravityLogDetail(log)" title="查看详情">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr v-if="getFilteredAntigravityLogs().length === 0">
              <td colspan="7" style="text-align: center; padding: 60px; color: var(--text-tertiary);">
                <i class="fas fa-inbox" style="font-size: 40px; display: block; margin-bottom: 12px; opacity: 0.3;"></i>
                暂无调用日志
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 模块设置 (Settings) -->
  <div v-show="antigravityCurrentTab === 'settings'" class="sub-tab-content quick-fade-in">
    <div class="panel">
      <div class="panel-header" style="border-bottom: 1px solid var(--border-color);">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
          <div class="panel-title-group">
            <div class="panel-title"><i class="fas fa-cogs"
                style="margin-right: 8px; color: var(--ag-primary);"></i>Antigravity API 参数配置</div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary btn-sm" @click="loadAntigravitySettings" :disabled="antigravityLoading">
              <i class="fas fa-sync-alt" :class="{ 'fa-spin': antigravityLoading }"></i> 刷新
            </button>
            <button class="btn btn-primary btn-sm" @click="saveAllAgSettings" :disabled="antigravitySaving">
              <i class="fas" :class="antigravitySaving ? 'fa-spinner fa-spin' : 'fa-save'"></i> 保存全部
            </button>
          </div>
        </div>
      </div>

      <div style="padding: 10px 3px 3px 3px;">
        <!-- 生成参数 -->
        <div style="margin-bottom: 20px;">
          <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--ag-primary);">
            <i class="fas fa-sliders-h"></i> 生成参数
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
            <div>
              <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认温度</label>
              <input type="number" step="0.1" min="0" max="2" v-model="agSettingsForm.DEFAULT_TEMPERATURE"
                class="form-input" style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="1">
            </div>
            <div>
              <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认
                top_p</label>
              <input type="number" step="0.01" min="0" max="1" v-model="agSettingsForm.DEFAULT_TOP_P" class="form-input"
                style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="0.85">
            </div>
            <div>
              <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认
                top_k</label>
              <input type="number" step="1" min="1" v-model="agSettingsForm.DEFAULT_TOP_K" class="form-input"
                style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="50">
            </div>
            <div>
              <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">默认最大
                Tokens</label>
              <input type="number" step="1" min="1" v-model="agSettingsForm.DEFAULT_MAX_TOKENS" class="form-input"
                style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="8096">
            </div>
          </div>
        </div>

        <!-- 模型重定向 -->
        <div style="margin-bottom: 24px;">
          <div
            style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--ag-primary); display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-exchange-alt"></i> 模型重定向 (别名)
          </div>
          <!-- 列表 -->
          <div v-if="antigravityModelRedirects.length > 0"
            style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
            <div v-for="r in antigravityModelRedirects" :key="r.source_model"
              style="background: var(--bg-tertiary); padding: 10px 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color); transition: all 0.2s;"
              :style="agEditingRedirectSource === r.source_model ? 'border-color: var(--ag-primary); box-shadow: 0 0 0 2px rgba(var(--ag-primary-rgb), 0.1);' : ''">

              <div v-if="agEditingRedirectSource !== r.source_model"
                style="display: flex; align-items: center; gap: 10px; flex: 1;" @dblclick="editModelRedirect(r)">
                <div
                  style="background: rgba(var(--ag-primary-rgb), 0.1); color: var(--ag-primary); padding: 2px 8px; border-radius: 4px; font-weight: 600; font-size: 12px;">
                  {{ r.source_model }}</div>
                <i class="fas fa-long-arrow-alt-right" style="opacity: 0.3;"></i>
                <div style="font-size: 13px; color: var(--text-primary);">{{ r.target_model }}</div>
              </div>

              <div v-else style="display: flex; align-items: center; gap: 10px; flex: 1;">
                <input type="text" v-model="newRedirectSource" class="form-input-sm" style="flex: 1; min-width: 0;"
                  placeholder="源模型">
                <i class="fas fa-long-arrow-alt-right" style="opacity: 0.3;"></i>
                <input type="text" v-model="newRedirectTarget" class="form-input-sm" style="flex: 1; min-width: 0;"
                  placeholder="目标模型">
              </div>

              <div style="display: flex; gap: 6px; margin-left: 15px;">
                <template v-if="agEditingRedirectSource === r.source_model">
                  <button class="btn btn-xs btn-success icon-only"
                    @click="addModelRedirect(newRedirectSource, newRedirectTarget)" title="保存">
                    <i class="fas fa-check"></i>
                  </button>
                  <button class="btn btn-xs btn-secondary icon-only"
                    @click="agEditingRedirectSource = null; newRedirectSource = ''; newRedirectTarget = '';" title="取消">
                    <i class="fas fa-times"></i>
                  </button>
                </template>
                <template v-else>
                  <button class="btn btn-xs btn-primary icon-only" @click="editModelRedirect(r)" title="编辑">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="btn btn-xs btn-danger icon-only" @click="removeModelRedirect(r.source_model)"
                    title="删除">
                    <i class="fas fa-trash"></i>
                  </button>
                </template>
              </div>
            </div>
          </div>
          <div v-else
            style="font-size: 12px; opacity: 0.5; margin-bottom: 16px; padding: 10px; background: var(--bg-secondary); border-radius: 8px; text-align: center; border: 1px dashed var(--border-color);">
            暂无重定向规则。添加后，请求 source 模型将自动转发给 target 模型。
          </div>

          <!-- 添加表单 -->
          <div v-if="!agEditingRedirectSource"
            style="display: flex; gap: 10px; align-items: center; background: rgba(var(--ag-primary-rgb), 0.03); padding: 12px; border-radius: 10px; border: 1px dashed var(--border-color);">
            <div style="flex: 1; position: relative;">
              <input type="text" v-model="newRedirectSource" class="form-input"
                style="width: 100%; padding: 8px 12px; font-size: 13px;" placeholder="源模型 (例如: gpt-4o)">
            </div>
            <i class="fas fa-arrow-right" style="opacity: 0.3;"></i>
            <div style="flex: 1; position: relative;">
              <input type="text" v-model="newRedirectTarget" class="form-input"
                style="width: 100%; padding: 8px 12px; font-size: 13px;" placeholder="目标模型 (例如: gemini-1.5-pro)">
            </div>
            <button class="btn btn-secondary btn-sm"
              style="padding: 0 20px; font-size: 13px; height: 38px; display: flex; align-items: center; gap: 6px; white-space: nowrap;"
              @click="addModelRedirect(newRedirectSource, newRedirectTarget).then(s => { if(s) { newRedirectSource=''; newRedirectTarget=''; } })">
              <i class="fas fa-plus-circle"></i> 添加别名
            </button>
          </div>
        </div>

        <!-- 图片设置 + 限额 -->
        <div
          style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 0px;">
          <div>
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--ag-primary);">
              <i class="fas fa-image"></i> 图片设置
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
              <div>
                <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">保存上限</label>
                <input type="number" min="1" v-model="agSettingsForm.MAX_IMAGES" class="form-input"
                  style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="10">
              </div>
              <div>
                <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">访问基础
                  URL</label>
                <input type="text" v-model="agSettingsForm.IMAGE_BASE_URL" class="form-input"
                  style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="留空使用默认">
              </div>
            </div>
          </div>
          <div>
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--ag-primary);">
              <i class="fas fa-tachometer-alt"></i> 限额设置
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
              <div>
                <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">每小时上限</label>
                <input type="number" v-model="agSettingsForm.CREDENTIAL_MAX_USAGE_PER_HOUR" class="form-input"
                  style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="20">
              </div>
              <div>
                <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">超时
                  (ms)</label>
                <input type="number" v-model="agSettingsForm.TIMEOUT" class="form-input"
                  style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="120000">
              </div>
              <div>
                <label style="font-size: 11px; opacity: 0.7; display: block; margin-bottom: 7px;">日志保留天数</label>
                <input type="number" v-model="agSettingsForm.REQUEST_LOG_RETENTION_DAYS" class="form-input"
                  style="width: 100%; padding: 6px 10px; font-size: 13px;" placeholder="7">
              </div>
            </div>
          </div>
        </div>


      </div>
    </div>
  </div>
</div>
</div>