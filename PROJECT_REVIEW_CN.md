# API Monitor 项目审查与优化建议报告

## 1. 项目概览
API Monitor 是一个集成度极高的多功能监控仪表板，涵盖了从云平台 (Zeabur) 到基础设施 (SSH 终端) 的全方位监控与管理。

### 当前技术栈
- **后端**: Node.js, Express, WebSocket, SQLite (`better-sqlite3`)
- **前端**: Vue 3 (CDN 加载), Vanilla CSS
- **部署**: Docker, Docker Compose

---

## 2. 现有亮点
1. **模块化解耦**: 后端逻辑按模块（modules）划分，路由动态加载，结构清晰。
2. **安全性意识**: 数据库中的敏感字段（如 SSH 密码、私钥）均已进行 AES 加密存储。
3. **功能完备性**: 集成了日志管理、自动状态探测、SSH Web 终端、API 转发（Antigravity）等实用功能。
4. **日志策略**: 已实现基于天数、数量和磁盘大小的自动化日志清理机制。

---

## 3. 需优化的地方

### 3.1 前端架构 (高优先级)
- **单体文件瓶颈**: `index.html` (3000+ 行) 和 `main.js` (2600+ 行) 极度臃肿，维护难度呈几何级数增长。
  - **建议**: 将 Vue 根实例代码按业务模块（如 `auth.js`, `server.js`, `zeabur.js`）进行逻辑拆分。
- **状态管理**: 所有的状态都耦合在单一的 Vue `data` 对象中。
  - **建议**: 使用简单的响应式对象（Vue.reactive）或者微型 Store 模式来管理各模块的状态。
- **缺少构建流程**: 缺乏代码压缩、Tree-shaking 和现代 JS 语法转译。
  - **建议**: 引入 Vite。Vite 对于此类单页应用（SPA）极其友好，且几乎不需要复杂配置即可实现模块化开发。

### 3.2 UI/UX 体验
- **色彩管理**: 虽然已实现主题换色，但 CSS 变量的覆盖粒度仍需细化，防止某些模块的主题色在切换时出现“残余”。
- **加载反馈**: 部分长任务（如 SSH 扫描、API 多账号同步）缺乏平滑的骨架屏（Skeleton Screen）反馈。
- **响应式布局**: 在超小屏幕设备上，部分数据表格和卡片布局可能出现重叠。

### 3.3 数据库与性能
- **并发性能**: SQLite 在多写场景下可能出现锁竞争。
  - **建议**: 确保全面开启 WAL (Write-Ahead Logging) 模式。
- **重复请求**: 前端数据轮询在标签页后台挂起时依然在全速运行。
  - **建议**: 引入 `Intersection Observer API` 或 `visibilitychange` 事件，在页面不可见时调低轮询频率。

### 3.4 安全性进一步增强
- **CSRF 风险**: 目前对跨站请求伪造的防护较弱。
  - **建议**: 为所有 POST/PUT 操作引入 CSRF Token。
- **登录增强**: 目前仅有简单的密码校验，可考虑增加可选的 TOTP (2FA) 以增强安全性。

---

## 4. 建议的优化实施路线图

### 第一阶段：降低代码熵 (短期)
- **4.1.1 逻辑剥离**: 将 `main.js` 中复杂的 methods 移动到 `public/js/modules/` 下的独立 JS 文件中，主文件仅做初始化。
- **4.2.1 样式优化**: 将 `index.html` 中的内联样式彻底抽离到 CSS 文件或 `<style>` 变量中。

### 第二阶段：工程化升级 (中期)
- **4.2.1 引入 Vite**: 搭建基础的 Vite 环境，将 `.js` 逻辑转移为 `.vue` 或模块化 `.js`。
- **4.2.2 强化稳定性**: 增加 Backend 核心逻辑的单元测试，尤其是针对加密和 SSH 连接的部分。

### 第三阶段：体验极致化 (长期)
- **4.3.1 智能化监控**: 根据历史响应时间自动调整主机的监控频率，减少服务器开销。
- **4.3.2 移动端 PWA**: 支持 PWA，方便在手机上快速查看服务器状态。

---

**审查人**: Antigravity AI
**日期**: 2025-12-18
