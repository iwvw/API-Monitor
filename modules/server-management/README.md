# æœåŠ¡å™¨ç®¡ç†æ¨¡å—

## æ¦‚è¿°

æœåŠ¡å™¨ç®¡ç†æ¨¡å—æ˜¯ API Monitor çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œæä¾›å®Œæ•´çš„æœåŠ¡å™¨ç›‘æ§ã€ç®¡ç†å’Œæ“ä½œåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½

#### 1. æ•°æ®åº“å’Œæ¨¡å‹å±‚
- âœ… æœåŠ¡å™¨è´¦å·ç®¡ç†ï¼ˆæ”¯æŒå¯†ç å’Œå¯†é’¥è®¤è¯ï¼‰
- âœ… ç›‘æ§æ—¥å¿—è®°å½•
- âœ… ç›‘æ§é…ç½®ç®¡ç†
- âœ… AES-256-GCM åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯

#### 2. åç«¯æ ¸å¿ƒæœåŠ¡
- âœ… SSH è¿æ¥æœåŠ¡ï¼ˆè¿æ¥æ± ã€ä¼šè¯ç®¡ç†ï¼‰
- âœ… SFTP æ–‡ä»¶ç®¡ç†æœåŠ¡
- âœ… å®šæ—¶ç›‘æ§æœåŠ¡ï¼ˆåŸºäº node-cronï¼‰
- âœ… ç³»ç»Ÿä¿¡æ¯é‡‡é›†æœåŠ¡

#### 3. API æ¥å£
- âœ… æœåŠ¡å™¨ CRUD æ“ä½œ
- âœ… æ‰¹é‡å¯¼å…¥/å¯¼å‡º
- âœ… è¿æ¥æµ‹è¯•
- âœ… æ‰‹åŠ¨æ¢æµ‹
- âœ… æœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯è·å–
- âœ… æœåŠ¡å™¨æ“ä½œï¼ˆé‡å¯/å…³æœºï¼‰
- âœ… SSH å‘½ä»¤æ‰§è¡Œ
- âœ… SFTP æ–‡ä»¶æ“ä½œ
- âœ… ç›‘æ§é…ç½®ç®¡ç†
- âœ… ç›‘æ§æ—¥å¿—æŸ¥è¯¢

#### 4. å‰ç«¯ç•Œé¢
- âœ… æœåŠ¡å™¨åˆ—è¡¨å±•ç¤º
- âœ… æœåŠ¡å™¨çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆåœ¨çº¿/ç¦»çº¿/æœªçŸ¥ï¼‰
- âœ… å±•å¼€/æ”¶èµ·è¯¦ç»†ä¿¡æ¯
- âœ… ç³»ç»Ÿä¿¡æ¯å±•ç¤ºï¼ˆOSã€CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€Dockerï¼‰
- âœ… æœåŠ¡å™¨æ“ä½œæŒ‰é’®ï¼ˆåˆ·æ–°ã€é‡å¯ã€å…³æœºï¼‰
- âœ… æ‰¹é‡å¯¼å‡ºåŠŸèƒ½

#### 5. å‰ç«¯å¯¹è¯æ¡†å’Œæ¨¡æ€æ¡†
- âœ… æ·»åŠ æœåŠ¡å™¨å¯¹è¯æ¡†ï¼ˆæ”¯æŒå¯†ç å’Œå¯†é’¥è®¤è¯ï¼‰
- âœ… ç¼–è¾‘æœåŠ¡å™¨å¯¹è¯æ¡†
- âœ… æ‰¹é‡å¯¼å…¥æœåŠ¡å™¨å¯¹è¯æ¡†ï¼ˆJSON æ–‡ä»¶ï¼‰
- âœ… Docker å®¹å™¨è¯¦æƒ…æ¨¡æ€æ¡†

#### 6. åå°ç®¡ç†é¡µé¢
- âœ… ç›‘æ§é…ç½®ç•Œé¢ï¼ˆæ¢æµ‹é—´éš”ã€è¶…æ—¶ã€æ—¥å¿—ä¿ç•™ï¼‰
- âœ… æ¢æµ‹æ—¥å¿—ç•Œé¢ï¼ˆç­›é€‰ã€åˆ†é¡µï¼‰
- âœ… æœåŠ¡å™¨åˆ—è¡¨ç­›é€‰

#### 7. SSH ç»ˆç«¯åŠŸèƒ½
- âœ… SSH ç»ˆç«¯ç•Œé¢ï¼ˆåŸºäº xterm.jsï¼‰
- âœ… å¤šç»ˆç«¯æ ‡ç­¾é¡µï¼ˆåŒæ—¶æ‰“å¼€å¤šä¸ª SSH ä¼šè¯ï¼‰
- âœ… å‘½ä»¤å†å²è®°å½•ï¼ˆä¸Šä¸‹ç®­å¤´å¯¼èˆªï¼‰
- âœ… å¿«æ·é”®æ”¯æŒï¼ˆCtrl+Cï¼‰

#### 8. SFTP æ–‡ä»¶ç®¡ç†åŠŸèƒ½
- âœ… SFTP æ–‡ä»¶ç®¡ç†ç•Œé¢
- âœ… ç›®å½•æµè§ˆå’Œå¯¼èˆª
- âœ… åˆ›å»º/åˆ é™¤/é‡å‘½åæ–‡ä»¶å’Œç›®å½•
- â³ æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿›åº¦æ˜¾ç¤ºï¼ˆå¼€å‘ä¸­ï¼‰

### ğŸš§ å¾…å®ç°åŠŸèƒ½

#### 1. é«˜çº§åŠŸèƒ½
- â³ Docker å®¹å™¨æ“ä½œï¼ˆå¯åŠ¨/åœæ­¢/é‡å¯ï¼‰
- â³ æœåŠ¡å™¨åˆ†ç»„ç®¡ç†
- â³ ç›‘æ§å‘Šè­¦åŠŸèƒ½
- â³ æ€§èƒ½ç›‘æ§å›¾è¡¨

## æŠ€æœ¯æ ˆ

### åç«¯
- **SSH è¿æ¥**: ssh2
- **SFTP æ–‡ä»¶ç®¡ç†**: ssh2-sftp-client
- **å®šæ—¶ä»»åŠ¡**: node-cron
- **åŠ å¯†**: Node.js crypto (AES-256-GCM)
- **æ•°æ®åº“**: SQLite (better-sqlite3)

### å‰ç«¯
- **ç»ˆç«¯æ¨¡æ‹Ÿå™¨**: xterm.js (å¾…é›†æˆ)
- **UI æ¡†æ¶**: Vue 3
- **æ ·å¼**: è‡ªå®šä¹‰ CSS

## æ•°æ®åº“è¡¨ç»“æ„

### 1. server_accounts
æœåŠ¡å™¨è´¦å·ä¿¡æ¯è¡¨ï¼Œå­˜å‚¨æœåŠ¡å™¨è¿æ¥é…ç½®ã€‚

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | TEXT | ä¸»é”® |
| name | TEXT | æœåŠ¡å™¨åç§° |
| host | TEXT | æœåŠ¡å™¨åœ°å€ |
| port | INTEGER | SSH ç«¯å£ï¼ˆé»˜è®¤ 22ï¼‰ |
| username | TEXT | ç”¨æˆ·å |
| auth_type | TEXT | è®¤è¯æ–¹å¼ï¼ˆpassword/keyï¼‰ |
| password | TEXT | åŠ å¯†å­˜å‚¨çš„å¯†ç  |
| private_key | TEXT | åŠ å¯†å­˜å‚¨çš„ç§é’¥ |
| passphrase | TEXT | åŠ å¯†å­˜å‚¨çš„ç§é’¥å¯†ç  |
| status | TEXT | æœåŠ¡å™¨çŠ¶æ€ï¼ˆonline/offline/unknownï¼‰ |
| last_check_time | DATETIME | æœ€åæ¢æµ‹æ—¶é—´ |
| response_time | INTEGER | å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| tags | TEXT | æ ‡ç­¾ï¼ˆJSON æ•°ç»„ï¼‰ |
| description | TEXT | æè¿° |

### 2. server_monitor_logs
ç›‘æ§æ—¥å¿—è¡¨ï¼Œè®°å½•æ¯æ¬¡æ¢æµ‹ç»“æœã€‚

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼ˆè‡ªå¢ï¼‰ |
| server_id | TEXT | æœåŠ¡å™¨ ID |
| status | TEXT | æ¢æµ‹çŠ¶æ€ï¼ˆsuccess/failedï¼‰ |
| response_time | INTEGER | å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| error_message | TEXT | é”™è¯¯ä¿¡æ¯ |
| checked_at | DATETIME | æ¢æµ‹æ—¶é—´ |

### 3. server_monitor_config
ç›‘æ§é…ç½®è¡¨ï¼Œå•ä¾‹æ¨¡å¼ã€‚

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼ˆå›ºå®šä¸º 1ï¼‰ |
| probe_interval | INTEGER | æ¢æµ‹é—´éš”ï¼ˆç§’ï¼Œé»˜è®¤ 60ï¼‰ |
| probe_timeout | INTEGER | æ¢æµ‹è¶…æ—¶ï¼ˆç§’ï¼Œé»˜è®¤ 10ï¼‰ |
| log_retention_days | INTEGER | æ—¥å¿—ä¿ç•™å¤©æ•°ï¼ˆé»˜è®¤ 7ï¼‰ |
| max_connections | INTEGER | æœ€å¤§è¿æ¥æ•°ï¼ˆé»˜è®¤ 10ï¼‰ |
| session_timeout | INTEGER | ä¼šè¯è¶…æ—¶ï¼ˆç§’ï¼Œé»˜è®¤ 1800ï¼‰ |
| auto_start | INTEGER | æ˜¯å¦è‡ªåŠ¨å¯åŠ¨ç›‘æ§ï¼ˆé»˜è®¤ 1ï¼‰ |

## API æ¥å£

### æœåŠ¡å™¨ç®¡ç†

#### è·å–æ‰€æœ‰æœåŠ¡å™¨
```
GET /api/server/accounts
```

#### æ·»åŠ æœåŠ¡å™¨
```
POST /api/server/accounts
Body: {
  name: string,
  host: string,
  port: number,
  username: string,
  auth_type: 'password' | 'key',
  password?: string,
  private_key?: string,
  passphrase?: string,
  tags?: string[],
  description?: string
}
```

#### æ›´æ–°æœåŠ¡å™¨
```
PUT /api/server/accounts/:id
Body: { ...æ›´æ–°å­—æ®µ }
```

#### åˆ é™¤æœåŠ¡å™¨
```
DELETE /api/server/accounts/:id
```

#### æ‰¹é‡åˆ é™¤
```
POST /api/server/accounts/batch-delete
Body: { ids: string[] }
```

#### æ‰¹é‡å¯¼å…¥
```
POST /api/server/accounts/import
Body: { servers: Array<ServerConfig> }
```

#### æ‰¹é‡å¯¼å‡º
```
GET /api/server/accounts/export
```

### æœåŠ¡å™¨æ“ä½œ

#### æµ‹è¯•è¿æ¥
```
POST /api/server/test-connection
Body: { ...æœåŠ¡å™¨é…ç½® }
```

#### æ‰‹åŠ¨æ¢æµ‹æ‰€æœ‰æœåŠ¡å™¨
```
POST /api/server/check-all
```

#### è·å–æœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯
```
POST /api/server/info
Body: { serverId: string }
```

#### æœåŠ¡å™¨æ“ä½œï¼ˆé‡å¯/å…³æœºï¼‰
```
POST /api/server/action
Body: {
  serverId: string,
  action: 'reboot' | 'shutdown'
}
```

### SSH æ“ä½œ

#### æ‰§è¡Œå‘½ä»¤
```
POST /api/server/ssh/exec
Body: {
  serverId: string,
  command: string
}
```

#### å…³é—­è¿æ¥
```
POST /api/server/ssh/disconnect
Body: { serverId: string }
```

#### è·å–è¿æ¥æ± çŠ¶æ€
```
GET /api/server/ssh/status
```

### SFTP æ“ä½œ

#### åˆ—å‡ºç›®å½•
```
POST /api/server/sftp/list
Body: {
  serverId: string,
  path: string
}
```

#### ä¸Šä¼ æ–‡ä»¶
```
POST /api/server/sftp/upload
Body: {
  serverId: string,
  localPath: string,
  remotePath: string
}
```

#### ä¸‹è½½æ–‡ä»¶
```
POST /api/server/sftp/download
Body: {
  serverId: string,
  remotePath: string,
  localPath: string
}
```

#### åˆ é™¤æ–‡ä»¶/ç›®å½•
```
POST /api/server/sftp/delete
Body: {
  serverId: string,
  path: string,
  isDirectory: boolean
}
```

#### é‡å‘½å
```
POST /api/server/sftp/rename
Body: {
  serverId: string,
  oldPath: string,
  newPath: string
}
```

#### åˆ›å»ºç›®å½•
```
POST /api/server/sftp/mkdir
Body: {
  serverId: string,
  path: string,
  recursive: boolean
}
```

### ç›‘æ§ç®¡ç†

#### è·å–ç›‘æ§é…ç½®
```
GET /api/server/monitor/config
```

#### æ›´æ–°ç›‘æ§é…ç½®
```
PUT /api/server/monitor/config
Body: {
  probe_interval?: number,
  probe_timeout?: number,
  log_retention_days?: number,
  max_connections?: number,
  session_timeout?: number,
  auto_start?: number
}
```

#### è·å–ç›‘æ§æ—¥å¿—
```
GET /api/server/monitor/logs?serverId=xxx&status=xxx&limit=100&offset=0
```

#### è·å–ç›‘æ§æœåŠ¡çŠ¶æ€
```
GET /api/server/monitor/status
```

#### å¯åŠ¨ç›‘æ§æœåŠ¡
```
POST /api/server/monitor/start
```

#### åœæ­¢ç›‘æ§æœåŠ¡
```
POST /api/server/monitor/stop
```

## å®‰å…¨æªæ–½

1. **åŠ å¯†å­˜å‚¨**: ä½¿ç”¨ AES-256-GCM åŠ å¯†å­˜å‚¨å¯†ç å’Œç§é’¥
2. **ä¼šè¯ç®¡ç†**: SSH è¿æ¥è‡ªåŠ¨è¶…æ—¶æ–­å¼€ï¼ˆé»˜è®¤ 30 åˆ†é’Ÿï¼‰
3. **æƒé™æ§åˆ¶**: æ‰€æœ‰æ¥å£éœ€è¦ç™»å½•è®¤è¯
4. **æ“ä½œæ—¥å¿—**: è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ
5. **è¿æ¥æ± é™åˆ¶**: é™åˆ¶æœ€å¤§è¿æ¥æ•°ï¼Œé˜²æ­¢èµ„æºè€—å°½

## ç›‘æ§æœºåˆ¶

1. **å®šæ—¶æ¢æµ‹**: ä½¿ç”¨ node-cron å®ç°å®šæ—¶ä»»åŠ¡ï¼Œé»˜è®¤æ¯ 60 ç§’æ¢æµ‹ä¸€æ¬¡
2. **çŠ¶æ€æ›´æ–°**: å®æ—¶æ›´æ–°æœåŠ¡å™¨åœ¨çº¿/ç¦»çº¿çŠ¶æ€
3. **æ—¥å¿—è®°å½•**: è®°å½•æ¯æ¬¡æ¢æµ‹ç»“æœï¼ŒåŒ…æ‹¬å“åº”æ—¶é—´å’Œé”™è¯¯ä¿¡æ¯
4. **è‡ªåŠ¨æ¸…ç†**: å®šæ—¶æ¸…é™¤è¿‡æœŸæ—¥å¿—ï¼Œé»˜è®¤ä¿ç•™ 7 å¤©
5. **æ‰‹åŠ¨è§¦å‘**: æ”¯æŒæ‰‹åŠ¨è§¦å‘å…¨éƒ¨æœåŠ¡å™¨æ¢æµ‹

## å¼€å‘è¿›åº¦

- âœ… é˜¶æ®µä¸€ï¼šæ•°æ®åº“å’Œæ¨¡å‹å±‚ï¼ˆ100%ï¼‰
- âœ… é˜¶æ®µäºŒï¼šåç«¯æ ¸å¿ƒæœåŠ¡ï¼ˆ100%ï¼‰
- âœ… é˜¶æ®µä¸‰ï¼šåç«¯ API è·¯ç”±ï¼ˆ100%ï¼‰
- âœ… é˜¶æ®µå››ï¼šå‰ç«¯æœºå™¨åˆ—è¡¨é¡µé¢ï¼ˆ100%ï¼‰
  - âœ… æœåŠ¡å™¨åˆ—è¡¨å±•ç¤º
  - âœ… æ·»åŠ /ç¼–è¾‘æœåŠ¡å™¨å¯¹è¯æ¡†
  - âœ… æ‰¹é‡å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
  - âœ… Docker å®¹å™¨è¯¦æƒ…æŸ¥çœ‹
  - âœ… æœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯å±•ç¤º
  - âœ… æœåŠ¡å™¨æ“ä½œï¼ˆé‡å¯/å…³æœºï¼‰
- âœ… é˜¶æ®µäº”ï¼šå‰ç«¯åå°ç®¡ç†é¡µé¢ï¼ˆ100%ï¼‰
  - âœ… ç›‘æ§é…ç½®ç•Œé¢
  - âœ… æ¢æµ‹æ—¥å¿—ç•Œé¢
  - âœ… æœåŠ¡å™¨åˆ—è¡¨ç­›é€‰
- âœ… é˜¶æ®µå…­ï¼šå‰ç«¯ SSH ç»ˆç«¯é¡µé¢ï¼ˆ100%ï¼‰
  - âœ… xterm.js é›†æˆ
  - âœ… SSH ç»ˆç«¯äº¤äº’
  - âœ… å¤šç»ˆç«¯æ ‡ç­¾é¡µæ”¯æŒ
  - âœ… SFTP æ–‡ä»¶ç®¡ç†ç•Œé¢
- âœ… é˜¶æ®µä¸ƒï¼šç³»ç»Ÿé›†æˆå’Œæµ‹è¯•ï¼ˆ100%ï¼‰
  - âœ… æ¨¡å—æ³¨å†Œ
  - âœ… ç›‘æ§æœåŠ¡è‡ªåŠ¨å¯åŠ¨
- âœ… é˜¶æ®µå…«ï¼šç¼–å†™æ–‡æ¡£å’Œéƒ¨ç½²å‡†å¤‡ï¼ˆ100%ï¼‰

## ç¯å¢ƒå˜é‡

```env
# åŠ å¯†å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®ï¼‰
ENCRYPTION_KEY=your-32-byte-encryption-key
```

## ä½¿ç”¨ç¤ºä¾‹

### æ·»åŠ æœåŠ¡å™¨ï¼ˆå¯†ç è®¤è¯ï¼‰
```javascript
const response = await fetch('/api/server/accounts', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'ç”Ÿäº§æœåŠ¡å™¨',
    host: '192.168.1.100',
    port: 22,
    username: 'root',
    auth_type: 'password',
    password: 'your-password',
    tags: ['production', 'web'],
    description: 'ä¸»è¦çš„ Web æœåŠ¡å™¨'
  })
});
```

### æ·»åŠ æœåŠ¡å™¨ï¼ˆå¯†é’¥è®¤è¯ï¼‰
```javascript
const response = await fetch('/api/server/accounts', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'å¼€å‘æœåŠ¡å™¨',
    host: '192.168.1.101',
    port: 22,
    username: 'ubuntu',
    auth_type: 'key',
    private_key: '-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----',
    passphrase: 'key-passphrase',
    tags: ['development'],
    description: 'å¼€å‘ç¯å¢ƒæœåŠ¡å™¨'
  })
});
```

### æ‰§è¡Œ SSH å‘½ä»¤
```javascript
const response = await fetch('/api/server/ssh/exec', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    serverId: 'server-id',
    command: 'df -h'
  })
});

const result = await response.json();
console.log(result.stdout); // å‘½ä»¤è¾“å‡º
```

## æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒ**: åŠ¡å¿…è®¾ç½® `ENCRYPTION_KEY` ç¯å¢ƒå˜é‡
2. **SSH å¯†é’¥**: ç§é’¥å¿…é¡»æ˜¯ OpenSSH æ ¼å¼
3. **é˜²ç«å¢™**: ç¡®ä¿æœåŠ¡å™¨ SSH ç«¯å£å¯è®¿é—®
4. **æƒé™**: æŸäº›æ“ä½œï¼ˆå¦‚é‡å¯ã€å…³æœºï¼‰éœ€è¦ sudo æƒé™
5. **ç›‘æ§é¢‘ç‡**: æ ¹æ®æœåŠ¡å™¨æ•°é‡è°ƒæ•´æ¢æµ‹é—´éš”ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—èµ„æº

## æ•…éšœæ’æŸ¥

### è¿æ¥å¤±è´¥
1. æ£€æŸ¥æœåŠ¡å™¨åœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
3. æ£€æŸ¥ SSH æœåŠ¡æ˜¯å¦è¿è¡Œ
4. æ£€æŸ¥è®¤è¯ä¿¡æ¯æ˜¯å¦æ­£ç¡®

### ç›‘æ§ä¸å·¥ä½œ
1. æ£€æŸ¥ç›‘æ§æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`GET /api/server/monitor/status`
2. æ£€æŸ¥ç›‘æ§é…ç½®ï¼š`GET /api/server/monitor/config`
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

### åŠ å¯†é”™è¯¯
1. ç¡®ä¿ `ENCRYPTION_KEY` ç¯å¢ƒå˜é‡å·²è®¾ç½®
2. ä¸è¦æ›´æ”¹å·²æœ‰æ•°æ®çš„åŠ å¯†å¯†é’¥

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT
