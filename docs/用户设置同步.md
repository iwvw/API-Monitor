# 用户设置同步功能

## 功能说明

所有用户设置（包括自定义CSS、模块可见性、模块顺序）现在都会自动保存到服务器后端，实现跨设备同步。

## 保存的设置项

1. **自定义CSS** - 用户在设置中输入的自定义样式
2. **模块可见性** - 哪些模块（Zeabur、DNS、OpenAI）是显示还是隐藏
3. **模块顺序** - 模块在标签页中的显示顺序

## 存储位置

- **后端存储**: `data/user-settings.json`
- **本地缓存**: `localStorage`（向后兼容）

## 工作原理

### 加载设置
1. 应用启动时，从后端 `/api/settings` 加载设置
2. 如果后端加载失败，降级到 localStorage
3. 自动应用加载的设置

### 保存设置
1. 用户修改设置时，同时保存到：
   - localStorage（本地缓存）
   - 后端服务器（持久化存储）
2. 保存成功后显示提示信息

## API 接口

### 获取设置
```
GET /api/settings
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "customCss": "body { font-family: 'Microsoft YaHei'; }",
    "moduleVisibility": {
      "zeabur": true,
      "dns": true,
      "openai": true
    },
    "moduleOrder": ["zeabur", "dns", "openai"]
  }
}
```

### 保存设置（完整替换）
```
POST /api/settings
Authorization: Bearer <token>
Content-Type: application/json

{
  "customCss": "body { font-family: 'Microsoft YaHei'; }",
  "moduleVisibility": {
    "zeabur": true,
    "dns": false,
    "openai": true
  },
  "moduleOrder": ["zeabur", "openai", "dns"]
}

Response:
{
  "success": true,
  "message": "设置已保存"
}
```

### 更新设置（部分更新）
```
PATCH /api/settings
Authorization: Bearer <token>
Content-Type: application/json

{
  "customCss": "body { font-family: 'Arial'; }"
}

Response:
{
  "success": true,
  "message": "设置已更新"
}
```

## 使用方法

### 1. 修改自定义CSS
1. 点击右上角设置按钮
2. 在"自定义CSS"区域输入样式代码
3. 点击"应用CSS"按钮
4. 设置会自动保存到服务器

### 2. 调整模块顺序
1. 在设置中拖拽模块项调整顺序
2. 点击"保存设置"按钮
3. 设置会自动保存到服务器

### 3. 切换模块显示/隐藏
1. 在设置中点击模块右侧的眼睛图标
2. 设置会自动保存到服务器

## 跨设备同步

当你在不同设备上登录同一个账号时：
1. 设置会自动从服务器加载
2. 所有设备上的设置保持一致
3. 在任何设备上修改设置，其他设备刷新后会同步

## 向后兼容

- 如果后端服务不可用，系统会自动降级到 localStorage
- 旧版本的设置会在首次加载时自动迁移到后端
- 不会丢失任何已有的设置

## 故障排除

### 设置没有同步
1. 检查是否已登录
2. 检查网络连接
3. 查看浏览器控制台是否有错误信息
4. 确认 `data/` 目录有写入权限

### 设置丢失
1. 检查 `data/user-settings.json` 文件是否存在
2. 检查文件内容是否有效的JSON格式
3. 如果文件损坏，删除后重新设置

## 备份建议

建议定期备份 `data/user-settings.json` 文件，以防数据丢失。
